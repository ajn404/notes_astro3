import{c as Ii,g as Mr}from"./_commonjsHelpers.4gQjN7DL.js";var pi={exports:{}},mi={},te={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t._registerNode=t.Konva=t.glob=void 0;const e=Math.PI/180;function i(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}t.glob=typeof Ii<"u"?Ii:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},t.Konva={_global:t.glob,version:"9.3.0",isBrowser:i(),isUnminified:/param/.test(function(a){}.toString()),dblClickWindow:400,getAngle(a){return t.Konva.angleDeg?a*e:a},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return t.Konva.DD.isDragging},isDragReady(){return!!t.Konva.DD.node},releaseCanvasOnDestroy:!0,document:t.glob.document,_injectGlobal(a){t.glob.Konva=a}};const r=a=>{t.Konva[a.prototype.getClassName()]=a};t._registerNode=r,t.Konva._injectGlobal(t.Konva)})(te);var ue={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Util=t.Transform=void 0;const e=te;class i{constructor(d=[1,0,0,1,0,0]){this.dirty=!1,this.m=d&&d.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new i(this.m)}copyInto(d){d.m[0]=this.m[0],d.m[1]=this.m[1],d.m[2]=this.m[2],d.m[3]=this.m[3],d.m[4]=this.m[4],d.m[5]=this.m[5]}point(d){var m=this.m;return{x:m[0]*d.x+m[2]*d.y+m[4],y:m[1]*d.x+m[3]*d.y+m[5]}}translate(d,m){return this.m[4]+=this.m[0]*d+this.m[2]*m,this.m[5]+=this.m[1]*d+this.m[3]*m,this}scale(d,m){return this.m[0]*=d,this.m[1]*=d,this.m[2]*=m,this.m[3]*=m,this}rotate(d){var m=Math.cos(d),C=Math.sin(d),E=this.m[0]*m+this.m[2]*C,y=this.m[1]*m+this.m[3]*C,P=this.m[0]*-C+this.m[2]*m,b=this.m[1]*-C+this.m[3]*m;return this.m[0]=E,this.m[1]=y,this.m[2]=P,this.m[3]=b,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(d,m){var C=this.m[0]+this.m[2]*m,E=this.m[1]+this.m[3]*m,y=this.m[2]+this.m[0]*d,P=this.m[3]+this.m[1]*d;return this.m[0]=C,this.m[1]=E,this.m[2]=y,this.m[3]=P,this}multiply(d){var m=this.m[0]*d.m[0]+this.m[2]*d.m[1],C=this.m[1]*d.m[0]+this.m[3]*d.m[1],E=this.m[0]*d.m[2]+this.m[2]*d.m[3],y=this.m[1]*d.m[2]+this.m[3]*d.m[3],P=this.m[0]*d.m[4]+this.m[2]*d.m[5]+this.m[4],b=this.m[1]*d.m[4]+this.m[3]*d.m[5]+this.m[5];return this.m[0]=m,this.m[1]=C,this.m[2]=E,this.m[3]=y,this.m[4]=P,this.m[5]=b,this}invert(){var d=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),m=this.m[3]*d,C=-this.m[1]*d,E=-this.m[2]*d,y=this.m[0]*d,P=d*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),b=d*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=m,this.m[1]=C,this.m[2]=E,this.m[3]=y,this.m[4]=P,this.m[5]=b,this}getMatrix(){return this.m}decompose(){var d=this.m[0],m=this.m[1],C=this.m[2],E=this.m[3],y=this.m[4],P=this.m[5],b=d*E-m*C;let A={x:y,y:P,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(d!=0||m!=0){var O=Math.sqrt(d*d+m*m);A.rotation=m>0?Math.acos(d/O):-Math.acos(d/O),A.scaleX=O,A.scaleY=b/O,A.skewX=(d*C+m*E)/b,A.skewY=0}else if(C!=0||E!=0){var D=Math.sqrt(C*C+E*E);A.rotation=Math.PI/2-(E>0?Math.acos(-C/D):-Math.acos(C/D)),A.scaleX=b/D,A.scaleY=D,A.skewX=0,A.skewY=(d*C+m*E)/b}return A.rotation=t.Util._getRotation(A.rotation),A}}t.Transform=i;var r="[object Array]",a="[object Number]",n="[object String]",s="[object Boolean]",h=Math.PI/180,l=180/Math.PI,u="#",g="",w="0",S="Konva warning: ",c="Konva error: ",f="rgb(",v={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},_=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,T=[];const k=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(o){setTimeout(o,60)};t.Util={_isElement(o){return!!(o&&o.nodeType==1)},_isFunction(o){return!!(o&&o.constructor&&o.call&&o.apply)},_isPlainObject(o){return!!o&&o.constructor===Object},_isArray(o){return Object.prototype.toString.call(o)===r},_isNumber(o){return Object.prototype.toString.call(o)===a&&!isNaN(o)&&isFinite(o)},_isString(o){return Object.prototype.toString.call(o)===n},_isBoolean(o){return Object.prototype.toString.call(o)===s},isObject(o){return o instanceof Object},isValidSelector(o){if(typeof o!="string")return!1;var d=o[0];return d==="#"||d==="."||d===d.toUpperCase()},_sign(o){return o===0||o>0?1:-1},requestAnimFrame(o){T.push(o),T.length===1&&k(function(){const d=T;T=[],d.forEach(function(m){m()})})},createCanvasElement(){var o=document.createElement("canvas");try{o.style=o.style||{}}catch{}return o},createImageElement(){return document.createElement("img")},_isInDocument(o){for(;o=o.parentNode;)if(o==document)return!0;return!1},_urlToImage(o,d){var m=t.Util.createImageElement();m.onload=function(){d(m)},m.src=o},_rgbToHex(o,d,m){return((1<<24)+(o<<16)+(d<<8)+m).toString(16).slice(1)},_hexToRgb(o){o=o.replace(u,g);var d=parseInt(o,16);return{r:d>>16&255,g:d>>8&255,b:d&255}},getRandomColor(){for(var o=(Math.random()*16777215<<0).toString(16);o.length<6;)o=w+o;return u+o},getRGB(o){var d;return o in v?(d=v[o],{r:d[0],g:d[1],b:d[2]}):o[0]===u?this._hexToRgb(o.substring(1)):o.substr(0,4)===f?(d=_.exec(o.replace(/ /g,"")),{r:parseInt(d[1],10),g:parseInt(d[2],10),b:parseInt(d[3],10)}):{r:0,g:0,b:0}},colorToRGBA(o){return o=o||"black",t.Util._namedColorToRBA(o)||t.Util._hex3ColorToRGBA(o)||t.Util._hex4ColorToRGBA(o)||t.Util._hex6ColorToRGBA(o)||t.Util._hex8ColorToRGBA(o)||t.Util._rgbColorToRGBA(o)||t.Util._rgbaColorToRGBA(o)||t.Util._hslColorToRGBA(o)},_namedColorToRBA(o){var d=v[o.toLowerCase()];return d?{r:d[0],g:d[1],b:d[2],a:1}:null},_rgbColorToRGBA(o){if(o.indexOf("rgb(")===0){o=o.match(/rgb\(([^)]+)\)/)[1];var d=o.split(/ *, */).map(Number);return{r:d[0],g:d[1],b:d[2],a:1}}},_rgbaColorToRGBA(o){if(o.indexOf("rgba(")===0){o=o.match(/rgba\(([^)]+)\)/)[1];var d=o.split(/ *, */).map((m,C)=>m.slice(-1)==="%"?C===3?parseInt(m)/100:parseInt(m)/100*255:Number(m));return{r:d[0],g:d[1],b:d[2],a:d[3]}}},_hex8ColorToRGBA(o){if(o[0]==="#"&&o.length===9)return{r:parseInt(o.slice(1,3),16),g:parseInt(o.slice(3,5),16),b:parseInt(o.slice(5,7),16),a:parseInt(o.slice(7,9),16)/255}},_hex6ColorToRGBA(o){if(o[0]==="#"&&o.length===7)return{r:parseInt(o.slice(1,3),16),g:parseInt(o.slice(3,5),16),b:parseInt(o.slice(5,7),16),a:1}},_hex4ColorToRGBA(o){if(o[0]==="#"&&o.length===5)return{r:parseInt(o[1]+o[1],16),g:parseInt(o[2]+o[2],16),b:parseInt(o[3]+o[3],16),a:parseInt(o[4]+o[4],16)/255}},_hex3ColorToRGBA(o){if(o[0]==="#"&&o.length===4)return{r:parseInt(o[1]+o[1],16),g:parseInt(o[2]+o[2],16),b:parseInt(o[3]+o[3],16),a:1}},_hslColorToRGBA(o){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(o)){const[d,...m]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(o),C=Number(m[0])/360,E=Number(m[1])/100,y=Number(m[2])/100;let P,b,A;if(E===0)return A=y*255,{r:Math.round(A),g:Math.round(A),b:Math.round(A),a:1};y<.5?P=y*(1+E):P=y+E-y*E;const O=2*y-P,D=[0,0,0];for(let L=0;L<3;L++)b=C+1/3*-(L-1),b<0&&b++,b>1&&b--,6*b<1?A=O+(P-O)*6*b:2*b<1?A=P:3*b<2?A=O+(P-O)*(2/3-b)*6:A=O,D[L]=A*255;return{r:Math.round(D[0]),g:Math.round(D[1]),b:Math.round(D[2]),a:1}}},haveIntersection(o,d){return!(d.x>o.x+o.width||d.x+d.width<o.x||d.y>o.y+o.height||d.y+d.height<o.y)},cloneObject(o){var d={};for(var m in o)this._isPlainObject(o[m])?d[m]=this.cloneObject(o[m]):this._isArray(o[m])?d[m]=this.cloneArray(o[m]):d[m]=o[m];return d},cloneArray(o){return o.slice(0)},degToRad(o){return o*h},radToDeg(o){return o*l},_degToRad(o){return t.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),t.Util.degToRad(o)},_radToDeg(o){return t.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),t.Util.radToDeg(o)},_getRotation(o){return e.Konva.angleDeg?t.Util.radToDeg(o):o},_capitalize(o){return o.charAt(0).toUpperCase()+o.slice(1)},throw(o){throw new Error(c+o)},error(o){console.error(c+o)},warn(o){e.Konva.showWarnings&&console.warn(S+o)},each(o,d){for(var m in o)d(m,o[m])},_inRange(o,d,m){return d<=o&&o<m},_getProjectionToSegment(o,d,m,C,E,y){var P,b,A,O=(o-m)*(o-m)+(d-C)*(d-C);if(O==0)P=o,b=d,A=(E-m)*(E-m)+(y-C)*(y-C);else{var D=((E-o)*(m-o)+(y-d)*(C-d))/O;D<0?(P=o,b=d,A=(o-E)*(o-E)+(d-y)*(d-y)):D>1?(P=m,b=C,A=(m-E)*(m-E)+(C-y)*(C-y)):(P=o+D*(m-o),b=d+D*(C-d),A=(P-E)*(P-E)+(b-y)*(b-y))}return[P,b,A]},_getProjectionToLine(o,d,m){var C=t.Util.cloneObject(o),E=Number.MAX_VALUE;return d.forEach(function(y,P){if(!(!m&&P===d.length-1)){var b=d[(P+1)%d.length],A=t.Util._getProjectionToSegment(y.x,y.y,b.x,b.y,o.x,o.y),O=A[0],D=A[1],L=A[2];L<E&&(C.x=O,C.y=D,E=L)}}),C},_prepareArrayForTween(o,d,m){var C,E=[],y=[];if(o.length>d.length){var P=d;d=o,o=P}for(C=0;C<o.length;C+=2)E.push({x:o[C],y:o[C+1]});for(C=0;C<d.length;C+=2)y.push({x:d[C],y:d[C+1]});var b=[];return y.forEach(function(A){var O=t.Util._getProjectionToLine(A,E,m);b.push(O.x),b.push(O.y)}),b},_prepareToStringify(o){var d;o.visitedByCircularReferenceRemoval=!0;for(var m in o)if(o.hasOwnProperty(m)&&o[m]&&typeof o[m]=="object"){if(d=Object.getOwnPropertyDescriptor(o,m),o[m].visitedByCircularReferenceRemoval||t.Util._isElement(o[m]))if(d.configurable)delete o[m];else return null;else if(t.Util._prepareToStringify(o[m])===null)if(d.configurable)delete o[m];else return null}return delete o.visitedByCircularReferenceRemoval,o},_assign(o,d){for(var m in d)o[m]=d[m];return o},_getFirstPointerId(o){return o.touches?o.changedTouches[0].identifier:o.pointerId||999},releaseCanvas(...o){e.Konva.releaseCanvasOnDestroy&&o.forEach(d=>{d.width=0,d.height=0})},drawRoundedRectPath(o,d,m,C){let E=0,y=0,P=0,b=0;typeof C=="number"?E=y=P=b=Math.min(C,d/2,m/2):(E=Math.min(C[0]||0,d/2,m/2),y=Math.min(C[1]||0,d/2,m/2),b=Math.min(C[2]||0,d/2,m/2),P=Math.min(C[3]||0,d/2,m/2)),o.moveTo(E,0),o.lineTo(d-y,0),o.arc(d-y,y,y,Math.PI*3/2,0,!1),o.lineTo(d,m-b),o.arc(d-b,m-b,b,0,Math.PI/2,!1),o.lineTo(P,m),o.arc(P,m-P,P,Math.PI/2,Math.PI,!1),o.lineTo(0,E),o.arc(E,E,E,Math.PI,Math.PI*3/2,!1)}}})(ue);var Ze={},Me={},U={};Object.defineProperty(U,"__esModule",{value:!0});U.getComponentValidator=U.getBooleanValidator=U.getNumberArrayValidator=U.getFunctionValidator=U.getStringOrGradientValidator=U.getStringValidator=U.getNumberOrAutoValidator=U.getNumberOrArrayOfNumbersValidator=U.getNumberValidator=U.alphaComponent=U.RGBComponent=void 0;const Be=te,J=ue;function Ue(t){return J.Util._isString(t)?'"'+t+'"':Object.prototype.toString.call(t)==="[object Number]"||J.Util._isBoolean(t)?t:Object.prototype.toString.call(t)}function Lr(t){return t>255?255:t<0?0:Math.round(t)}U.RGBComponent=Lr;function Or(t){return t>1?1:t<1e-4?1e-4:t}U.alphaComponent=Or;function Fr(){if(Be.Konva.isUnminified)return function(t,e){return J.Util._isNumber(t)||J.Util.warn(Ue(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}U.getNumberValidator=Fr;function Gr(t){if(Be.Konva.isUnminified)return function(e,i){let r=J.Util._isNumber(e),a=J.Util._isArray(e)&&e.length==t;return!r&&!a&&J.Util.warn(Ue(e)+' is a not valid value for "'+i+'" attribute. The value should be a number or Array<number>('+t+")"),e}}U.getNumberOrArrayOfNumbersValidator=Gr;function Rr(){if(Be.Konva.isUnminified)return function(t,e){var i=J.Util._isNumber(t),r=t==="auto";return i||r||J.Util.warn(Ue(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}U.getNumberOrAutoValidator=Rr;function Wr(){if(Be.Konva.isUnminified)return function(t,e){return J.Util._isString(t)||J.Util.warn(Ue(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}U.getStringValidator=Wr;function Br(){if(Be.Konva.isUnminified)return function(t,e){const i=J.Util._isString(t),r=Object.prototype.toString.call(t)==="[object CanvasGradient]"||t&&t.addColorStop;return i||r||J.Util.warn(Ue(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}U.getStringOrGradientValidator=Br;function Ur(){if(Be.Konva.isUnminified)return function(t,e){return J.Util._isFunction(t)||J.Util.warn(Ue(t)+' is a not valid value for "'+e+'" attribute. The value should be a function.'),t}}U.getFunctionValidator=Ur;function Vr(){if(Be.Konva.isUnminified)return function(t,e){const i=Int8Array?Object.getPrototypeOf(Int8Array):null;return i&&t instanceof i||(J.Util._isArray(t)?t.forEach(function(r){J.Util._isNumber(r)||J.Util.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):J.Util.warn(Ue(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}U.getNumberArrayValidator=Vr;function Hr(){if(Be.Konva.isUnminified)return function(t,e){var i=t===!0||t===!1;return i||J.Util.warn(Ue(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}U.getBooleanValidator=Hr;function Nr(t){if(Be.Konva.isUnminified)return function(e,i){return e==null||J.Util.isObject(e)||J.Util.warn(Ue(e)+' is a not valid value for "'+i+'" attribute. The value should be an object with properties '+t),e}}U.getComponentValidator=Nr;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;const e=ue,i=U;var r="get",a="set";t.Factory={addGetterSetter(n,s,h,l,u){t.Factory.addGetter(n,s,h),t.Factory.addSetter(n,s,l,u),t.Factory.addOverloadedGetterSetter(n,s)},addGetter(n,s,h){var l=r+e.Util._capitalize(s);n.prototype[l]=n.prototype[l]||function(){var u=this.attrs[s];return u===void 0?h:u}},addSetter(n,s,h,l){var u=a+e.Util._capitalize(s);n.prototype[u]||t.Factory.overWriteSetter(n,s,h,l)},overWriteSetter(n,s,h,l){var u=a+e.Util._capitalize(s);n.prototype[u]=function(g){return h&&g!==void 0&&g!==null&&(g=h.call(this,g,s)),this._setAttr(s,g),l&&l.call(this),this}},addComponentsGetterSetter(n,s,h,l,u){var g=h.length,w=e.Util._capitalize,S=r+w(s),c=a+w(s),f,v;n.prototype[S]=function(){var T={};for(f=0;f<g;f++)v=h[f],T[v]=this.getAttr(s+w(v));return T};var _=(0,i.getComponentValidator)(h);n.prototype[c]=function(T){var k=this.attrs[s],o;l&&(T=l.call(this,T)),_&&_.call(this,T,s);for(o in T)T.hasOwnProperty(o)&&this._setAttr(s+w(o),T[o]);return T||h.forEach(d=>{this._setAttr(s+w(d),void 0)}),this._fireChangeEvent(s,k,T),u&&u.call(this),this},t.Factory.addOverloadedGetterSetter(n,s)},addOverloadedGetterSetter(n,s){var h=e.Util._capitalize(s),l=a+h,u=r+h;n.prototype[s]=function(){return arguments.length?(this[l](arguments[0]),this):this[u]()}},addDeprecatedGetterSetter(n,s,h,l){e.Util.error("Adding deprecated "+s);var u=r+e.Util._capitalize(s),g=s+" property is deprecated and will be removed soon. Look at Konva change log for more information.";n.prototype[u]=function(){e.Util.error(g);var w=this.attrs[s];return w===void 0?h:w},t.Factory.addSetter(n,s,l,function(){e.Util.error(g)}),t.Factory.addOverloadedGetterSetter(n,s)},backCompat(n,s){e.Util.each(s,function(h,l){var u=n.prototype[l],g=r+e.Util._capitalize(h),w=a+e.Util._capitalize(h);function S(){u.apply(this,arguments),e.Util.error('"'+h+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}n.prototype[h]=S,n.prototype[g]=S,n.prototype[w]=S})},afterSetFilter(){this._filterUpToDate=!1}}})(Me);var Pe={},We={};Object.defineProperty(We,"__esModule",{value:!0});We.HitContext=We.SceneContext=We.Context=void 0;const tr=ue,Xr=te;function zr(t){var e=[],i=t.length,r=tr.Util,a,n;for(a=0;a<i;a++)n=t[a],r._isNumber(n)?n=Math.round(n*1e3)/1e3:r._isString(n)||(n=n+""),e.push(n);return e}var Mi=",",Yr="(",Zr=")",Kr="([",jr="])",Jr=";",qr="()",$r="=",Li=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],Qr=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const ea=100;class Jt{constructor(e){this.canvas=e,Xr.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,i){var r=this.traceArr,a=r.length,n="",s,h,l,u;for(s=0;s<a;s++)h=r[s],l=h.method,l?(u=h.args,n+=l,e?n+=qr:tr.Util._isArray(u[0])?n+=Kr+u.join(Mi)+jr:(i&&(u=u.map(g=>typeof g=="number"?Math.floor(g):g)),n+=Yr+u.join(Mi)+Zr)):(n+=h.property,e||(n+=$r+h.val)),n+=Jr;return n}clearTrace(){this.traceArr=[]}_trace(e){var i=this.traceArr,r;i.push(e),r=i.length,r>=ea&&i.shift()}reset(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){var i=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,i.getWidth()/i.pixelRatio,i.getHeight()/i.pixelRatio)}_applyLineCap(e){const i=e.attrs.lineCap;i&&this.setAttr("lineCap",i)}_applyOpacity(e){var i=e.getAbsoluteOpacity();i!==1&&this.setAttr("globalAlpha",i)}_applyLineJoin(e){const i=e.attrs.lineJoin;i&&this.setAttr("lineJoin",i)}setAttr(e,i){this._context[e]=i}arc(e,i,r,a,n,s){this._context.arc(e,i,r,a,n,s)}arcTo(e,i,r,a,n){this._context.arcTo(e,i,r,a,n)}beginPath(){this._context.beginPath()}bezierCurveTo(e,i,r,a,n,s){this._context.bezierCurveTo(e,i,r,a,n,s)}clearRect(e,i,r,a){this._context.clearRect(e,i,r,a)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,i){var r=arguments;if(r.length===2)return this._context.createImageData(e,i);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,i,r,a){return this._context.createLinearGradient(e,i,r,a)}createPattern(e,i){return this._context.createPattern(e,i)}createRadialGradient(e,i,r,a,n,s){return this._context.createRadialGradient(e,i,r,a,n,s)}drawImage(e,i,r,a,n,s,h,l,u){var g=arguments,w=this._context;g.length===3?w.drawImage(e,i,r):g.length===5?w.drawImage(e,i,r,a,n):g.length===9&&w.drawImage(e,i,r,a,n,s,h,l,u)}ellipse(e,i,r,a,n,s,h,l){this._context.ellipse(e,i,r,a,n,s,h,l)}isPointInPath(e,i,r,a){return r?this._context.isPointInPath(r,e,i,a):this._context.isPointInPath(e,i,a)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,i,r,a){this._context.fillRect(e,i,r,a)}strokeRect(e,i,r,a){this._context.strokeRect(e,i,r,a)}fillText(e,i,r,a){a?this._context.fillText(e,i,r,a):this._context.fillText(e,i,r)}measureText(e){return this._context.measureText(e)}getImageData(e,i,r,a){return this._context.getImageData(e,i,r,a)}lineTo(e,i){this._context.lineTo(e,i)}moveTo(e,i){this._context.moveTo(e,i)}rect(e,i,r,a){this._context.rect(e,i,r,a)}putImageData(e,i,r){this._context.putImageData(e,i,r)}quadraticCurveTo(e,i,r,a){this._context.quadraticCurveTo(e,i,r,a)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,i){this._context.scale(e,i)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,i,r,a,n,s){this._context.setTransform(e,i,r,a,n,s)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,i,r,a){this._context.strokeText(e,i,r,a)}transform(e,i,r,a,n,s){this._context.transform(e,i,r,a,n,s)}translate(e,i){this._context.translate(e,i)}_enableTrace(){var e=this,i=Li.length,r=this.setAttr,a,n,s=function(h){var l=e[h],u;e[h]=function(){return n=zr(Array.prototype.slice.call(arguments,0)),u=l.apply(e,arguments),e._trace({method:h,args:n}),u}};for(a=0;a<i;a++)s(Li[a]);e.setAttr=function(){r.apply(e,arguments);var h=arguments[0],l=arguments[1];(h==="shadowOffsetX"||h==="shadowOffsetY"||h==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),e._trace({property:h,val:l})}}_applyGlobalCompositeOperation(e){const i=e.attrs.globalCompositeOperation;var r=!i||i==="source-over";r||this.setAttr("globalCompositeOperation",i)}}We.Context=Jt;Qr.forEach(function(t){Object.defineProperty(Jt.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class ta extends Jt{constructor(e,{willReadFrequently:i=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:i})}_fillColor(e){var i=e.fill();this.setAttr("fillStyle",i),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){var i=e._getLinearGradient();i&&(this.setAttr("fillStyle",i),e._fillFunc(this))}_fillRadialGradient(e){const i=e._getRadialGradient();i&&(this.setAttr("fillStyle",i),e._fillFunc(this))}_fill(e){const i=e.fill(),r=e.getFillPriority();if(i&&r==="color"){this._fillColor(e);return}const a=e.getFillPatternImage();if(a&&r==="pattern"){this._fillPattern(e);return}const n=e.getFillLinearGradientColorStops();if(n&&r==="linear-gradient"){this._fillLinearGradient(e);return}const s=e.getFillRadialGradientColorStops();if(s&&r==="radial-gradient"){this._fillRadialGradient(e);return}i?this._fillColor(e):a?this._fillPattern(e):n?this._fillLinearGradient(e):s&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const i=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),a=e.getStrokeLinearGradientColorStops(),n=this.createLinearGradient(i.x,i.y,r.x,r.y);if(a){for(var s=0;s<a.length;s+=2)n.addColorStop(a[s],a[s+1]);this.setAttr("strokeStyle",n)}}_stroke(e){var i=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();var a=this.getCanvas().getPixelRatio();this.setTransform(a,0,0,a,0,0)}this._applyLineCap(e),i&&e.dashEnabled()&&(this.setLineDash(i),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var n=e.getStrokeLinearGradientColorStops();n?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var i,r,a,n=(i=e.getShadowRGBA())!==null&&i!==void 0?i:"black",s=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,h=(a=e.getShadowOffset())!==null&&a!==void 0?a:{x:0,y:0},l=e.getAbsoluteScale(),u=this.canvas.getPixelRatio(),g=l.x*u,w=l.y*u;this.setAttr("shadowColor",n),this.setAttr("shadowBlur",s*Math.min(Math.abs(g),Math.abs(w))),this.setAttr("shadowOffsetX",h.x*g),this.setAttr("shadowOffsetY",h.y*w)}}We.SceneContext=ta;class ia extends Jt{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const n=e.getStrokeScaleEnabled();if(!n){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(e);var r=e.hitStrokeWidth(),a=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",a),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),n||this.restore()}}}We.HitContext=ia;Object.defineProperty(Pe,"__esModule",{value:!0});Pe.HitCanvas=Pe.SceneCanvas=Pe.Canvas=void 0;const Yt=ue,ir=We,rr=te,ra=Me,aa=U;var Gt;function na(){if(Gt)return Gt;var t=Yt.Util.createCanvasElement(),e=t.getContext("2d");return Gt=function(){var i=rr.Konva._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return i/r}(),Yt.Util.releaseCanvas(t),Gt}class qt{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var i=e||{},r=i.pixelRatio||rr.Konva.pixelRatio||na();this.pixelRatio=r,this._canvas=Yt.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){var i=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/i,this.getHeight()/i)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";var i=this.pixelRatio,r=this.getContext()._context;r.scale(i,i)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";var i=this.pixelRatio,r=this.getContext()._context;r.scale(i,i)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,i){this.setWidth(e||0),this.setHeight(i||0)}toDataURL(e,i){try{return this._canvas.toDataURL(e,i)}catch{try{return this._canvas.toDataURL()}catch(a){return Yt.Util.error("Unable to get data URL. "+a.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}Pe.Canvas=qt;ra.Factory.addGetterSetter(qt,"pixelRatio",void 0,(0,aa.getNumberValidator)());class sa extends qt{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new ir.SceneContext(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}Pe.SceneCanvas=sa;class oa extends qt{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new ir.HitContext(this),this.setSize(e.width,e.height)}}Pe.HitCanvas=oa;var $t={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.DD=void 0;const e=te,i=ue;t.DD={get isDragging(){var r=!1;return t.DD._dragElements.forEach(a=>{a.dragStatus==="dragging"&&(r=!0)}),r},justDragged:!1,get node(){var r;return t.DD._dragElements.forEach(a=>{r=a.node}),r},_dragElements:new Map,_drag(r){const a=[];t.DD._dragElements.forEach((n,s)=>{const{node:h}=n,l=h.getStage();l.setPointersPositions(r),n.pointerId===void 0&&(n.pointerId=i.Util._getFirstPointerId(r));const u=l._changedPointerPositions.find(S=>S.id===n.pointerId);if(u){if(n.dragStatus!=="dragging"){var g=h.dragDistance(),w=Math.max(Math.abs(u.x-n.startPointerPos.x),Math.abs(u.y-n.startPointerPos.y));if(w<g||(h.startDrag({evt:r}),!h.isDragging()))return}h._setDragPosition(r,n),a.push(h)}}),a.forEach(n=>{n.fire("dragmove",{type:"dragmove",target:n,evt:r},!0)})},_endDragBefore(r){const a=[];t.DD._dragElements.forEach(n=>{const{node:s}=n,h=s.getStage();if(r&&h.setPointersPositions(r),!h._changedPointerPositions.find(g=>g.id===n.pointerId))return;(n.dragStatus==="dragging"||n.dragStatus==="stopped")&&(t.DD.justDragged=!0,e.Konva._mouseListenClick=!1,e.Konva._touchListenClick=!1,e.Konva._pointerListenClick=!1,n.dragStatus="stopped");const u=n.node.getLayer()||n.node instanceof e.Konva.Stage&&n.node;u&&a.indexOf(u)===-1&&a.push(u)}),a.forEach(n=>{n.draw()})},_endDragAfter(r){t.DD._dragElements.forEach((a,n)=>{a.dragStatus==="stopped"&&a.node.fire("dragend",{type:"dragend",target:a.node,evt:r},!0),a.dragStatus!=="dragging"&&t.DD._dragElements.delete(n)})}},e.Konva.isBrowser&&(window.addEventListener("mouseup",t.DD._endDragBefore,!0),window.addEventListener("touchend",t.DD._endDragBefore,!0),window.addEventListener("mousemove",t.DD._drag),window.addEventListener("touchmove",t.DD._drag),window.addEventListener("mouseup",t.DD._endDragAfter,!1),window.addEventListener("touchend",t.DD._endDragAfter,!1))})($t);Object.defineProperty(Ze,"__esModule",{value:!0});Ze.Node=void 0;const B=ue,xt=Me,Rt=Pe,$e=te,ke=$t,ie=U;var Nt="absoluteOpacity",Wt="allEventListeners",Re="absoluteTransform",Oi="absoluteScale",Qe="canvas",ha="Change",la="children",da="konva",vi="listening",Fi="mouseenter",Gi="mouseleave",Ri="set",Wi="Shape",Xt=" ",Bi="stage",Xe="transform",ua="Stage",yi="visible",fa=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Xt);let ga=1;class F{constructor(e){this._id=ga++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===Xe||e===Re)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,i){var r=this._cache.get(e),a=e===Xe||e===Re,n=r===void 0||a&&r.dirty===!0;return n&&(r=i.call(this),this._cache.set(e,r)),r}_calculate(e,i,r){if(!this._attachedDepsListeners.get(e)){const a=i.map(n=>n+"Change.konva").join(Xt);this.on(a,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(Qe)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===Re&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Qe)){const{scene:e,filter:i,hit:r}=this._cache.get(Qe);B.Util.releaseCanvas(e,i,r),this._cache.delete(Qe)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){var i=e||{},r={};(i.x===void 0||i.y===void 0||i.width===void 0||i.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));var a=Math.ceil(i.width||r.width),n=Math.ceil(i.height||r.height),s=i.pixelRatio,h=i.x===void 0?Math.floor(r.x):i.x,l=i.y===void 0?Math.floor(r.y):i.y,u=i.offset||0,g=i.drawBorder||!1,w=i.hitCanvasPixelRatio||1;if(!a||!n){B.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}a+=u*2+1,n+=u*2+1,h-=u,l-=u;var S=new Rt.SceneCanvas({pixelRatio:s,width:a,height:n}),c=new Rt.SceneCanvas({pixelRatio:s,width:0,height:0,willReadFrequently:!0}),f=new Rt.HitCanvas({pixelRatio:w,width:a,height:n}),v=S.getContext(),_=f.getContext();return f.isCache=!0,S.isCache=!0,this._cache.delete(Qe),this._filterUpToDate=!1,i.imageSmoothingEnabled===!1&&(S.getContext()._context.imageSmoothingEnabled=!1,c.getContext()._context.imageSmoothingEnabled=!1),v.save(),_.save(),v.translate(-h,-l),_.translate(-h,-l),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Nt),this._clearSelfAndDescendantCache(Oi),this.drawScene(S,this),this.drawHit(f,this),this._isUnderCache=!1,v.restore(),_.restore(),g&&(v.save(),v.beginPath(),v.rect(0,0,a,n),v.closePath(),v.setAttr("strokeStyle","red"),v.setAttr("lineWidth",5),v.stroke(),v.restore()),this._cache.set(Qe,{scene:S,filter:c,hit:f,x:h,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(Qe)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,i){var r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],a=1/0,n=1/0,s=-1/0,h=-1/0,l=this.getAbsoluteTransform(i);return r.forEach(function(u){var g=l.point(u);a===void 0&&(a=s=g.x,n=h=g.y),a=Math.min(a,g.x),n=Math.min(n,g.y),s=Math.max(s,g.x),h=Math.max(h,g.y)}),{x:a,y:n,width:s-a,height:h-n}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const i=this._getCanvasCache();e.translate(i.x,i.y);var r=this._getCachedSceneCanvas(),a=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/a,r.height/a),e.restore()}_drawCachedHitCanvas(e){var i=this._getCanvasCache(),r=i.hit;e.save(),e.translate(i.x,i.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){var e=this.filters(),i=this._getCanvasCache(),r=i.scene,a=i.filter,n=a.getContext(),s,h,l,u;if(e){if(!this._filterUpToDate){var g=r.pixelRatio;a.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(s=e.length,n.clear(),n.drawImage(r._canvas,0,0,r.getWidth()/g,r.getHeight()/g),h=n.getImageData(0,0,a.getWidth(),a.getHeight()),l=0;l<s;l++){if(u=e[l],typeof u!="function"){B.Util.error("Filter should be type of function, but got "+typeof u+" instead. Please check correct filters");continue}u.call(this,h),n.putImageData(h,0,0)}}catch(w){B.Util.error("Unable to apply filter. "+w.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return a}return r}on(e,i){if(this._cache&&this._cache.delete(Wt),arguments.length===3)return this._delegate.apply(this,arguments);var r=e.split(Xt),a=r.length,n,s,h,l,u;for(n=0;n<a;n++)s=r[n],h=s.split("."),l=h[0],u=h[1]||"",this.eventListeners[l]||(this.eventListeners[l]=[]),this.eventListeners[l].push({name:u,handler:i});return this}off(e,i){var r=(e||"").split(Xt),a=r.length,n,s,h,l,u,g;if(this._cache&&this._cache.delete(Wt),!e)for(s in this.eventListeners)this._off(s);for(n=0;n<a;n++)if(h=r[n],l=h.split("."),u=l[0],g=l[1],u)this.eventListeners[u]&&this._off(u,g,i);else for(s in this.eventListeners)this._off(s,g,i);return this}dispatchEvent(e){var i={target:this,type:e.type,evt:e};return this.fire(e.type,i),this}addEventListener(e,i){return this.on(e,function(r){i.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,i,r){var a=this;this.on(e,function(n){for(var s=n.target.findAncestors(i,!0,a),h=0;h<s.length;h++)n=B.Util.cloneObject(n),n.currentTarget=s[h],r.call(s[h],n)})}remove(){return this.isDragging()&&this.stopDrag(),ke.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Re),this._clearSelfAndDescendantCache(Nt),this._clearSelfAndDescendantCache(Oi),this._clearSelfAndDescendantCache(Bi),this._clearSelfAndDescendantCache(yi),this._clearSelfAndDescendantCache(vi)}_remove(){this._clearCaches();var e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){var i="get"+B.Util._capitalize(e);return B.Util._isFunction(this[i])?this[i]():this.attrs[e]}getAncestors(){for(var e=this.getParent(),i=[];e;)i.push(e),e=e.getParent();return i}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{var i,r;if(!e)return this;for(i in e)i!==la&&(r=Ri+B.Util._capitalize(i),B.Util._isFunction(this[r])?this[r](e[i]):this._setAttr(i,e[i]))}),this}isListening(){return this._getCache(vi,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(yi,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,i=!1){if(e)return this._isVisible(e)&&this._isListening(e);var r=this.getLayer(),a=!1;ke.DD._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(s.node.nodeType==="Stage"||s.node.getLayer()===r)&&(a=!0)});var n=!i&&!$e.Konva.hitOnDragEnabled&&a;return this.isListening()&&this.isVisible()&&!n}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var e=this.getDepth(),i=this,r=0,a,n,s,h;function l(g){for(a=[],n=g.length,s=0;s<n;s++)h=g[s],r++,h.nodeType!==Wi&&(a=a.concat(h.getChildren().slice())),h._id===i._id&&(s=n);a.length>0&&a[0].getDepth()<=e&&l(a)}const u=this.getStage();return i.nodeType!==ua&&u&&l(u.getChildren()),r}getDepth(){for(var e=0,i=this.parent;i;)e++,i=i.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Xe),this._clearSelfAndDescendantCache(Re)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;var i=e.getPointerPosition();if(!i)return null;var r=this.getAbsoluteTransform().copy();return r.invert(),r.point(i)}getAbsolutePosition(e){let i=!1,r=this.parent;for(;r;){if(r.isCached()){i=!0;break}r=r.parent}i&&!e&&(e=!0);var a=this.getAbsoluteTransform(e).getMatrix(),n=new B.Transform,s=this.offset();return n.m=a.slice(),n.translate(s.x,s.y),n.getTranslation()}setAbsolutePosition(e){const{x:i,y:r,...a}=this._clearTransform();this.attrs.x=i,this.attrs.y=r,this._clearCache(Xe);var n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(e.x,e.y),e={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(a),this.setPosition({x:e.x,y:e.y}),this._clearCache(Xe),this._clearSelfAndDescendantCache(Re),this}_setTransform(e){var i;for(i in e)this.attrs[i]=e[i]}_clearTransform(){var e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){var i=e.x,r=e.y,a=this.x(),n=this.y();return i!==void 0&&(a+=i),r!==void 0&&(n+=r),this.setPosition({x:a,y:n}),this}_eachAncestorReverse(e,i){var r=[],a=this.getParent(),n,s;if(!(i&&i._id===this._id)){for(r.unshift(this);a&&(!i||a._id!==i._id);)r.unshift(a),a=a.parent;for(n=r.length,s=0;s<n;s++)e(r[s])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return B.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var e=this.index,i=this.parent.getChildren().length;return e<i-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return B.Util.warn("Node has no parent. moveUp function is ignored."),!1;var e=this.index,i=this.parent.getChildren().length;return e<i-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return B.Util.warn("Node has no parent. moveDown function is ignored."),!1;var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return B.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return B.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&B.Util.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var i=this.index;return this.parent.children.splice(i,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Nt,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var e=this.opacity(),i=this.getParent();return i&&!i._isUnderCache&&(e*=i.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){var e={},i=this.getAttrs(),r,a,n,s,h;e.attrs={};for(r in i)a=i[r],h=B.Util.isObject(a)&&!B.Util._isPlainObject(a)&&!B.Util._isArray(a),!h&&(n=typeof this[r]=="function"&&this[r],delete i[r],s=n?n.call(this):null,i[r]=a,s!==a&&(e.attrs[r]=a));return e.className=this.getClassName(),B.Util._prepareToStringify(e)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,i,r){var a=[];i&&this._isMatch(e)&&a.push(this);for(var n=this.parent;n;){if(n===r)return a;n._isMatch(e)&&a.push(n),n=n.parent}return a}isAncestorOf(e){return!1}findAncestor(e,i,r){return this.findAncestors(e,i,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);var i=e.replace(/ /g,"").split(","),r=i.length,a,n;for(a=0;a<r;a++)if(n=i[a],B.Util.isValidSelector(n)||(B.Util.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),B.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),B.Util.warn("Konva is awesome, right?")),n.charAt(0)==="#"){if(this.id()===n.slice(1))return!0}else if(n.charAt(0)==="."){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){var e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(Bi,this._getStage)}_getStage(){var e=this.getParent();return e?e.getStage():null}fire(e,i={},r){return i.target=i.target||this,r?this._fireAndBubble(e,i):this._fire(e,i),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(Re,this._getAbsoluteTransform)}_getAbsoluteTransform(e){var i;if(e)return i=new B.Transform,this._eachAncestorReverse(function(a){var n=a.transformsEnabled();n==="all"?i.multiply(a.getTransform()):n==="position"&&i.translate(a.x()-a.offsetX(),a.y()-a.offsetY())},e),i;i=this._cache.get(Re)||new B.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(i):i.reset();var r=this.transformsEnabled();if(r==="all")i.multiply(this.getTransform());else if(r==="position"){const a=this.attrs.x||0,n=this.attrs.y||0,s=this.attrs.offsetX||0,h=this.attrs.offsetY||0;i.translate(a-s,n-h)}return i.dirty=!1,i}getAbsoluteScale(e){for(var i=this;i;)i._isUnderCache&&(e=i),i=i.getParent();const a=this.getAbsoluteTransform(e).decompose();return{x:a.scaleX,y:a.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Xe,this._getTransform)}_getTransform(){var e,i,r=this._cache.get(Xe)||new B.Transform;r.reset();var a=this.x(),n=this.y(),s=$e.Konva.getAngle(this.rotation()),h=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,l=(i=this.attrs.scaleY)!==null&&i!==void 0?i:1,u=this.attrs.skewX||0,g=this.attrs.skewY||0,w=this.attrs.offsetX||0,S=this.attrs.offsetY||0;return(a!==0||n!==0)&&r.translate(a,n),s!==0&&r.rotate(s),(u!==0||g!==0)&&r.skew(u,g),(h!==1||l!==1)&&r.scale(h,l),(w!==0||S!==0)&&r.translate(-1*w,-1*S),r.dirty=!1,r}clone(e){var i=B.Util.cloneObject(this.attrs),r,a,n,s,h;for(r in e)i[r]=e[r];var l=new this.constructor(i);for(r in this.eventListeners)for(a=this.eventListeners[r],n=a.length,s=0;s<n;s++)h=a[s],h.name.indexOf(da)<0&&(l.eventListeners[r]||(l.eventListeners[r]=[]),l.eventListeners[r].push(h));return l}_toKonvaCanvas(e){e=e||{};var i=this.getClientRect(),r=this.getStage(),a=e.x!==void 0?e.x:Math.floor(i.x),n=e.y!==void 0?e.y:Math.floor(i.y),s=e.pixelRatio||1,h=new Rt.SceneCanvas({width:e.width||Math.ceil(i.width)||(r?r.width():0),height:e.height||Math.ceil(i.height)||(r?r.height():0),pixelRatio:s}),l=h.getContext();return e.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(a||n)&&l.translate(-1*a,-1*n),this.drawScene(h),l.restore(),h}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};var i=e.mimeType||null,r=e.quality||null,a=this._toKonvaCanvas(e).toDataURL(i,r);return e.callback&&e.callback(a),a}toImage(e){return new Promise((i,r)=>{try{const a=e?.callback;a&&delete e.callback,B.Util._urlToImage(this.toDataURL(e),function(n){i(n),a?.(n)})}catch(a){r(a)}})}toBlob(e){return new Promise((i,r)=>{try{const a=e?.callback;a&&delete e.callback,this.toCanvas(e).toBlob(n=>{i(n),a?.(n)},e?.mimeType,e?.quality)}catch(a){r(a)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():$e.Konva.dragDistance}_off(e,i,r){var a=this.eventListeners[e],n,s,h;for(n=0;n<a.length;n++)if(s=a[n].name,h=a[n].handler,(s!=="konva"||i==="konva")&&(!i||s===i)&&(!r||r===h)){if(a.splice(n,1),a.length===0){delete this.eventListeners[e];break}n--}}_fireChangeEvent(e,i,r){this._fire(e+ha,{oldVal:i,newVal:r})}addName(e){if(!this.hasName(e)){var i=this.name(),r=i?i+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const i=this.name();if(!i)return!1;var r=(i||"").split(/\s/g);return r.indexOf(e)!==-1}removeName(e){var i=(this.name()||"").split(/\s/g),r=i.indexOf(e);return r!==-1&&(i.splice(r,1),this.name(i.join(" "))),this}setAttr(e,i){var r=this[Ri+B.Util._capitalize(e)];return B.Util._isFunction(r)?r.call(this,i):this._setAttr(e,i),this}_requestDraw(){if($e.Konva.autoDrawEnabled){const e=this.getLayer()||this.getStage();e?.batchDraw()}}_setAttr(e,i){var r=this.attrs[e];r===i&&!B.Util.isObject(i)||(i==null?delete this.attrs[e]:this.attrs[e]=i,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,i),this._requestDraw())}_setComponentAttr(e,i,r){var a;r!==void 0&&(a=this.attrs[e],a||(this.attrs[e]=this.getAttr(e)),this.attrs[e][i]=r,this._fireChangeEvent(e,a,r))}_fireAndBubble(e,i,r){i&&this.nodeType===Wi&&(i.target=this);var a=(e===Fi||e===Gi)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r);if(!a){this._fire(e,i);var n=(e===Fi||e===Gi)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(i&&!i.cancelBubble||!i)&&this.parent&&this.parent.isListening()&&!n&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,i,r):this._fireAndBubble.call(this.parent,e,i))}}_getProtoListeners(e){var i,r,a;const n=(i=this._cache.get(Wt))!==null&&i!==void 0?i:{};let s=n?.[e];if(s===void 0){s=[];let h=Object.getPrototypeOf(this);for(;h;){const l=(a=(r=h.eventListeners)===null||r===void 0?void 0:r[e])!==null&&a!==void 0?a:[];s.push(...l),h=Object.getPrototypeOf(h)}n[e]=s,this._cache.set(Wt,n)}return s}_fire(e,i){i=i||{},i.currentTarget=this,i.type=e;const r=this._getProtoListeners(e);if(r)for(var a=0;a<r.length;a++)r[a].handler.call(this,i);const n=this.eventListeners[e];if(n)for(var a=0;a<n.length;a++)n[a].handler.call(this,i)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){var i=e?e.pointerId:void 0,r=this.getStage(),a=this.getAbsolutePosition();if(r){var n=r._getPointerById(i)||r._changedPointerPositions[0]||a;ke.DD._dragElements.set(this._id,{node:this,startPointerPos:n,offset:{x:n.x-a.x,y:n.y-a.y},dragStatus:"ready",pointerId:i})}}startDrag(e,i=!0){ke.DD._dragElements.has(this._id)||this._createDragElement(e);const r=ke.DD._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},i)}_setDragPosition(e,i){const r=this.getStage()._getPointerById(i.pointerId);if(r){var a={x:r.x-i.offset.x,y:r.y-i.offset.y},n=this.dragBoundFunc();if(n!==void 0){const s=n.call(this,a,e);s?a=s:B.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==a.x||this._lastPos.y!==a.y)&&(this.setAbsolutePosition(a),this._requestDraw()),this._lastPos=a}}stopDrag(e){const i=ke.DD._dragElements.get(this._id);i&&(i.dragStatus="stopped"),ke.DD._endDragBefore(e),ke.DD._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=ke.DD._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){var i=e.evt.button!==void 0,r=!i||$e.Konva.dragButtons.indexOf(e.evt.button)>=0;if(r&&!this.isDragging()){var a=!1;ke.DD._dragElements.forEach(n=>{this.isAncestorOf(n.node)&&(a=!0)}),a||this._createDragElement(e)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage();if(!e)return;const i=ke.DD._dragElements.get(this._id),r=i&&i.dragStatus==="dragging",a=i&&i.dragStatus==="ready";r?this.stopDrag():a&&ke.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const i=this.getStage();if(!i)return!1;const r={x:-e.x,y:-e.y,width:i.width()+2*e.x,height:i.height()+2*e.y};return B.Util.haveIntersection(r,this.getClientRect())}static create(e,i){return B.Util._isString(e)&&(e=JSON.parse(e)),this._createNode(e,i)}static _createNode(e,i){var r=F.prototype.getClassName.call(e),a=e.children,n,s,h;i&&(e.attrs.container=i),$e.Konva[r]||(B.Util.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const l=$e.Konva[r];if(n=new l(e.attrs),a)for(s=a.length,h=0;h<s;h++)n.add(F._createNode(a[h]));return n}}Ze.Node=F;F.prototype.nodeType="Node";F.prototype._attrsAffectingSize=[];F.prototype.eventListeners={};F.prototype.on.call(F.prototype,fa,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Xe),this._clearSelfAndDescendantCache(Re)});F.prototype.on.call(F.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(yi)});F.prototype.on.call(F.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(vi)});F.prototype.on.call(F.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Nt)});const N=xt.Factory.addGetterSetter;N(F,"zIndex");N(F,"absolutePosition");N(F,"position");N(F,"x",0,(0,ie.getNumberValidator)());N(F,"y",0,(0,ie.getNumberValidator)());N(F,"globalCompositeOperation","source-over",(0,ie.getStringValidator)());N(F,"opacity",1,(0,ie.getNumberValidator)());N(F,"name","",(0,ie.getStringValidator)());N(F,"id","",(0,ie.getStringValidator)());N(F,"rotation",0,(0,ie.getNumberValidator)());xt.Factory.addComponentsGetterSetter(F,"scale",["x","y"]);N(F,"scaleX",1,(0,ie.getNumberValidator)());N(F,"scaleY",1,(0,ie.getNumberValidator)());xt.Factory.addComponentsGetterSetter(F,"skew",["x","y"]);N(F,"skewX",0,(0,ie.getNumberValidator)());N(F,"skewY",0,(0,ie.getNumberValidator)());xt.Factory.addComponentsGetterSetter(F,"offset",["x","y"]);N(F,"offsetX",0,(0,ie.getNumberValidator)());N(F,"offsetY",0,(0,ie.getNumberValidator)());N(F,"dragDistance",null,(0,ie.getNumberValidator)());N(F,"width",0,(0,ie.getNumberValidator)());N(F,"height",0,(0,ie.getNumberValidator)());N(F,"listening",!0,(0,ie.getBooleanValidator)());N(F,"preventDefault",!0,(0,ie.getBooleanValidator)());N(F,"filters",null,function(t){return this._filterUpToDate=!1,t});N(F,"visible",!0,(0,ie.getBooleanValidator)());N(F,"transformsEnabled","all",(0,ie.getStringValidator)());N(F,"size");N(F,"dragBoundFunc");N(F,"draggable",!1,(0,ie.getBooleanValidator)());xt.Factory.backCompat(F,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var rt={};Object.defineProperty(rt,"__esModule",{value:!0});rt.Container=void 0;const _t=Me,di=Ze,Qt=U;class at extends di.Node{constructor(){super(...arguments),this.children=[]}getChildren(e){if(!e)return this.children||[];const i=this.children||[];var r=[];return i.forEach(function(a){e(a)&&r.push(a)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(var i=0;i<e.length;i++)this.add(e[i]);return this}const r=e[0];return r.getParent()?(r.moveTo(this),this):(this._validateAdd(r),r.index=this.getChildren().length,r.parent=this,r._clearCaches(),this.getChildren().push(r),this._fire("add",{child:r}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){var i=this._generalFind(e,!0);return i.length>0?i[0]:void 0}_generalFind(e,i){var r=[];return this._descendants(a=>{const n=a._isMatch(e);return n&&r.push(a),!!(n&&i)}),r}_descendants(e){let i=!1;const r=this.getChildren();for(const a of r){if(i=e(a),i)return!0;if(a.hasChildren()&&(i=a._descendants(e),i))return!0}return!1}toObject(){var e=di.Node.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(i=>{e.children.push(i.toObject())}),e}isAncestorOf(e){for(var i=e.getParent();i;){if(i._id===this._id)return!0;i=i.getParent()}return!1}clone(e){var i=di.Node.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){i.add(r.clone())}),i}getAllIntersections(e){var i=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(e)&&i.push(r)}),i}_clearSelfAndDescendantCache(e){var i;super._clearSelfAndDescendantCache(e),!this.isCached()&&((i=this.children)===null||i===void 0||i.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(i,r){i.index=r}),this._requestDraw()}drawScene(e,i){var r=this.getLayer(),a=e||r&&r.getCanvas(),n=a&&a.getContext(),s=this._getCanvasCache(),h=s&&s.scene,l=a&&a.isCache;if(!this.isVisible()&&!l)return this;if(h){n.save();var u=this.getAbsoluteTransform(i).getMatrix();n.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedSceneCanvas(n),n.restore()}else this._drawChildren("drawScene",a,i);return this}drawHit(e,i){if(!this.shouldDrawHit(i))return this;var r=this.getLayer(),a=e||r&&r.hitCanvas,n=a&&a.getContext(),s=this._getCanvasCache(),h=s&&s.hit;if(h){n.save();var l=this.getAbsoluteTransform(i).getMatrix();n.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(n),n.restore()}else this._drawChildren("drawHit",a,i);return this}_drawChildren(e,i,r){var a,n=i&&i.getContext(),s=this.clipWidth(),h=this.clipHeight(),l=this.clipFunc(),u=s&&h||l;const g=r===this;if(u){n.save();var w=this.getAbsoluteTransform(r),S=w.getMatrix();n.transform(S[0],S[1],S[2],S[3],S[4],S[5]),n.beginPath();let _;if(l)_=l.call(this,n,this);else{var c=this.clipX(),f=this.clipY();n.rect(c,f,s,h)}n.clip.apply(n,_),S=w.copy().invert().getMatrix(),n.transform(S[0],S[1],S[2],S[3],S[4],S[5])}var v=!g&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";v&&(n.save(),n._applyGlobalCompositeOperation(this)),(a=this.children)===null||a===void 0||a.forEach(function(_){_[e](i,r)}),v&&n.restore(),u&&n.restore()}getClientRect(e={}){var i,r=e.skipTransform,a=e.relativeTo,n,s,h,l,u={x:1/0,y:1/0,width:0,height:0},g=this;(i=this.children)===null||i===void 0||i.forEach(function(v){if(v.visible()){var _=v.getClientRect({relativeTo:g,skipShadow:e.skipShadow,skipStroke:e.skipStroke});_.width===0&&_.height===0||(n===void 0?(n=_.x,s=_.y,h=_.x+_.width,l=_.y+_.height):(n=Math.min(n,_.x),s=Math.min(s,_.y),h=Math.max(h,_.x+_.width),l=Math.max(l,_.y+_.height)))}});for(var w=this.find("Shape"),S=!1,c=0;c<w.length;c++){var f=w[c];if(f._isVisible(this)){S=!0;break}}return S&&n!==void 0?u={x:n,y:s,width:h-n,height:l-s}:u={x:0,y:0,width:0,height:0},r?u:this._transformedRect(u,a)}}rt.Container=at;_t.Factory.addComponentsGetterSetter(at,"clip",["x","y","width","height"]);_t.Factory.addGetterSetter(at,"clipX",void 0,(0,Qt.getNumberValidator)());_t.Factory.addGetterSetter(at,"clipY",void 0,(0,Qt.getNumberValidator)());_t.Factory.addGetterSetter(at,"clipWidth",void 0,(0,Qt.getNumberValidator)());_t.Factory.addGetterSetter(at,"clipHeight",void 0,(0,Qt.getNumberValidator)());_t.Factory.addGetterSetter(at,"clipFunc");var ar={},be={};Object.defineProperty(be,"__esModule",{value:!0});be.releaseCapture=be.setPointerCapture=be.hasPointerCapture=be.createEvent=be.getCapturedShape=void 0;const _a=te,Ct=new Map,nr=_a.Konva._global.PointerEvent!==void 0;function ca(t){return Ct.get(t)}be.getCapturedShape=ca;function Ti(t){return{evt:t,pointerId:t.pointerId}}be.createEvent=Ti;function pa(t,e){return Ct.get(t)===e}be.hasPointerCapture=pa;function ma(t,e){sr(t),e.getStage()&&(Ct.set(t,e),nr&&e._fire("gotpointercapture",Ti(new PointerEvent("gotpointercapture"))))}be.setPointerCapture=ma;function sr(t,e){const i=Ct.get(t);if(!i)return;const r=i.getStage();r&&r.content,Ct.delete(t),nr&&i._fire("lostpointercapture",Ti(new PointerEvent("lostpointercapture")))}be.releaseCapture=sr;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.stages=void 0;const e=ue,i=Me,r=rt,a=te,n=Pe,s=$t,h=te,l=be;var u="Stage",g="string",w="px",S="mouseout",c="mouseleave",f="mouseover",v="mouseenter",_="mousemove",T="mousedown",k="mouseup",o="pointermove",d="pointerdown",m="pointerup",C="pointercancel",E="lostpointercapture",y="pointerout",P="pointerleave",b="pointerover",A="pointerenter",O="contextmenu",D="touchstart",L="touchend",W="touchmove",oe="touchcancel",$="wheel",se=5,Q=[[v,"_pointerenter"],[T,"_pointerdown"],[_,"_pointermove"],[k,"_pointerup"],[c,"_pointerleave"],[D,"_pointerdown"],[W,"_pointermove"],[L,"_pointerup"],[oe,"_pointercancel"],[f,"_pointerover"],[$,"_wheel"],[O,"_contextmenu"],[d,"_pointerdown"],[o,"_pointermove"],[m,"_pointerup"],[C,"_pointercancel"],[E,"_lostpointercapture"]];const re={mouse:{[y]:S,[P]:c,[b]:f,[A]:v,[o]:_,[d]:T,[m]:k,[C]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[y]:"touchout",[P]:"touchleave",[b]:"touchover",[A]:"touchenter",[o]:W,[d]:D,[m]:L,[C]:oe,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[y]:y,[P]:P,[b]:b,[A]:A,[o]:o,[d]:d,[m]:m,[C]:C,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},z=we=>we.indexOf("pointer")>=0?"pointer":we.indexOf("touch")>=0?"touch":"mouse",pe=we=>{const p=z(we);if(p==="pointer")return a.Konva.pointerEventsEnabled&&re.pointer;if(p==="touch")return re.touch;if(p==="mouse")return re.mouse};function ge(we={}){return(we.clipFunc||we.clipWidth||we.clipHeight)&&e.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),we}const de="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";t.stages=[];class Oe extends r.Container{constructor(p){super(ge(p)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),t.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{ge(this.attrs)}),this._checkVisibility()}_validateAdd(p){const x=p.getType()==="Layer",M=p.getType()==="FastLayer";x||M||e.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const p=this.visible()?"":"none";this.content.style.display=p}setContainer(p){if(typeof p===g){if(p.charAt(0)==="."){var x=p.slice(1);p=document.getElementsByClassName(x)[0]}else{var M;p.charAt(0)!=="#"?M=p:M=p.slice(1),p=document.getElementById(M)}if(!p)throw"Can not find container in document with id "+M}return this._setAttr("container",p),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),p.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var p=this.children,x=p.length,M;for(M=0;M<x;M++)p[M].clear();return this}clone(p){return p||(p={}),p.container=typeof document<"u"&&document.createElement("div"),r.Container.prototype.clone.call(this,p)}destroy(){super.destroy();var p=this.content;p&&e.Util._isInDocument(p)&&this.container().removeChild(p);var x=t.stages.indexOf(this);return x>-1&&t.stages.splice(x,1),e.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const p=this._pointerPositions[0]||this._changedPointerPositions[0];return p?{x:p.x,y:p.y}:(e.Util.warn(de),null)}_getPointerById(p){return this._pointerPositions.find(x=>x.id===p)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(p){p=p||{},p.x=p.x||0,p.y=p.y||0,p.width=p.width||this.width(),p.height=p.height||this.height();var x=new n.SceneCanvas({width:p.width,height:p.height,pixelRatio:p.pixelRatio||1}),M=x.getContext()._context,K=this.children;return(p.x||p.y)&&M.translate(-1*p.x,-1*p.y),K.forEach(function(H){if(H.isVisible()){var ee=H._toKonvaCanvas(p);M.drawImage(ee._canvas,p.x,p.y,ee.getWidth()/ee.getPixelRatio(),ee.getHeight()/ee.getPixelRatio())}}),x}getIntersection(p){if(!p)return null;var x=this.children,M=x.length,K=M-1,H;for(H=K;H>=0;H--){const ee=x[H].getIntersection(p);if(ee)return ee}return null}_resizeDOM(){var p=this.width(),x=this.height();this.content&&(this.content.style.width=p+w,this.content.style.height=x+w),this.bufferCanvas.setSize(p,x),this.bufferHitCanvas.setSize(p,x),this.children.forEach(M=>{M.setSize({width:p,height:x}),M.draw()})}add(p,...x){if(arguments.length>1){for(var M=0;M<arguments.length;M++)this.add(arguments[M]);return this}super.add(p);var K=this.children.length;return K>se&&e.Util.warn("The stage has "+K+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),p.setSize({width:this.width(),height:this.height()}),p.draw(),a.Konva.isBrowser&&this.content.appendChild(p.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(p){return l.hasPointerCapture(p,this)}setPointerCapture(p){l.setPointerCapture(p,this)}releaseCapture(p){l.releaseCapture(p,this)}getLayers(){return this.children}_bindContentEvents(){a.Konva.isBrowser&&Q.forEach(([p,x])=>{this.content.addEventListener(p,M=>{this[x](M)},{passive:!1})})}_pointerenter(p){this.setPointersPositions(p);const x=pe(p.type);x&&this._fire(x.pointerenter,{evt:p,target:this,currentTarget:this})}_pointerover(p){this.setPointersPositions(p);const x=pe(p.type);x&&this._fire(x.pointerover,{evt:p,target:this,currentTarget:this})}_getTargetShape(p){let x=this[p+"targetShape"];return x&&!x.getStage()&&(x=null),x}_pointerleave(p){const x=pe(p.type),M=z(p.type);if(x){this.setPointersPositions(p);var K=this._getTargetShape(M),H=!s.DD.isDragging||a.Konva.hitOnDragEnabled;K&&H?(K._fireAndBubble(x.pointerout,{evt:p}),K._fireAndBubble(x.pointerleave,{evt:p}),this._fire(x.pointerleave,{evt:p,target:this,currentTarget:this}),this[M+"targetShape"]=null):H&&(this._fire(x.pointerleave,{evt:p,target:this,currentTarget:this}),this._fire(x.pointerout,{evt:p,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}}_pointerdown(p){const x=pe(p.type),M=z(p.type);if(x){this.setPointersPositions(p);var K=!1;this._changedPointerPositions.forEach(H=>{var ee=this.getIntersection(H);if(s.DD.justDragged=!1,a.Konva["_"+M+"ListenClick"]=!0,!ee||!ee.isListening())return;a.Konva.capturePointerEventsEnabled&&ee.setPointerCapture(H.id),this[M+"ClickStartShape"]=ee,ee._fireAndBubble(x.pointerdown,{evt:p,pointerId:H.id}),K=!0;const Te=p.type.indexOf("touch")>=0;ee.preventDefault()&&p.cancelable&&Te&&p.preventDefault()}),K||this._fire(x.pointerdown,{evt:p,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(p){const x=pe(p.type),M=z(p.type);if(!x)return;s.DD.isDragging&&s.DD.node.preventDefault()&&p.cancelable&&p.preventDefault(),this.setPointersPositions(p);var K=!s.DD.isDragging||a.Konva.hitOnDragEnabled;if(!K)return;var H={};let ee=!1;var Te=this._getTargetShape(M);this._changedPointerPositions.forEach(Ne=>{const Y=l.getCapturedShape(Ne.id)||this.getIntersection(Ne),lt=Ne.id,Fe={evt:p,pointerId:lt};var dt=Te!==Y;if(dt&&Te&&(Te._fireAndBubble(x.pointerout,{...Fe},Y),Te._fireAndBubble(x.pointerleave,{...Fe},Y)),Y){if(H[Y._id])return;H[Y._id]=!0}Y&&Y.isListening()?(ee=!0,dt&&(Y._fireAndBubble(x.pointerover,{...Fe},Te),Y._fireAndBubble(x.pointerenter,{...Fe},Te),this[M+"targetShape"]=Y),Y._fireAndBubble(x.pointermove,{...Fe})):Te&&(this._fire(x.pointerover,{evt:p,target:this,currentTarget:this,pointerId:lt}),this[M+"targetShape"]=null)}),ee||this._fire(x.pointermove,{evt:p,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(p){const x=pe(p.type),M=z(p.type);if(!x)return;this.setPointersPositions(p);const K=this[M+"ClickStartShape"],H=this[M+"ClickEndShape"];var ee={};let Te=!1;this._changedPointerPositions.forEach(Ne=>{const Y=l.getCapturedShape(Ne.id)||this.getIntersection(Ne);if(Y){if(Y.releaseCapture(Ne.id),ee[Y._id])return;ee[Y._id]=!0}const lt=Ne.id,Fe={evt:p,pointerId:lt};let dt=!1;a.Konva["_"+M+"InDblClickWindow"]?(dt=!0,clearTimeout(this[M+"DblTimeout"])):s.DD.justDragged||(a.Konva["_"+M+"InDblClickWindow"]=!0,clearTimeout(this[M+"DblTimeout"])),this[M+"DblTimeout"]=setTimeout(function(){a.Konva["_"+M+"InDblClickWindow"]=!1},a.Konva.dblClickWindow),Y&&Y.isListening()?(Te=!0,this[M+"ClickEndShape"]=Y,Y._fireAndBubble(x.pointerup,{...Fe}),a.Konva["_"+M+"ListenClick"]&&K&&K===Y&&(Y._fireAndBubble(x.pointerclick,{...Fe}),dt&&H&&H===Y&&Y._fireAndBubble(x.pointerdblclick,{...Fe}))):(this[M+"ClickEndShape"]=null,a.Konva["_"+M+"ListenClick"]&&this._fire(x.pointerclick,{evt:p,target:this,currentTarget:this,pointerId:lt}),dt&&this._fire(x.pointerdblclick,{evt:p,target:this,currentTarget:this,pointerId:lt}))}),Te||this._fire(x.pointerup,{evt:p,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),a.Konva["_"+M+"ListenClick"]=!1,p.cancelable&&M!=="touch"&&p.preventDefault()}_contextmenu(p){this.setPointersPositions(p);var x=this.getIntersection(this.getPointerPosition());x&&x.isListening()?x._fireAndBubble(O,{evt:p}):this._fire(O,{evt:p,target:this,currentTarget:this})}_wheel(p){this.setPointersPositions(p);var x=this.getIntersection(this.getPointerPosition());x&&x.isListening()?x._fireAndBubble($,{evt:p}):this._fire($,{evt:p,target:this,currentTarget:this})}_pointercancel(p){this.setPointersPositions(p);const x=l.getCapturedShape(p.pointerId)||this.getIntersection(this.getPointerPosition());x&&x._fireAndBubble(m,l.createEvent(p)),l.releaseCapture(p.pointerId)}_lostpointercapture(p){l.releaseCapture(p.pointerId)}setPointersPositions(p){var x=this._getContentPosition(),M=null,K=null;p=p||window.event,p.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(p.touches,H=>{this._pointerPositions.push({id:H.identifier,x:(H.clientX-x.left)/x.scaleX,y:(H.clientY-x.top)/x.scaleY})}),Array.prototype.forEach.call(p.changedTouches||p.touches,H=>{this._changedPointerPositions.push({id:H.identifier,x:(H.clientX-x.left)/x.scaleX,y:(H.clientY-x.top)/x.scaleY})})):(M=(p.clientX-x.left)/x.scaleX,K=(p.clientY-x.top)/x.scaleY,this.pointerPos={x:M,y:K},this._pointerPositions=[{x:M,y:K,id:e.Util._getFirstPointerId(p)}],this._changedPointerPositions=[{x:M,y:K,id:e.Util._getFirstPointerId(p)}])}_setPointerPosition(p){e.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(p)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var p=this.content.getBoundingClientRect();return{top:p.top,left:p.left,scaleX:p.width/this.content.clientWidth||1,scaleY:p.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new n.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new n.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!a.Konva.isBrowser){var p=this.container();if(!p)throw"Stage has no container. A container is required.";p.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),p.appendChild(this.content),this._resizeDOM()}}cache(){return e.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(p){p.batchDraw()}),this}}t.Stage=Oe,Oe.prototype.nodeType=u,(0,h._registerNode)(Oe),i.Factory.addGetterSetter(Oe,"container")})(ar);var At={},ct={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=t.shapes=void 0;const e=te,i=ue,r=Me,a=Ze,n=U,s=te,h=be;var l="hasShadow",u="shadowRGBA",g="patternImage",w="linearGradient",S="radialGradient";let c;function f(){return c||(c=i.Util.createCanvasElement().getContext("2d"),c)}t.shapes={};function v(P){const b=this.attrs.fillRule;b?P.fill(b):P.fill()}function _(P){P.stroke()}function T(P){P.fill()}function k(P){P.stroke()}function o(){this._clearCache(l)}function d(){this._clearCache(u)}function m(){this._clearCache(g)}function C(){this._clearCache(w)}function E(){this._clearCache(S)}class y extends a.Node{constructor(b){super(b);let A;for(;A=i.Util.getRandomColor(),!(A&&!(A in t.shapes)););this.colorKey=A,t.shapes[A]=this}getContext(){return i.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return i.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(g,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var b=f();const A=b.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(A&&A.setTransform){const O=new i.Transform;O.translate(this.fillPatternX(),this.fillPatternY()),O.rotate(e.Konva.getAngle(this.fillPatternRotation())),O.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),O.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const D=O.getMatrix(),L=typeof DOMMatrix>"u"?{a:D[0],b:D[1],c:D[2],d:D[3],e:D[4],f:D[5]}:new DOMMatrix(D);A.setTransform(L)}return A}}_getLinearGradient(){return this._getCache(w,this.__getLinearGradient)}__getLinearGradient(){var b=this.fillLinearGradientColorStops();if(b){for(var A=f(),O=this.fillLinearGradientStartPoint(),D=this.fillLinearGradientEndPoint(),L=A.createLinearGradient(O.x,O.y,D.x,D.y),W=0;W<b.length;W+=2)L.addColorStop(b[W],b[W+1]);return L}}_getRadialGradient(){return this._getCache(S,this.__getRadialGradient)}__getRadialGradient(){var b=this.fillRadialGradientColorStops();if(b){for(var A=f(),O=this.fillRadialGradientStartPoint(),D=this.fillRadialGradientEndPoint(),L=A.createRadialGradient(O.x,O.y,this.fillRadialGradientStartRadius(),D.x,D.y,this.fillRadialGradientEndRadius()),W=0;W<b.length;W+=2)L.addColorStop(b[W],b[W+1]);return L}}getShadowRGBA(){return this._getCache(u,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var b=i.Util.colorToRGBA(this.shadowColor());if(b)return"rgba("+b.r+","+b.g+","+b.b+","+b.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const b=this.hitStrokeWidth();return b==="auto"?this.hasStroke():this.strokeEnabled()&&!!b}intersects(b){var A=this.getStage();if(!A)return!1;const O=A.bufferHitCanvas;return O.getContext().clear(),this.drawHit(O,void 0,!0),O.context.getImageData(Math.round(b.x),Math.round(b.y),1,1).data[3]>0}destroy(){return a.Node.prototype.destroy.call(this),delete t.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(b){var A;if(!this.getStage()||!((A=this.attrs.perfectDrawEnabled)!==null&&A!==void 0?A:!0))return!1;const D=b||this.hasFill(),L=this.hasStroke(),W=this.getAbsoluteOpacity()!==1;if(D&&L&&W)return!0;const oe=this.hasShadow(),$=this.shadowForStrokeEnabled();return!!(D&&L&&oe&&$)}setStrokeHitEnabled(b){i.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),b?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var b=this.size();return{x:this._centroid?-b.width/2:0,y:this._centroid?-b.height/2:0,width:b.width,height:b.height}}getClientRect(b={}){const A=b.skipTransform,O=b.relativeTo,D=this.getSelfRect(),W=!b.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,oe=D.width+W,$=D.height+W,se=!b.skipShadow&&this.hasShadow(),Q=se?this.shadowOffsetX():0,re=se?this.shadowOffsetY():0,z=oe+Math.abs(Q),pe=$+Math.abs(re),ge=se&&this.shadowBlur()||0,de=z+ge*2,Oe=pe+ge*2,we={width:de,height:Oe,x:-(W/2+ge)+Math.min(Q,0)+D.x,y:-(W/2+ge)+Math.min(re,0)+D.y};return A?we:this._transformedRect(we,O)}drawScene(b,A){var O=this.getLayer(),D=b||O.getCanvas(),L=D.getContext(),W=this._getCanvasCache(),oe=this.getSceneFunc(),$=this.hasShadow(),se,Q,re,z=D.isCache,pe=A===this;if(!this.isVisible()&&!pe)return this;if(W){L.save();var ge=this.getAbsoluteTransform(A).getMatrix();return L.transform(ge[0],ge[1],ge[2],ge[3],ge[4],ge[5]),this._drawCachedSceneCanvas(L),L.restore(),this}if(!oe)return this;if(L.save(),this._useBufferCanvas()&&!z){se=this.getStage(),Q=se.bufferCanvas,re=Q.getContext(),re.clear(),re.save(),re._applyLineJoin(this);var de=this.getAbsoluteTransform(A).getMatrix();re.transform(de[0],de[1],de[2],de[3],de[4],de[5]),oe.call(this,re,this),re.restore();var Oe=Q.pixelRatio;$&&L._applyShadow(this),L._applyOpacity(this),L._applyGlobalCompositeOperation(this),L.drawImage(Q._canvas,0,0,Q.width/Oe,Q.height/Oe)}else{if(L._applyLineJoin(this),!pe){var de=this.getAbsoluteTransform(A).getMatrix();L.transform(de[0],de[1],de[2],de[3],de[4],de[5]),L._applyOpacity(this),L._applyGlobalCompositeOperation(this)}$&&L._applyShadow(this),oe.call(this,L,this)}return L.restore(),this}drawHit(b,A,O=!1){if(!this.shouldDrawHit(A,O))return this;var D=this.getLayer(),L=b||D.hitCanvas,W=L&&L.getContext(),oe=this.hitFunc()||this.sceneFunc(),$=this._getCanvasCache(),se=$&&$.hit;if(this.colorKey||i.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),se){W.save();var Q=this.getAbsoluteTransform(A).getMatrix();return W.transform(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5]),this._drawCachedHitCanvas(W),W.restore(),this}if(!oe)return this;if(W.save(),W._applyLineJoin(this),!(this===A)){var z=this.getAbsoluteTransform(A).getMatrix();W.transform(z[0],z[1],z[2],z[3],z[4],z[5])}return oe.call(this,W,this),W.restore(),this}drawHitFromCache(b=0){var A=this._getCanvasCache(),O=this._getCachedSceneCanvas(),D=A.hit,L=D.getContext(),W=D.getWidth(),oe=D.getHeight(),$,se,Q,re,z,pe;L.clear(),L.drawImage(O._canvas,0,0,W,oe);try{for($=L.getImageData(0,0,W,oe),se=$.data,Q=se.length,re=i.Util._hexToRgb(this.colorKey),z=0;z<Q;z+=4)pe=se[z+3],pe>b?(se[z]=re.r,se[z+1]=re.g,se[z+2]=re.b,se[z+3]=255):se[z+3]=0;L.putImageData($,0,0)}catch(ge){i.Util.error("Unable to draw hit graph from cached scene canvas. "+ge.message)}return this}hasPointerCapture(b){return h.hasPointerCapture(b,this)}setPointerCapture(b){h.setPointerCapture(b,this)}releaseCapture(b){h.releaseCapture(b,this)}}t.Shape=y,y.prototype._fillFunc=v,y.prototype._strokeFunc=_,y.prototype._fillFuncHit=T,y.prototype._strokeFuncHit=k,y.prototype._centroid=!1,y.prototype.nodeType="Shape",(0,s._registerNode)(y),y.prototype.eventListeners={},y.prototype.on.call(y.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",o),y.prototype.on.call(y.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",d),y.prototype.on.call(y.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",m),y.prototype.on.call(y.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",C),y.prototype.on.call(y.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",E),r.Factory.addGetterSetter(y,"stroke",void 0,(0,n.getStringOrGradientValidator)()),r.Factory.addGetterSetter(y,"strokeWidth",2,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"fillAfterStrokeEnabled",!1),r.Factory.addGetterSetter(y,"hitStrokeWidth","auto",(0,n.getNumberOrAutoValidator)()),r.Factory.addGetterSetter(y,"strokeHitEnabled",!0,(0,n.getBooleanValidator)()),r.Factory.addGetterSetter(y,"perfectDrawEnabled",!0,(0,n.getBooleanValidator)()),r.Factory.addGetterSetter(y,"shadowForStrokeEnabled",!0,(0,n.getBooleanValidator)()),r.Factory.addGetterSetter(y,"lineJoin"),r.Factory.addGetterSetter(y,"lineCap"),r.Factory.addGetterSetter(y,"sceneFunc"),r.Factory.addGetterSetter(y,"hitFunc"),r.Factory.addGetterSetter(y,"dash"),r.Factory.addGetterSetter(y,"dashOffset",0,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"shadowColor",void 0,(0,n.getStringValidator)()),r.Factory.addGetterSetter(y,"shadowBlur",0,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"shadowOpacity",1,(0,n.getNumberValidator)()),r.Factory.addComponentsGetterSetter(y,"shadowOffset",["x","y"]),r.Factory.addGetterSetter(y,"shadowOffsetX",0,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"shadowOffsetY",0,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"fillPatternImage"),r.Factory.addGetterSetter(y,"fill",void 0,(0,n.getStringOrGradientValidator)()),r.Factory.addGetterSetter(y,"fillPatternX",0,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"fillPatternY",0,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"fillLinearGradientColorStops"),r.Factory.addGetterSetter(y,"strokeLinearGradientColorStops"),r.Factory.addGetterSetter(y,"fillRadialGradientStartRadius",0),r.Factory.addGetterSetter(y,"fillRadialGradientEndRadius",0),r.Factory.addGetterSetter(y,"fillRadialGradientColorStops"),r.Factory.addGetterSetter(y,"fillPatternRepeat","repeat"),r.Factory.addGetterSetter(y,"fillEnabled",!0),r.Factory.addGetterSetter(y,"strokeEnabled",!0),r.Factory.addGetterSetter(y,"shadowEnabled",!0),r.Factory.addGetterSetter(y,"dashEnabled",!0),r.Factory.addGetterSetter(y,"strokeScaleEnabled",!0),r.Factory.addGetterSetter(y,"fillPriority","color"),r.Factory.addComponentsGetterSetter(y,"fillPatternOffset",["x","y"]),r.Factory.addGetterSetter(y,"fillPatternOffsetX",0,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"fillPatternOffsetY",0,(0,n.getNumberValidator)()),r.Factory.addComponentsGetterSetter(y,"fillPatternScale",["x","y"]),r.Factory.addGetterSetter(y,"fillPatternScaleX",1,(0,n.getNumberValidator)()),r.Factory.addGetterSetter(y,"fillPatternScaleY",1,(0,n.getNumberValidator)()),r.Factory.addComponentsGetterSetter(y,"fillLinearGradientStartPoint",["x","y"]),r.Factory.addComponentsGetterSetter(y,"strokeLinearGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(y,"fillLinearGradientStartPointX",0),r.Factory.addGetterSetter(y,"strokeLinearGradientStartPointX",0),r.Factory.addGetterSetter(y,"fillLinearGradientStartPointY",0),r.Factory.addGetterSetter(y,"strokeLinearGradientStartPointY",0),r.Factory.addComponentsGetterSetter(y,"fillLinearGradientEndPoint",["x","y"]),r.Factory.addComponentsGetterSetter(y,"strokeLinearGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(y,"fillLinearGradientEndPointX",0),r.Factory.addGetterSetter(y,"strokeLinearGradientEndPointX",0),r.Factory.addGetterSetter(y,"fillLinearGradientEndPointY",0),r.Factory.addGetterSetter(y,"strokeLinearGradientEndPointY",0),r.Factory.addComponentsGetterSetter(y,"fillRadialGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(y,"fillRadialGradientStartPointX",0),r.Factory.addGetterSetter(y,"fillRadialGradientStartPointY",0),r.Factory.addComponentsGetterSetter(y,"fillRadialGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(y,"fillRadialGradientEndPointX",0),r.Factory.addGetterSetter(y,"fillRadialGradientEndPointY",0),r.Factory.addGetterSetter(y,"fillPatternRotation",0),r.Factory.addGetterSetter(y,"fillRule",void 0,(0,n.getStringValidator)()),r.Factory.backCompat(y,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(ct);Object.defineProperty(At,"__esModule",{value:!0});At.Layer=void 0;const Ge=ue,ui=rt,ut=Ze,ki=Me,Ui=Pe,va=U,ya=ct,wa=te;var ba="#",Sa="beforeDraw",Ca="draw",or=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Ta=or.length;class pt extends ui.Container{constructor(e){super(e),this.canvas=new Ui.SceneCanvas,this.hitCanvas=new Ui.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);var i=this.getStage();return i&&i.content&&(i.content.removeChild(this.getNativeCanvasElement()),e<i.children.length-1?i.content.insertBefore(this.getNativeCanvasElement(),i.children[e+1].getCanvas()._canvas):i.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){ut.Node.prototype.moveToTop.call(this);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var e=ut.Node.prototype.moveUp.call(this);if(!e)return!1;var i=this.getStage();return!i||!i.content?!1:(i.content.removeChild(this.getNativeCanvasElement()),this.index<i.children.length-1?i.content.insertBefore(this.getNativeCanvasElement(),i.children[this.index+1].getCanvas()._canvas):i.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(ut.Node.prototype.moveDown.call(this)){var e=this.getStage();if(e){var i=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),i[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(ut.Node.prototype.moveToBottom.call(this)){var e=this.getStage();if(e){var i=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),i[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var e=this.getNativeCanvasElement();return ut.Node.prototype.remove.call(this),e&&e.parentNode&&Ge.Util._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:i}){return this.canvas.setSize(e,i),this.hitCanvas.setSize(e,i),this._setSmoothEnabled(),this}_validateAdd(e){var i=e.getType();i!=="Group"&&i!=="Shape"&&Ge.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e=e||{},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),ut.Node.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Ge.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Ge.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Ge.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;for(var i=1,r=!1;;){for(let a=0;a<Ta;a++){const n=or[a],s=this._getIntersection({x:e.x+n.x*i,y:e.y+n.y*i}),h=s.shape;if(h)return h;if(r=!!s.antialiased,!s.antialiased)break}if(r)i+=1;else return null}}_getIntersection(e){const i=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(e.x*i),Math.round(e.y*i),1,1).data,a=r[3];if(a===255){const n=Ge.Util._rgbToHex(r[0],r[1],r[2]),s=ya.shapes[ba+n];return s?{shape:s}:{antialiased:!0}}else if(a>0)return{antialiased:!0};return{}}drawScene(e,i){var r=this.getLayer(),a=e||r&&r.getCanvas();return this._fire(Sa,{node:this}),this.clearBeforeDraw()&&a.getContext().clear(),ui.Container.prototype.drawScene.call(this,a,i),this._fire(Ca,{node:this}),this}drawHit(e,i){var r=this.getLayer(),a=e||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),ui.Container.prototype.drawHit.call(this,a,i),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){Ge.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return Ge.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var e=this.parent,i=!!this.hitCanvas._canvas.parentNode;i?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}}destroy(){return Ge.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}At.Layer=pt;pt.prototype.nodeType="Layer";(0,wa._registerNode)(pt);ki.Factory.addGetterSetter(pt,"imageSmoothingEnabled",!0);ki.Factory.addGetterSetter(pt,"clearBeforeDraw",!0);ki.Factory.addGetterSetter(pt,"hitGraphEnabled",!0,(0,va.getBooleanValidator)());var ei={};Object.defineProperty(ei,"__esModule",{value:!0});ei.FastLayer=void 0;const ka=ue,xa=At,Aa=te;class xi extends xa.Layer{constructor(e){super(e),this.listening(!1),ka.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}ei.FastLayer=xi;xi.prototype.nodeType="FastLayer";(0,Aa._registerNode)(xi);var ti={};Object.defineProperty(ti,"__esModule",{value:!0});ti.Group=void 0;const Pa=ue,Ea=rt,Da=te;class Ai extends Ea.Container{_validateAdd(e){var i=e.getType();i!=="Group"&&i!=="Shape"&&Pa.Util.throw("You may only add groups and shapes to groups.")}}ti.Group=Ai;Ai.prototype.nodeType="Group";(0,Da._registerNode)(Ai);var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});var hr=Pt.Animation=void 0;const fi=te,Vi=ue,gi=function(){return fi.glob.performance&&fi.glob.performance.now?function(){return fi.glob.performance.now()}:function(){return new Date().getTime()}}();class Ie{constructor(e,i){this.id=Ie.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:gi(),frameRate:0},this.func=e,this.setLayers(i)}setLayers(e){let i=[];return e&&(i=Array.isArray(e)?e:[e]),this.layers=i,this}getLayers(){return this.layers}addLayer(e){const i=this.layers,r=i.length;for(let a=0;a<r;a++)if(i[a]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const i=Ie.animations,r=i.length;for(let a=0;a<r;a++)if(i[a].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=gi(),Ie._addAnimation(this),this}stop(){return Ie._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const i=e.id,r=this.animations,a=r.length;for(let n=0;n<a;n++)if(r[n].id===i){this.animations.splice(n,1);break}}static _runFrames(){const e={},i=this.animations;for(let r=0;r<i.length;r++){const a=i[r],n=a.layers,s=a.func;a._updateFrameObject(gi());const h=n.length;let l;if(s?l=s.call(a,a.frame)!==!1:l=!0,!!l)for(let u=0;u<h;u++){const g=n[u];g._id!==void 0&&(e[g._id]=g)}}for(let r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){const e=Ie;e.animations.length?(e._runFrames(),Vi.Util.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,Vi.Util.requestAnimFrame(this._animationLoop))}}hr=Pt.Animation=Ie;Ie.animations=[];Ie.animIdCounter=0;Ie.animRunning=!1;var lr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Easings=t.Tween=void 0;const e=ue,i=Pt,r=Ze,a=te;var n={node:1,duration:1,easing:1,onFinish:1,yoyo:1},s=1,h=2,l=3,u=0,g=["fill","stroke","shadowColor"];class w{constructor(f,v,_,T,k,o,d){this.prop=f,this.propFunc=v,this.begin=T,this._pos=T,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=d,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=_,this._change=k-this.begin,this.pause()}fire(f){var v=this[f];v&&v()}setTime(f){f>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():f<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=f,this.update())}getTime(){return this._time}setPosition(f){this.prevPos=this._pos,this.propFunc(f),this._pos=f}getPosition(f){return f===void 0&&(f=this._time),this.func(f,this.begin,this._change,this.duration)}play(){this.state=h,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(f){this.pause(),this._time=f,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var f=this.getTimer()-this._startTime;this.state===h?this.setTime(f):this.state===l&&this.setTime(this.duration-f)}pause(){this.state=s,this.fire("onPause")}getTimer(){return new Date().getTime()}}class S{constructor(f){var v=this,_=f.node,T=_._id,k,o=f.easing||t.Easings.Linear,d=!!f.yoyo,m;typeof f.duration>"u"?k=.3:f.duration===0?k=.001:k=f.duration,this.node=_,this._id=u++;var C=_.getLayer()||(_ instanceof a.Konva.Stage?_.getLayers():null);C||e.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new i.Animation(function(){v.tween.onEnterFrame()},C),this.tween=new w(m,function(E){v._tweenFunc(E)},o,0,1,k*1e3,d),this._addListeners(),S.attrs[T]||(S.attrs[T]={}),S.attrs[T][this._id]||(S.attrs[T][this._id]={}),S.tweens[T]||(S.tweens[T]={});for(m in f)n[m]===void 0&&this._addAttr(m,f[m]);this.reset(),this.onFinish=f.onFinish,this.onReset=f.onReset,this.onUpdate=f.onUpdate}_addAttr(f,v){var _=this.node,T=_._id,k,o,d,m,C,E,y,P;if(d=S.tweens[T][f],d&&delete S.attrs[T][d][f],k=_.getAttr(f),e.Util._isArray(v))if(o=[],C=Math.max(v.length,k.length),f==="points"&&v.length!==k.length&&(v.length>k.length?(y=k,k=e.Util._prepareArrayForTween(k,v,_.closed())):(E=v,v=e.Util._prepareArrayForTween(v,k,_.closed()))),f.indexOf("fill")===0)for(m=0;m<C;m++)if(m%2===0)o.push(v[m]-k[m]);else{var b=e.Util.colorToRGBA(k[m]);P=e.Util.colorToRGBA(v[m]),k[m]=b,o.push({r:P.r-b.r,g:P.g-b.g,b:P.b-b.b,a:P.a-b.a})}else for(m=0;m<C;m++)o.push(v[m]-k[m]);else g.indexOf(f)!==-1?(k=e.Util.colorToRGBA(k),P=e.Util.colorToRGBA(v),o={r:P.r-k.r,g:P.g-k.g,b:P.b-k.b,a:P.a-k.a}):o=v-k;S.attrs[T][this._id][f]={start:k,diff:o,end:v,trueEnd:E,trueStart:y},S.tweens[T][f]=this._id}_tweenFunc(f){var v=this.node,_=S.attrs[v._id][this._id],T,k,o,d,m,C,E,y;for(T in _){if(k=_[T],o=k.start,d=k.diff,y=k.end,e.Util._isArray(o))if(m=[],E=Math.max(o.length,y.length),T.indexOf("fill")===0)for(C=0;C<E;C++)C%2===0?m.push((o[C]||0)+d[C]*f):m.push("rgba("+Math.round(o[C].r+d[C].r*f)+","+Math.round(o[C].g+d[C].g*f)+","+Math.round(o[C].b+d[C].b*f)+","+(o[C].a+d[C].a*f)+")");else for(C=0;C<E;C++)m.push((o[C]||0)+d[C]*f);else g.indexOf(T)!==-1?m="rgba("+Math.round(o.r+d.r*f)+","+Math.round(o.g+d.g*f)+","+Math.round(o.b+d.b*f)+","+(o.a+d.a*f)+")":m=o+d*f;v.setAttr(T,m)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var f=this.node,v=S.attrs[f._id][this._id];v.points&&v.points.trueEnd&&f.setAttr("points",v.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var f=this.node,v=S.attrs[f._id][this._id];v.points&&v.points.trueStart&&f.points(v.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(f){return this.tween.seek(f*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var f=this.node._id,v=this._id,_=S.tweens[f],T;this.pause();for(T in _)delete S.tweens[f][T];delete S.attrs[f][v]}}t.Tween=S,S.attrs={},S.tweens={},r.Node.prototype.to=function(c){var f=c.onFinish;c.node=this,c.onFinish=function(){this.destroy(),f&&f()};var v=new S(c);v.play()},t.Easings={BackEaseIn(c,f,v,_){var T=1.70158;return v*(c/=_)*c*((T+1)*c-T)+f},BackEaseOut(c,f,v,_){var T=1.70158;return v*((c=c/_-1)*c*((T+1)*c+T)+1)+f},BackEaseInOut(c,f,v,_){var T=1.70158;return(c/=_/2)<1?v/2*(c*c*(((T*=1.525)+1)*c-T))+f:v/2*((c-=2)*c*(((T*=1.525)+1)*c+T)+2)+f},ElasticEaseIn(c,f,v,_,T,k){var o=0;return c===0?f:(c/=_)===1?f+v:(k||(k=_*.3),!T||T<Math.abs(v)?(T=v,o=k/4):o=k/(2*Math.PI)*Math.asin(v/T),-(T*Math.pow(2,10*(c-=1))*Math.sin((c*_-o)*(2*Math.PI)/k))+f)},ElasticEaseOut(c,f,v,_,T,k){var o=0;return c===0?f:(c/=_)===1?f+v:(k||(k=_*.3),!T||T<Math.abs(v)?(T=v,o=k/4):o=k/(2*Math.PI)*Math.asin(v/T),T*Math.pow(2,-10*c)*Math.sin((c*_-o)*(2*Math.PI)/k)+v+f)},ElasticEaseInOut(c,f,v,_,T,k){var o=0;return c===0?f:(c/=_/2)===2?f+v:(k||(k=_*(.3*1.5)),!T||T<Math.abs(v)?(T=v,o=k/4):o=k/(2*Math.PI)*Math.asin(v/T),c<1?-.5*(T*Math.pow(2,10*(c-=1))*Math.sin((c*_-o)*(2*Math.PI)/k))+f:T*Math.pow(2,-10*(c-=1))*Math.sin((c*_-o)*(2*Math.PI)/k)*.5+v+f)},BounceEaseOut(c,f,v,_){return(c/=_)<1/2.75?v*(7.5625*c*c)+f:c<2/2.75?v*(7.5625*(c-=1.5/2.75)*c+.75)+f:c<2.5/2.75?v*(7.5625*(c-=2.25/2.75)*c+.9375)+f:v*(7.5625*(c-=2.625/2.75)*c+.984375)+f},BounceEaseIn(c,f,v,_){return v-t.Easings.BounceEaseOut(_-c,0,v,_)+f},BounceEaseInOut(c,f,v,_){return c<_/2?t.Easings.BounceEaseIn(c*2,0,v,_)*.5+f:t.Easings.BounceEaseOut(c*2-_,0,v,_)*.5+v*.5+f},EaseIn(c,f,v,_){return v*(c/=_)*c+f},EaseOut(c,f,v,_){return-v*(c/=_)*(c-2)+f},EaseInOut(c,f,v,_){return(c/=_/2)<1?v/2*c*c+f:-v/2*(--c*(c-2)-1)+f},StrongEaseIn(c,f,v,_){return v*(c/=_)*c*c*c*c+f},StrongEaseOut(c,f,v,_){return v*((c=c/_-1)*c*c*c*c+1)+f},StrongEaseInOut(c,f,v,_){return(c/=_/2)<1?v/2*c*c*c*c*c+f:v/2*((c-=2)*c*c*c*c+2)+f},Linear(c,f,v,_){return v*c/_+f}}})(lr);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Konva=void 0;const e=te,i=ue,r=Ze,a=rt,n=ar,s=At,h=ei,l=ti,u=$t,g=ct,w=Pt,S=lr,c=We,f=Pe;t.Konva=i.Util._assign(e.Konva,{Util:i.Util,Transform:i.Transform,Node:r.Node,Container:a.Container,Stage:n.Stage,stages:n.stages,Layer:s.Layer,FastLayer:h.FastLayer,Group:l.Group,DD:u.DD,Shape:g.Shape,shapes:g.shapes,Animation:w.Animation,Tween:S.Tween,Easings:S.Easings,Context:c.Context,Canvas:f.Canvas}),t.default=t.Konva})(mi);(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;var i=mi;Object.defineProperty(e,"Konva",{enumerable:!0,get:function(){return i.Konva}});const r=mi;t.exports=r.Konva})(pi,pi.exports);var Ia=pi.exports;const ne=Mr(Ia);var Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});var ii=Pi.Line=void 0;const ri=Me,Ma=ct,dr=U,La=te;function wi(t,e,i,r,a,n,s){var h=Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2)),l=Math.sqrt(Math.pow(a-i,2)+Math.pow(n-r,2)),u=s*h/(h+l),g=s*l/(h+l),w=i-u*(a-t),S=r-u*(n-e),c=i+g*(a-t),f=r+g*(n-e);return[w,S,c,f]}function Hi(t,e){var i=t.length,r=[],a,n;for(a=2;a<i-2;a+=2)n=wi(t[a-2],t[a-1],t[a],t[a+1],t[a+2],t[a+3],e),!isNaN(n[0])&&(r.push(n[0]),r.push(n[1]),r.push(t[a]),r.push(t[a+1]),r.push(n[2]),r.push(n[3]));return r}class Ke extends Ma.Shape{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){var i=this.points(),r=i.length,a=this.tension(),n=this.closed(),s=this.bezier(),h,l,u;if(r){if(e.beginPath(),e.moveTo(i[0],i[1]),a!==0&&r>4){for(h=this.getTensionPoints(),l=h.length,u=n?0:4,n||e.quadraticCurveTo(h[0],h[1],h[2],h[3]);u<l-2;)e.bezierCurveTo(h[u++],h[u++],h[u++],h[u++],h[u++],h[u++]);n||e.quadraticCurveTo(h[l-2],h[l-1],i[r-2],i[r-1])}else if(s)for(u=2;u<r;)e.bezierCurveTo(i[u++],i[u++],i[u++],i[u++],i[u++],i[u++]);else for(u=2;u<r;u+=2)e.lineTo(i[u],i[u+1]);n?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Hi(this.points(),this.tension())}_getTensionPointsClosed(){var e=this.points(),i=e.length,r=this.tension(),a=wi(e[i-2],e[i-1],e[0],e[1],e[2],e[3],r),n=wi(e[i-4],e[i-3],e[i-2],e[i-1],e[0],e[1],r),s=Hi(e,r),h=[a[2],a[3]].concat(s).concat([n[0],n[1],e[i-2],e[i-1],n[2],n[3],a[0],a[1],e[0],e[1]]);return h}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();for(var i=e[0],r=e[0],a=e[1],n=e[1],s,h,l=0;l<e.length/2;l++)s=e[l*2],h=e[l*2+1],i=Math.min(i,s),r=Math.max(r,s),a=Math.min(a,h),n=Math.max(n,h);return{x:i,y:a,width:r-i,height:n-a}}}ii=Pi.Line=Ke;Ke.prototype.className="Line";Ke.prototype._attrsAffectingSize=["points","bezier","tension"];(0,La._registerNode)(Ke);ri.Factory.addGetterSetter(Ke,"closed",!1);ri.Factory.addGetterSetter(Ke,"bezier",!1);ri.Factory.addGetterSetter(Ke,"tension",0,(0,dr.getNumberValidator)());ri.Factory.addGetterSetter(Ke,"points",[],(0,dr.getNumberArrayValidator)());var Ei={};Object.defineProperty(Ei,"__esModule",{value:!0});var mt=Ei.Rect=void 0;const Oa=Me,Fa=ct,Ga=te,Ra=ue,Wa=U;class ai extends Fa.Shape{_sceneFunc(e){var i=this.cornerRadius(),r=this.width(),a=this.height();e.beginPath(),i?Ra.Util.drawRoundedRectPath(e,r,a,i):e.rect(0,0,r,a),e.closePath(),e.fillStrokeShape(this)}}mt=Ei.Rect=ai;ai.prototype.className="Rect";(0,Ga._registerNode)(ai);Oa.Factory.addGetterSetter(ai,"cornerRadius",0,(0,Wa.getNumberOrArrayOfNumbersValidator)(4));var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});var tt=Tt.Text=Tt.stringToArray=void 0;const bi=ue,ce=Me,Ba=ct,je=U,Ua=te;function ur(t){return Array.from(t)}Tt.stringToArray=ur;var ft="auto",Va="center",fr="inherit",wt="justify",Ha="Change.konva",Na="2d",Ni="-",gr="left",Xa="text",za="Text",Ya="top",Za="bottom",Xi="middle",_r="normal",Ka="px ",Bt=" ",ja="right",zi="rtl",Ja="word",qa="char",Yi="none",_i="…",cr=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],$a=cr.length;function Qa(t){return t.split(",").map(e=>{e=e.trim();const i=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return i&&!r&&(e=`"${e}"`),e}).join(", ")}var Ut;function ci(){return Ut||(Ut=bi.Util.createCanvasElement().getContext(Na),Ut)}function en(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)}function tn(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function rn(t){return t=t||{},!t.fillLinearGradientColorStops&&!t.fillRadialGradientColorStops&&!t.fillPatternImage&&(t.fill=t.fill||"black"),t}class q extends Ba.Shape{constructor(e){super(rn(e)),this._partialTextX=0,this._partialTextY=0;for(var i=0;i<$a;i++)this.on(cr[i]+Ha,this._setTextData);this._setTextData()}_sceneFunc(e){var i=this.textArr,r=i.length;if(this.text()){var a=this.padding(),n=this.fontSize(),s=this.lineHeight()*n,h=this.verticalAlign(),l=this.direction(),u=0,g=this.align(),w=this.getWidth(),S=this.letterSpacing(),c=this.fill(),f=this.textDecoration(),v=f.indexOf("underline")!==-1,_=f.indexOf("line-through")!==-1,T;l=l===fr?e.direction:l;var k=0,k=s/2,o=0,d=0;for(l===zi&&e.setAttr("direction",l),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",Xi),e.setAttr("textAlign",gr),h===Xi?u=(this.getHeight()-r*s-a*2)/2:h===Za&&(u=this.getHeight()-r*s-a*2),e.translate(a,u+a),T=0;T<r;T++){var o=0,d=0,m=i[T],C=m.text,E=m.width,y=m.lastInParagraph,P,b,A;if(e.save(),g===ja?o+=w-E-a*2:g===Va&&(o+=(w-E-a*2)/2),v){e.save(),e.beginPath(),e.moveTo(o,k+d+Math.round(n/2)),P=C.split(" ").length-1,b=P===0,A=g===wt&&!y?w-a*2:E,e.lineTo(o+Math.round(A),k+d+Math.round(n/2)),e.lineWidth=n/15;const $=this._getLinearGradient();e.strokeStyle=$||c,e.stroke(),e.restore()}if(_){e.save(),e.beginPath(),e.moveTo(o,k+d),P=C.split(" ").length-1,b=P===0,A=g===wt&&y&&!b?w-a*2:E,e.lineTo(o+Math.round(A),k+d),e.lineWidth=n/15;const $=this._getLinearGradient();e.strokeStyle=$||c,e.stroke(),e.restore()}if(l!==zi&&(S!==0||g===wt)){P=C.split(" ").length-1;for(var O=ur(C),D=0;D<O.length;D++){var L=O[D];L===" "&&!y&&g===wt&&(o+=(w-a*2-E)/P),this._partialTextX=o,this._partialTextY=k+d,this._partialText=L,e.fillStrokeShape(this),o+=this.measureSize(L).width+S}}else S!==0&&e.setAttr("letterSpacing",`${S}px`),this._partialTextX=o,this._partialTextY=k+d,this._partialText=C,e.fillStrokeShape(this);e.restore(),r>1&&(k+=s)}}}_hitFunc(e){var i=this.getWidth(),r=this.getHeight();e.beginPath(),e.rect(0,0,i,r),e.closePath(),e.fillStrokeShape(this)}setText(e){var i=bi.Util._isString(e)?e:e==null?"":e+"";return this._setAttr(Xa,i),this}getWidth(){var e=this.attrs.width===ft||this.attrs.width===void 0;return e?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var e=this.attrs.height===ft||this.attrs.height===void 0;return e?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return bi.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var i=ci(),r=this.fontSize(),a;return i.save(),i.font=this._getContextFont(),a=i.measureText(e),i.restore(),{width:a.width,height:r}}_getContextFont(){return this.fontStyle()+Bt+this.fontVariant()+Bt+(this.fontSize()+Ka)+Qa(this.fontFamily())}_addTextLine(e){this.align()===wt&&(e=e.trim());var r=this._getTextWidth(e);return this.textArr.push({text:e,width:r,lastInParagraph:!1})}_getTextWidth(e){var i=this.letterSpacing(),r=e.length;return ci().measureText(e).width+(r?i*(r-1):0)}_setTextData(){var e=this.text().split(`
`),i=+this.fontSize(),r=0,a=this.lineHeight()*i,n=this.attrs.width,s=this.attrs.height,h=n!==ft&&n!==void 0,l=s!==ft&&s!==void 0,u=this.padding(),g=n-u*2,w=s-u*2,S=0,c=this.wrap(),f=c!==Yi,v=c!==qa&&f,_=this.ellipsis();this.textArr=[],ci().font=this._getContextFont();for(var T=_?this._getTextWidth(_i):0,k=0,o=e.length;k<o;++k){var d=e[k],m=this._getTextWidth(d);if(h&&m>g)for(;d.length>0;){for(var C=0,E=d.length,y="",P=0;C<E;){var b=C+E>>>1,A=d.slice(0,b+1),O=this._getTextWidth(A)+T;O<=g?(C=b+1,y=A,P=O):E=b}if(y){if(v){var D,L=d[y.length],W=L===Bt||L===Ni;W&&P<=g?D=y.length:D=Math.max(y.lastIndexOf(Bt),y.lastIndexOf(Ni))+1,D>0&&(C=D,y=y.slice(0,C),P=this._getTextWidth(y))}y=y.trimRight(),this._addTextLine(y),r=Math.max(r,P),S+=a;var oe=this._shouldHandleEllipsis(S);if(oe){this._tryToAddEllipsisToLastLine();break}if(d=d.slice(C),d=d.trimLeft(),d.length>0&&(m=this._getTextWidth(d),m<=g)){this._addTextLine(d),S+=a,r=Math.max(r,m);break}}else break}else this._addTextLine(d),S+=a,r=Math.max(r,m),this._shouldHandleEllipsis(S)&&k<o-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&S+a>w)break}this.textHeight=i,this.textWidth=r}_shouldHandleEllipsis(e){var i=+this.fontSize(),r=this.lineHeight()*i,a=this.attrs.height,n=a!==ft&&a!==void 0,s=this.padding(),h=a-s*2,l=this.wrap(),u=l!==Yi;return!u||n&&e+r>h}_tryToAddEllipsisToLastLine(){var e=this.attrs.width,i=e!==ft&&e!==void 0,r=this.padding(),a=e-r*2,n=this.ellipsis(),s=this.textArr[this.textArr.length-1];if(!(!s||!n)){if(i){var h=this._getTextWidth(s.text+_i)<a;h||(s.text=s.text.slice(0,s.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(s.text+_i)}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,i=this.hasShadow();return e&&i?!0:super._useBufferCanvas()}}tt=Tt.Text=q;q.prototype._fillFunc=en;q.prototype._strokeFunc=tn;q.prototype.className=za;q.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,Ua._registerNode)(q);ce.Factory.overWriteSetter(q,"width",(0,je.getNumberOrAutoValidator)());ce.Factory.overWriteSetter(q,"height",(0,je.getNumberOrAutoValidator)());ce.Factory.addGetterSetter(q,"direction",fr);ce.Factory.addGetterSetter(q,"fontFamily","Arial");ce.Factory.addGetterSetter(q,"fontSize",12,(0,je.getNumberValidator)());ce.Factory.addGetterSetter(q,"fontStyle",_r);ce.Factory.addGetterSetter(q,"fontVariant",_r);ce.Factory.addGetterSetter(q,"padding",0,(0,je.getNumberValidator)());ce.Factory.addGetterSetter(q,"align",gr);ce.Factory.addGetterSetter(q,"verticalAlign",Ya);ce.Factory.addGetterSetter(q,"lineHeight",1,(0,je.getNumberValidator)());ce.Factory.addGetterSetter(q,"wrap",Ja);ce.Factory.addGetterSetter(q,"ellipsis",!1,(0,je.getBooleanValidator)());ce.Factory.addGetterSetter(q,"letterSpacing",0,(0,je.getNumberValidator)());ce.Factory.addGetterSetter(q,"text","",(0,je.getStringValidator)());ce.Factory.addGetterSetter(q,"textDecoration","");function nt(t,e){this._waveformData=t,this._channelIndex=e}nt.prototype.min_sample=function(t){var e=(t*this._waveformData.channels+this._channelIndex)*2;return this._waveformData._at(e)};nt.prototype.max_sample=function(t){var e=(t*this._waveformData.channels+this._channelIndex)*2+1;return this._waveformData._at(e)};nt.prototype.set_min_sample=function(t,e){var i=(t*this._waveformData.channels+this._channelIndex)*2;return this._waveformData._set_at(i,e)};nt.prototype.set_max_sample=function(t,e){var i=(t*this._waveformData.channels+this._channelIndex)*2+1;return this._waveformData._set_at(i,e)};nt.prototype.min_array=function(){for(var t=this._waveformData.length,e=[],i=0;i<t;i++)e.push(this.min_sample(i));return e};nt.prototype.max_array=function(){for(var t=this._waveformData.length,e=[],i=0;i<t;i++)e.push(this.max_sample(i));return e};var gt=127,Vt=-128;function an(t,e){var i=Math.floor(t/e),r=t-i*e;return r>0&&i++,i}function nn(t){var e=t.scale,i=t.amplitude_scale,r=t.split_channels,a=t.length,n=t.sample_rate,s=t.channels.map(function(m){return new Float32Array(m)}),h=r?s.length:1,l=h===1?1:2,u=l===1?20:24,g=an(a,e),w=u+g*2*h,S=new ArrayBuffer(w),c=new DataView(S),f=0,v=u,_,T,k=new Array(h),o=new Array(h);for(_=0;_<h;_++)k[_]=1/0,o[_]=-1/0;for(c.setInt32(0,l,!0),c.setUint32(4,1,!0),c.setInt32(8,n,!0),c.setInt32(12,e,!0),c.setInt32(16,g,!0),l===2&&c.setInt32(20,h,!0),T=0;T<a;T++){var d=0;if(h===1){for(_=0;_<s.length;++_)d+=s[_][T];d=Math.floor(gt*d*i/s.length),d<k[0]&&(k[0]=d,k[0]<Vt&&(k[0]=Vt)),d>o[0]&&(o[0]=d,o[0]>gt&&(o[0]=gt))}else for(_=0;_<h;++_)d=Math.floor(gt*s[_][T]*i),d<k[_]&&(k[_]=d,k[_]<Vt&&(k[_]=Vt)),d>o[_]&&(o[_]=d,o[_]>gt&&(o[_]=gt));if(++f===e){for(_=0;_<h;_++)c.setInt8(v++,k[_]),c.setInt8(v++,o[_]),k[_]=1/0,o[_]=-1/0;f=0}}if(f>0)for(_=0;_<h;_++)c.setInt8(v++,k[_]),c.setInt8(v++,o[_]);return S}function Zt(t){"@babel/helpers - typeof";return Zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zt(t)}function sn(t){return t&&Zt(t)==="object"&&"sample_rate"in t&&"samples_per_pixel"in t&&"bits"in t&&"length"in t&&"data"in t}function on(t){var e=t&&Zt(t)==="object"&&"byteLength"in t;if(e){var i=new DataView(t),r=i.getInt32(0,!0);if(r!==1&&r!==2)throw new TypeError("WaveformData.create(): This waveform data version not supported")}return e}function hn(t){var e=t.data,i=t.channels||1,r=24,a=t.bits===8?1:2,n=t.length*2*i;if(e.length!==n)throw new Error("WaveformData.create(): Length mismatch in JSON waveform data");var s=r+e.length*a,h=new ArrayBuffer(s),l=new DataView(h);l.setInt32(0,2,!0),l.setUint32(4,t.bits===8,!0),l.setInt32(8,t.sample_rate,!0),l.setInt32(12,t.samples_per_pixel,!0),l.setInt32(16,t.length,!0),l.setInt32(20,i,!0);var u=r,g;if(t.bits===8)for(g=0;g<e.length;g++)l.setInt8(u++,e[g],!0);else for(g=0;g<e.length;g++)l.setInt16(u,e[g],!0),u+=2;return h}function ln(t,e){var i=atob(t);if(e){for(var r=new Uint8Array(i.length),a=0,n=i.length;a<n;++a)r[a]=i.charCodeAt(a);return String.fromCharCode.apply(null,new Uint16Array(r.buffer))}return i}function dn(t,e,i){var r=e===void 0?null:e,a=i===void 0?!1:i,n=ln(t,a),s=n.indexOf(`
`,10)+1,h=n.substring(s)+(r?"//# sourceMappingURL="+r:""),l=new Blob([h],{type:"application/javascript"});return URL.createObjectURL(l)}function un(t,e,i){var r;return function(n){return r=r||dn(t,e,i),new Worker(r,n)}}var fn=un("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F1ZGFjaXR5L2F1ZGFjaXR5L2Jsb2IvCiAgICogICAxMTA4YzEzNzZjMDkxNjYxNjIzMzVmYWI0NzQzMDA4Y2JhNTdjNGVlL3NyYy9CbG9ja0ZpbGUuY3BwI0wxOTgKICAgKi8KCiAgdmFyIElOVDhfTUFYID0gMTI3OwogIHZhciBJTlQ4X01JTiA9IC0xMjg7CiAgZnVuY3Rpb24gY2FsY3VsYXRlV2F2ZWZvcm1EYXRhTGVuZ3RoKGF1ZGlvX3NhbXBsZV9jb3VudCwgc2NhbGUpIHsKICAgIHZhciBkYXRhX2xlbmd0aCA9IE1hdGguZmxvb3IoYXVkaW9fc2FtcGxlX2NvdW50IC8gc2NhbGUpOwogICAgdmFyIHNhbXBsZXNfcmVtYWluaW5nID0gYXVkaW9fc2FtcGxlX2NvdW50IC0gZGF0YV9sZW5ndGggKiBzY2FsZTsKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KICAgIHJldHVybiBkYXRhX2xlbmd0aDsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVXYXZlZm9ybURhdGEob3B0aW9ucykgewogICAgdmFyIHNjYWxlID0gb3B0aW9ucy5zY2FsZTsKICAgIHZhciBhbXBsaXR1ZGVfc2NhbGUgPSBvcHRpb25zLmFtcGxpdHVkZV9zY2FsZTsKICAgIHZhciBzcGxpdF9jaGFubmVscyA9IG9wdGlvbnMuc3BsaXRfY2hhbm5lbHM7CiAgICB2YXIgbGVuZ3RoID0gb3B0aW9ucy5sZW5ndGg7CiAgICB2YXIgc2FtcGxlX3JhdGUgPSBvcHRpb25zLnNhbXBsZV9yYXRlOwogICAgdmFyIGNoYW5uZWxzID0gb3B0aW9ucy5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoY2hhbm5lbCk7CiAgICB9KTsKICAgIHZhciBvdXRwdXRfY2hhbm5lbHMgPSBzcGxpdF9jaGFubmVscyA/IGNoYW5uZWxzLmxlbmd0aCA6IDE7CiAgICB2YXIgdmVyc2lvbiA9IG91dHB1dF9jaGFubmVscyA9PT0gMSA/IDEgOiAyOwogICAgdmFyIGhlYWRlcl9zaXplID0gdmVyc2lvbiA9PT0gMSA/IDIwIDogMjQ7CiAgICB2YXIgZGF0YV9sZW5ndGggPSBjYWxjdWxhdGVXYXZlZm9ybURhdGFMZW5ndGgobGVuZ3RoLCBzY2FsZSk7CiAgICB2YXIgdG90YWxfc2l6ZSA9IGhlYWRlcl9zaXplICsgZGF0YV9sZW5ndGggKiAyICogb3V0cHV0X2NoYW5uZWxzOwogICAgdmFyIGJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcih0b3RhbF9zaXplKTsKICAgIHZhciBkYXRhX3ZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTsKICAgIHZhciBzY2FsZV9jb3VudGVyID0gMDsKICAgIHZhciBvZmZzZXQgPSBoZWFkZXJfc2l6ZTsKICAgIHZhciBjaGFubmVsLCBpOwogICAgdmFyIG1pbl92YWx1ZSA9IG5ldyBBcnJheShvdXRwdXRfY2hhbm5lbHMpOwogICAgdmFyIG1heF92YWx1ZSA9IG5ldyBBcnJheShvdXRwdXRfY2hhbm5lbHMpOwogICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IEluZmluaXR5OwogICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICB9CiAgICBkYXRhX3ZpZXcuc2V0SW50MzIoMCwgdmVyc2lvbiwgdHJ1ZSk7IC8vIFZlcnNpb24KICAgIGRhdGFfdmlldy5zZXRVaW50MzIoNCwgMSwgdHJ1ZSk7IC8vIElzIDggYml0PwogICAgZGF0YV92aWV3LnNldEludDMyKDgsIHNhbXBsZV9yYXRlLCB0cnVlKTsgLy8gU2FtcGxlIHJhdGUKICAgIGRhdGFfdmlldy5zZXRJbnQzMigxMiwgc2NhbGUsIHRydWUpOyAvLyBTY2FsZQogICAgZGF0YV92aWV3LnNldEludDMyKDE2LCBkYXRhX2xlbmd0aCwgdHJ1ZSk7IC8vIExlbmd0aAoKICAgIGlmICh2ZXJzaW9uID09PSAyKSB7CiAgICAgIGRhdGFfdmlldy5zZXRJbnQzMigyMCwgb3V0cHV0X2NoYW5uZWxzLCB0cnVlKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgc2FtcGxlID0gMDsKICAgICAgaWYgKG91dHB1dF9jaGFubmVscyA9PT0gMSkgewogICAgICAgIGZvciAoY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBjaGFubmVscy5sZW5ndGg7ICsrY2hhbm5lbCkgewogICAgICAgICAgc2FtcGxlICs9IGNoYW5uZWxzW2NoYW5uZWxdW2ldOwogICAgICAgIH0KICAgICAgICBzYW1wbGUgPSBNYXRoLmZsb29yKElOVDhfTUFYICogc2FtcGxlICogYW1wbGl0dWRlX3NjYWxlIC8gY2hhbm5lbHMubGVuZ3RoKTsKICAgICAgICBpZiAoc2FtcGxlIDwgbWluX3ZhbHVlWzBdKSB7CiAgICAgICAgICBtaW5fdmFsdWVbMF0gPSBzYW1wbGU7CiAgICAgICAgICBpZiAobWluX3ZhbHVlWzBdIDwgSU5UOF9NSU4pIHsKICAgICAgICAgICAgbWluX3ZhbHVlWzBdID0gSU5UOF9NSU47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzYW1wbGUgPiBtYXhfdmFsdWVbMF0pIHsKICAgICAgICAgIG1heF92YWx1ZVswXSA9IHNhbXBsZTsKICAgICAgICAgIGlmIChtYXhfdmFsdWVbMF0gPiBJTlQ4X01BWCkgewogICAgICAgICAgICBtYXhfdmFsdWVbMF0gPSBJTlQ4X01BWDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgKytjaGFubmVsKSB7CiAgICAgICAgICBzYW1wbGUgPSBNYXRoLmZsb29yKElOVDhfTUFYICogY2hhbm5lbHNbY2hhbm5lbF1baV0gKiBhbXBsaXR1ZGVfc2NhbGUpOwogICAgICAgICAgaWYgKHNhbXBsZSA8IG1pbl92YWx1ZVtjaGFubmVsXSkgewogICAgICAgICAgICBtaW5fdmFsdWVbY2hhbm5lbF0gPSBzYW1wbGU7CiAgICAgICAgICAgIGlmIChtaW5fdmFsdWVbY2hhbm5lbF0gPCBJTlQ4X01JTikgewogICAgICAgICAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IElOVDhfTUlOOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2FtcGxlID4gbWF4X3ZhbHVlW2NoYW5uZWxdKSB7CiAgICAgICAgICAgIG1heF92YWx1ZVtjaGFubmVsXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1heF92YWx1ZVtjaGFubmVsXSA+IElOVDhfTUFYKSB7CiAgICAgICAgICAgICAgbWF4X3ZhbHVlW2NoYW5uZWxdID0gSU5UOF9NQVg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCsrc2NhbGVfY291bnRlciA9PT0gc2NhbGUpIHsKICAgICAgICBmb3IgKGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgb3V0cHV0X2NoYW5uZWxzOyBjaGFubmVsKyspIHsKICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtaW5fdmFsdWVbY2hhbm5lbF0pOwogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1heF92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgICBtaW5fdmFsdWVbY2hhbm5lbF0gPSBJbmZpbml0eTsKICAgICAgICAgIG1heF92YWx1ZVtjaGFubmVsXSA9IC1JbmZpbml0eTsKICAgICAgICB9CiAgICAgICAgc2NhbGVfY291bnRlciA9IDA7CiAgICAgIH0KICAgIH0KICAgIGlmIChzY2FsZV9jb3VudGVyID4gMCkgewogICAgICBmb3IgKGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgb3V0cHV0X2NoYW5uZWxzOyBjaGFubmVsKyspIHsKICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWluX3ZhbHVlW2NoYW5uZWxdKTsKICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWF4X3ZhbHVlW2NoYW5uZWxdKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ1ZmZlcjsKICB9CgogIG9ubWVzc2FnZSA9IGZ1bmN0aW9uIG9ubWVzc2FnZShldnQpIHsKICAgIHZhciBidWZmZXIgPSBnZW5lcmF0ZVdhdmVmb3JtRGF0YShldnQuZGF0YSk7CgogICAgLy8gVHJhbnNmZXIgYnVmZmVyIHRvIHRoZSBjYWxsaW5nIHRocmVhZAogICAgdGhpcy5wb3N0TWVzc2FnZShidWZmZXIsIFtidWZmZXJdKTsKICAgIHRoaXMuY2xvc2UoKTsKICB9OwoKfSkoKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9d2F2ZWZvcm0tZGF0YS13b3JrZXIuanMubWFwCgo=",null,!1);function me(t){if(sn(t)&&(t=hn(t)),on(t)){this._data=new DataView(t),this._offset=this._version()===2?24:20,this._channels=[];for(var e=0;e<this.channels;e++)this._channels[e]=new nt(this,e)}else throw new TypeError("WaveformData.create(): Unknown data format")}var Ht={scale:512,amplitude_scale:1,split_channels:!1,disable_worker:!1};function gn(t){var e={scale:t.scale||Ht.scale,amplitude_scale:t.amplitude_scale||Ht.amplitude_scale,split_channels:t.split_channels||Ht.split_channels,disable_worker:t.disable_worker||Ht.disable_worker};return e}function _n(t){for(var e=[],i=0;i<t.numberOfChannels;++i)e.push(t.getChannelData(i).buffer);return e}function pr(t,e,i){var r=_n(t);if(e.disable_worker){var a=nn({scale:e.scale,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:r});i(null,new me(a),t)}else{var n=new fn;n.onmessage=function(s){i(null,new me(s.data),t)},n.postMessage({scale:e.scale,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:r},r)}}function cn(t,e,i,r){function a(s){s||(s=new DOMException("EncodingError")),r(s),r=function(){}}var n=t.decodeAudioData(e,function(s){pr(s,i,r)},a);n&&n.catch(a)}me.create=function(e){return new me(e)};me.createFromAudio=function(t,e){var i=gn(t);if(t.audio_context&&t.array_buffer)return cn(t.audio_context,t.array_buffer,i,e);if(t.audio_buffer)return pr(t.audio_buffer,i,e);throw new TypeError("WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")};function ni(t){this._inputData=t.waveformData,this._output_samples_per_pixel=t.scale,this._scale=this._inputData.scale,this._input_buffer_size=this._inputData.length;var e=this._input_buffer_size*this._inputData.scale,i=Math.ceil(e/this._output_samples_per_pixel),r=24,a=this._inputData.bits===8?1:2,n=r+i*2*this._inputData.channels*a;this._output_data=new ArrayBuffer(n),this.output_dataview=new DataView(this._output_data),this.output_dataview.setInt32(0,2,!0),this.output_dataview.setUint32(4,this._inputData.bits===8,!0),this.output_dataview.setInt32(8,this._inputData.sample_rate,!0),this.output_dataview.setInt32(12,this._output_samples_per_pixel,!0),this.output_dataview.setInt32(16,i,!0),this.output_dataview.setInt32(20,this._inputData.channels,!0),this._outputWaveformData=new me(this._output_data),this._input_index=0,this._output_index=0;var s=this._inputData.channels;this._min=new Array(s),this._max=new Array(s);var h;for(h=0;h<s;++h)this._input_buffer_size>0?(this._min[h]=this._inputData.channel(h).min_sample(this._input_index),this._max[h]=this._inputData.channel(h).max_sample(this._input_index)):(this._min[h]=0,this._max[h]=0);this._min_value=this._inputData.bits===8?-128:-32768,this._max_value=this._inputData.bits===8?127:32767,this._where=0,this._prev_where=0,this._stop=0,this._last_input_index=0}ni.prototype.sample_at_pixel=function(t){return Math.floor(t*this._output_samples_per_pixel)};ni.prototype.next=function(){for(var t=0,e=1e3,i=this._inputData.channels,r,a,n;this._input_index<this._input_buffer_size&&t<e;){for(;Math.floor(this.sample_at_pixel(this._output_index)/this._scale)===this._input_index;){if(this._output_index>0)for(n=0;n<i;++n)r=this._outputWaveformData.channel(n),r.set_min_sample(this._output_index-1,this._min[n]),r.set_max_sample(this._output_index-1,this._max[n]);if(this._last_input_index=this._input_index,this._output_index++,this._where=this.sample_at_pixel(this._output_index),this._prev_where=this.sample_at_pixel(this._output_index-1),this._where!==this._prev_where)for(n=0;n<i;++n)this._min[n]=this._max_value,this._max[n]=this._min_value}for(this._where=this.sample_at_pixel(this._output_index),this._stop=Math.floor(this._where/this._scale),this._stop>this._input_buffer_size&&(this._stop=this._input_buffer_size);this._input_index<this._stop;){for(n=0;n<i;++n)r=this._inputData.channel(n),a=r.min_sample(this._input_index),a<this._min[n]&&(this._min[n]=a),a=r.max_sample(this._input_index),a>this._max[n]&&(this._max[n]=a);this._input_index++}t++}if(this._input_index<this._input_buffer_size)return!1;if(this._input_index!==this._last_input_index)for(n=0;n<i;++n)r=this._outputWaveformData.channel(n),r.set_min_sample(this._output_index-1,this._min[n]),r.set_max_sample(this._output_index-1,this._max[n]);return!0};ni.prototype.getOutputData=function(){return this._output_data};me.prototype={_getResampleOptions:function(e){var i={};if(i.scale=e.scale,i.width=e.width,i.width!=null&&(typeof i.width!="number"||i.width<=0))throw new RangeError("WaveformData.resample(): width should be a positive integer value");if(i.scale!=null&&(typeof i.scale!="number"||i.scale<=0))throw new RangeError("WaveformData.resample(): scale should be a positive integer value");if(!i.scale&&!i.width)throw new Error("WaveformData.resample(): Missing scale or width option");if(i.width&&(i.scale=Math.floor(this.duration*this.sample_rate/i.width)),i.scale<this.scale)throw new Error("WaveformData.resample(): Zoom level "+i.scale+" too low, minimum: "+this.scale);return i.abortSignal=e.abortSignal,i},resample:function(e){e=this._getResampleOptions(e),e.waveformData=this;for(var i=new ni(e);!i.next(););return new me(i.getOutputData())},concat:function(){var e=this,i=Array.prototype.slice.call(arguments);i.forEach(function(a){if(e.channels!==a.channels||e.sample_rate!==a.sample_rate||e.bits!==a.bits||e.scale!==a.scale)throw new Error("WaveformData.concat(): Waveforms are incompatible")});var r=this._concatBuffers.apply(this,i);return me.create(r)},_concatBuffers:function(){var e=Array.prototype.slice.call(arguments),i=this._offset,r=i,a=0,n=[this].concat(e).map(function(f){return f._data.buffer}),s,h;for(s=0;s<n.length;s++){h=n[s];var l=new DataView(h).getInt32(16,!0);r+=h.byteLength-i,a+=l}var u=new ArrayBuffer(r),g=new DataView(n[0]),w=new DataView(u);for(s=0;s<i;s++)w.setUint8(s,g.getUint8(s));w.setInt32(16,a,!0);var S=0,c=new Uint8Array(u,i);for(s=0;s<n.length;s++)h=n[s],c.set(new Uint8Array(h,i),S),S+=h.byteLength-i;return u},slice:function(e){var i=0,r=0;if(e.startIndex!=null&&e.endIndex!=null?(i=e.startIndex,r=e.endIndex):e.startTime!=null&&e.endTime!=null&&(i=this.at_time(e.startTime),r=this.at_time(e.endTime)),i<0)throw new RangeError("startIndex or startTime must not be negative");if(r<0)throw new RangeError("endIndex or endTime must not be negative");i>this.length&&(i=this.length),r>this.length&&(r=this.length),i>r&&(i=r);var a=r-i,n=24,s=this.bits===8?1:2,h=n+a*2*this.channels*s,l=new ArrayBuffer(h),u=new DataView(l);u.setInt32(0,2,!0),u.setUint32(4,this.bits===8,!0),u.setInt32(8,this.sample_rate,!0),u.setInt32(12,this.scale,!0),u.setInt32(16,a,!0),u.setInt32(20,this.channels,!0);for(var g=0;g<a*this.channels*2;g++){var w=this._at(i*this.channels*2+g);this.bits===8?u.setInt8(n+g,w):u.setInt16(n+g*2,w,!0)}return new me(l)},_version:function(){return this._data.getInt32(0,!0)},get length(){return this._data.getUint32(16,!0)},get bits(){var t=!!this._data.getUint32(4,!0);return t?8:16},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return this._version()===2?this._data.getInt32(20,!0):1},channel:function(e){if(e>=0&&e<this._channels.length)return this._channels[e];throw new RangeError("Invalid channel: "+e)},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},_at:function(e){return this.bits===8?this._data.getInt8(this._offset+e):this._data.getInt16(this._offset+e*2,!0)},_set_at:function(e,i){return this.bits===8?this._data.setInt8(this._offset+e,i):this._data.setInt16(this._offset+e*2,i,!0)},at_time:function(e){return Math.floor(e*this.sample_rate/this.scale)},time:function(e){return e*this.scale/this.sample_rate},toJSON:function(){for(var e={version:2,channels:this.channels,sample_rate:this.sample_rate,samples_per_pixel:this.scale,bits:this.bits,length:this.length,data:[]},i=0;i<this.length;i++)for(var r=0;r<this.channels;r++)e.data.push(this.channel(r).min_sample(i)),e.data.push(this.channel(r).max_sample(i));return e},toArrayBuffer:function(){return this._data.buffer}};var mr={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1));function a(l,u,g){this.fn=l,this.context=u,this.once=g||!1}function n(l,u,g,w,S){if(typeof g!="function")throw new TypeError("The listener must be a function");var c=new a(g,w||l,S),f=i?i+u:u;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],c]:l._events[f].push(c):(l._events[f]=c,l._eventsCount++),l}function s(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function h(){this._events=new r,this._eventsCount=0}h.prototype.eventNames=function(){var u=[],g,w;if(this._eventsCount===0)return u;for(w in g=this._events)e.call(g,w)&&u.push(i?w.slice(1):w);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(g)):u},h.prototype.listeners=function(u){var g=i?i+u:u,w=this._events[g];if(!w)return[];if(w.fn)return[w.fn];for(var S=0,c=w.length,f=new Array(c);S<c;S++)f[S]=w[S].fn;return f},h.prototype.listenerCount=function(u){var g=i?i+u:u,w=this._events[g];return w?w.fn?1:w.length:0},h.prototype.emit=function(u,g,w,S,c,f){var v=i?i+u:u;if(!this._events[v])return!1;var _=this._events[v],T=arguments.length,k,o;if(_.fn){switch(_.once&&this.removeListener(u,_.fn,void 0,!0),T){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,g),!0;case 3:return _.fn.call(_.context,g,w),!0;case 4:return _.fn.call(_.context,g,w,S),!0;case 5:return _.fn.call(_.context,g,w,S,c),!0;case 6:return _.fn.call(_.context,g,w,S,c,f),!0}for(o=1,k=new Array(T-1);o<T;o++)k[o-1]=arguments[o];_.fn.apply(_.context,k)}else{var d=_.length,m;for(o=0;o<d;o++)switch(_[o].once&&this.removeListener(u,_[o].fn,void 0,!0),T){case 1:_[o].fn.call(_[o].context);break;case 2:_[o].fn.call(_[o].context,g);break;case 3:_[o].fn.call(_[o].context,g,w);break;case 4:_[o].fn.call(_[o].context,g,w,S);break;default:if(!k)for(m=1,k=new Array(T-1);m<T;m++)k[m-1]=arguments[m];_[o].fn.apply(_[o].context,k)}}return!0},h.prototype.on=function(u,g,w){return n(this,u,g,w,!1)},h.prototype.once=function(u,g,w){return n(this,u,g,w,!0)},h.prototype.removeListener=function(u,g,w,S){var c=i?i+u:u;if(!this._events[c])return this;if(!g)return s(this,c),this;var f=this._events[c];if(f.fn)f.fn===g&&(!S||f.once)&&(!w||f.context===w)&&s(this,c);else{for(var v=0,_=[],T=f.length;v<T;v++)(f[v].fn!==g||S&&!f[v].once||w&&f[v].context!==w)&&_.push(f[v]);_.length?this._events[c]=_.length===1?_[0]:_:s(this,c)}return this},h.prototype.removeAllListeners=function(u){var g;return u?(g=i?i+u:u,this._events[g]&&s(this,g)):(this._events=new r,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=i,h.EventEmitter=h,t.exports=h})(mr);var vr=mr.exports;function bt(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bt=function(e){return typeof e}:bt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bt(t)}function ae(t,e,i){this.time=t,this.type=e,this.id=i}ae.POINT=0;ae.SEGMENT_START=1;ae.SEGMENT_END=2;ae.sorter=function(t,e){return t.time-e.time};function Zi(t,e){for(t=t.toString();t.length<e;)t="0"+t;return t}function yr(t,e){var i=[],r=Math.floor(t%1*Math.pow(10,e)),a=Math.floor(t),n=Math.floor(a/60),s=Math.floor(n/60);s>0&&i.push(s),i.push(n%60),i.push(a%60);for(var h=0;h<i.length;h++)i[h]=Zi(i[h],2);return i=i.join(":"),e>0&&(i+="."+Zi(r,e)),i}function pn(t,e){if(e===0)return 0;var i=1;t<0&&(i=-1,t=-t);var r=Math.ceil(t);return i*((r+e-1)/e|0)*e}function Se(t,e,i){return t<e?e:t>i?i:t}function I(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function St(t,e){for(var i in e)I(e,i)&&(t[i]=e[i]);return t}function mn(t){if(t.length===0)return!0;for(var e=t[0],i=1;i<t.length;i++){if(e>=t[i])return!1;e=t[i]}return!0}function Si(t){return typeof t=="number"}function vn(t){return!(typeof t!="number"||t!==t||t===1/0||t===-1/0)}function ze(t){return typeof t=="number"&&Number.isFinite(t)}function kt(t){return t!==null&&bt(t)==="object"&&!Array.isArray(t)}function et(t){return typeof t=="string"}function yn(t){return Object.prototype.toString.call(t).includes("ArrayBuffer")}function xe(t){return t==null}function wn(t){return typeof t=="function"}function wr(t){return t===!0||t===!1}function Ci(t){return t instanceof HTMLElement}function bn(t){return Array.isArray(t)}function si(t){return kt(t)&&I(t,"linearGradientStart")&&I(t,"linearGradientEnd")&&I(t,"linearGradientColorStops")&&Si(t.linearGradientStart)&&Si(t.linearGradientEnd)&&bn(t.linearGradientColorStops)&&t.linearGradientColorStops.length===2}function br(t){for(;t.parent!==null;){if(t.parent instanceof ne.Layer)return t;t=t.parent}return null}var Sn=/HeadlessChrome/.test(navigator.userAgent);function Cn(){return Sn||navigator.webdriver?!1:(typeof document>"u"?"undefined":bt(document))==="object"&&"visibilityState"in document&&document.visibilityState==="visible"}var Sr=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Tn=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,Ye={forward:{},reverse:{}},oi=0,Et=1,Dt=2;Ye.forward[ae.POINT]=oi;Ye.forward[ae.SEGMENT_START]=Et;Ye.forward[ae.SEGMENT_END]=Dt;Ye.reverse[ae.POINT]=oi;Ye.reverse[ae.SEGMENT_START]=Dt;Ye.reverse[ae.SEGMENT_END]=Et;var hi={};hi[oi]="points.enter";hi[Et]="segments.enter";hi[Dt]="segments.exit";var li={};li[oi]="point";li[Et]="segment";li[Dt]="segment";function kn(t,e){switch(e.type){case ae.POINT:return t.points.getPoint(e.id);case ae.SEGMENT_START:case ae.SEGMENT_END:return t.segments.getSegment(e.id);default:throw new Error("getPointOrSegment: id not found?")}}function Ee(t){this._cues=[],this._peaks=t,this._previousTime=-1,this._updateCues=this._updateCues.bind(this),this._onPlaying=this._onPlaying.bind(this),this._onSeeked=this._onSeeked.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._onAnimationFrame=this._onAnimationFrame.bind(this),this._rAFHandle=null,this._activeSegments={},this._attachEventHandlers()}Ee.prototype._updateCues=function(){var t=this,e=t._peaks.points.getPoints(),i=t._peaks.segments.getSegments();t._cues.length=0,e.forEach(function(a){t._cues.push(new ae(a.time,ae.POINT,a.id))}),i.forEach(function(a){t._cues.push(new ae(a.startTime,ae.SEGMENT_START,a.id)),t._cues.push(new ae(a.endTime,ae.SEGMENT_END,a.id))}),t._cues.sort(ae.sorter);var r=t._peaks.player.getCurrentTime();t._updateActiveSegments(r)};Ee.prototype._onUpdate=function(t,e){var i=t>e,r,a,n;i?(r=0,a=this._cues.length,n=1):(r=this._cues.length-1,a=-1,n=-1);for(var s=r;i?s<a:s>a;s+=n){var h=this._cues[s];if(i?h.time>e:h.time<e){if(i?h.time>t:h.time<t)break;var l=kn(this._peaks,h),u=i?Ye.forward[h.type]:Ye.reverse[h.type];u===Et?this._activeSegments[l.id]=l:u===Dt&&delete this._activeSegments[l.id];var g={time:t};g[li[u]]=l,this._peaks.emit(hi[u],g)}}};Ee.prototype._onTimeUpdate=function(t){Cn()||(this._peaks.player.isPlaying()&&!this._peaks.player.isSeeking()&&this._onUpdate(t,this._previousTime),this._previousTime=t)};Ee.prototype._onAnimationFrame=function(){var t=this._peaks.player.getCurrentTime();this._peaks.player.isSeeking()||this._onUpdate(t,this._previousTime),this._previousTime=t,this._peaks.player.isPlaying()&&(this._rAFHandle=Sr(this._onAnimationFrame))};Ee.prototype._onPlaying=function(){this._previousTime=this._peaks.player.getCurrentTime(),this._rAFHandle=Sr(this._onAnimationFrame)};Ee.prototype._onSeeked=function(t){this._previousTime=t,this._updateActiveSegments(t)};function xn(t){return function(i){return i.id===t}}Ee.prototype._updateActiveSegments=function(t){var e=this,i=e._peaks.segments.getSegmentsAtTime(t);for(var r in e._activeSegments)if(I(e._activeSegments,r)){var a=i.find(xn(r));a||(e._peaks.emit("segments.exit",{segment:e._activeSegments[r],time:t}),delete e._activeSegments[r])}i.forEach(function(n){n.id in e._activeSegments||(e._activeSegments[n.id]=n,e._peaks.emit("segments.enter",{segment:n,time:t}))})};var Kt=["points.update","points.dragmove","points.add","points.remove","points.remove_all","segments.update","segments.dragged","segments.add","segments.remove","segments.remove_all"];Ee.prototype._attachEventHandlers=function(){this._peaks.on("player.timeupdate",this._onTimeUpdate),this._peaks.on("player.playing",this._onPlaying),this._peaks.on("player.seeked",this._onSeeked);for(var t=0;t<Kt.length;t++)this._peaks.on(Kt[t],this._updateCues);this._updateCues()};Ee.prototype._detachEventHandlers=function(){this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.seeked",this._onSeeked);for(var t=0;t<Kt.length;t++)this._peaks.off(Kt[t],this._updateCues)};Ee.prototype.destroy=function(){this._rAFHandle&&(Tn(this._rAFHandle),this._rAFHandle=null),this._detachEventHandlers(),this._previousTime=-1};var Cr=["id","pid","time","labelText","color","editable"],An=["update","isVisible","peaks","pid"];function Pn(t,e){xe(t.labelText)&&(t.labelText=""),xe(t.editable)&&(t.editable=!1),xe(t.color)&&(t.color=e.pointMarkerColor)}function Tr(t,e){var i=e?"update()":"add()";if((!e||e&&I(t,"time"))&&!ze(t.time))throw new TypeError("peaks.points."+i+": time should be a numeric value");if(t.time<0)throw new RangeError("peaks.points."+i+": time should not be negative");if(I(t,"labelText")&&!et(t.labelText))throw new TypeError("peaks.points."+i+": labelText must be a string");if(I(t,"editable")&&!wr(t.editable))throw new TypeError("peaks.points."+i+": editable must be true or false");if(I(t,"color")&&!et(t.color)&&!si(t.color))throw new TypeError("peaks.points."+i+": color must be a string or a valid linear gradient object");An.forEach(function(r){if(I(t,r))throw new Error("peaks.points."+i+": invalid option name: "+r)}),Cr.forEach(function(r){if(I(t,"_"+r))throw new Error("peaks.points."+i+": invalid option name: _"+r)})}function vt(t,e,i){this._peaks=t,this._pid=e,this._setUserData(i)}vt.prototype._setUserData=function(t){for(var e in t)I(t,e)&&(Cr.indexOf(e)===-1?this[e]=t[e]:this["_"+e]=t[e])};Object.defineProperties(vt.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},time:{enumerable:!0,get:function(){return this._time}},labelText:{get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},editable:{enumerable:!0,get:function(){return this._editable}}});vt.prototype.update=function(t){if(Tr(t,!0),I(t,"id")){if(xe(t.id))throw new TypeError("point.update(): invalid id");this._peaks.points.updatePointId(this,t.id)}this._setUserData(t),this._peaks.emit("points.update",this,t)};vt.prototype.isVisible=function(t,e){return this.time>=t&&this.time<e};vt.prototype._setTime=function(t){this._time=t};function fe(t){this._peaks=t,this._points=[],this._pointsById={},this._pointsByPid={},this._pointIdCounter=0,this._pointPid=0}fe.prototype._getNextPointId=function(){return"peaks.point."+this._pointIdCounter++};fe.prototype._getNextPid=function(){return this._pointPid++};fe.prototype._addPoint=function(t){this._points.push(t),this._pointsById[t.id]=t,this._pointsByPid[t.pid]=t};fe.prototype._createPoint=function(t){var e={};St(e,t),xe(e.id)&&(e.id=this._getNextPointId());var i=this._getNextPid();return Pn(e,this._peaks.options),Tr(e,!1),new vt(this._peaks,i,e)};fe.prototype.getPoints=function(){return this._points};fe.prototype.getPoint=function(t){return this._pointsById[t]};fe.prototype.find=function(t,e){return this._points.filter(function(i){return i.isVisible(t,e)})};fe.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),i=e?arguments[0]:Array.prototype.slice.call(arguments);return i=i.map(function(r){var a=t._createPoint(r);if(I(t._pointsById,a.id))throw new Error("peaks.points.add(): duplicate id");return a}),i.forEach(function(r){t._addPoint(r)}),this._peaks.emit("points.add",{points:i}),e?i:i[0]};fe.prototype.updatePointId=function(t,e){if(this._pointsById[t.id]){if(this._pointsById[e])throw new Error("point.update(): duplicate id");delete this._pointsById[t.id],this._pointsById[e]=t}};fe.prototype._findPoint=function(t){for(var e=[],i=0,r=this._points.length;i<r;i++)t(this._points[i])&&e.push(i);return e};fe.prototype._removeIndexes=function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i]-e.length,a=this._points.splice(r,1)[0];delete this._pointsById[a.id],delete this._pointsByPid[a.pid],e.push(a)}return e};fe.prototype._removePoints=function(t){var e=this._findPoint(t),i=this._removeIndexes(e);return this._peaks.emit("points.remove",{points:i}),i};fe.prototype.remove=function(t){return this._removePoints(function(e){return e===t})};fe.prototype.removeById=function(t){return this._removePoints(function(e){return e.id===t})};fe.prototype.removeByTime=function(t){return this._removePoints(function(e){return e.time===t})};fe.prototype.removeAll=function(){this._points=[],this._pointsById={},this._pointsByPid={},this._peaks.emit("points.remove_all")};var kr=["id","pid","startTime","endTime","labelText","color","borderColor","editable"],En=["update","isVisible","peaks","pid"];function Dn(t,e){xe(t.color)&&(e.overlay?t.color=e.overlayColor:t.color=e.waveformColor),xe(t.borderColor)&&(t.borderColor=e.overlayBorderColor),xe(t.labelText)&&(t.labelText=""),xe(t.editable)&&(t.editable=!1)}function xr(t,e){var i=e?"update()":"add()";if(I(t,"startTime")&&!ze(t.startTime))throw new TypeError("peaks.segments."+i+": startTime should be a valid number");if(I(t,"endTime")&&!ze(t.endTime))throw new TypeError("peaks.segments."+i+": endTime should be a valid number");if(!e&&(!I(t,"startTime")||!I(t,"endTime")))throw new TypeError("peaks.segments."+i+": missing startTime or endTime");if(t.startTime<0)throw new RangeError("peaks.segments."+i+": startTime should not be negative");if(t.endTime<0)throw new RangeError("peaks.segments."+i+": endTime should not be negative");if(t.endTime<t.startTime)throw new RangeError("peaks.segments."+i+": endTime should not be less than startTime");if(I(t,"labelText")&&!et(t.labelText))throw new TypeError("peaks.segments."+i+": labelText must be a string");if(I(t,"editable")&&!wr(t.editable))throw new TypeError("peaks.segments."+i+": editable must be true or false");if(I(t,"color")&&!et(t.color)&&!si(t.color))throw new TypeError("peaks.segments."+i+": color must be a string or a valid linear gradient object");if(I(t,"borderColor")&&!et(t.borderColor))throw new TypeError("peaks.segments."+i+": borderColor must be a string");En.forEach(function(r){if(I(t,r))throw new Error("peaks.segments."+i+": invalid option name: "+r)}),kr.forEach(function(r){if(I(t,"_"+r))throw new Error("peaks.segments."+i+": invalid option name: _"+r)})}function st(t,e,i){this._peaks=t,this._pid=e,this._id=i.id,this._startTime=i.startTime,this._endTime=i.endTime,this._labelText=i.labelText,this._color=i.color,this._borderColor=i.borderColor,this._editable=i.editable,this._setUserData(i)}st.prototype._setUserData=function(t){for(var e in t)I(t,e)&&(kr.indexOf(e)===-1?this[e]=t[e]:this["_"+e]=t[e])};Object.defineProperties(st.prototype,{id:{enumerable:!0,get:function(){return this._id}},pid:{enumerable:!0,get:function(){return this._pid}},startTime:{enumerable:!0,get:function(){return this._startTime}},endTime:{enumerable:!0,get:function(){return this._endTime}},labelText:{enumerable:!0,get:function(){return this._labelText}},color:{enumerable:!0,get:function(){return this._color}},borderColor:{enumerable:!0,get:function(){return this._borderColor}},editable:{enumerable:!0,get:function(){return this._editable}}});st.prototype.update=function(t){if(xr(t,!0),I(t,"id")){if(xe(t.id))throw new TypeError("segment.update(): invalid id");this._peaks.segments.updateSegmentId(this,t.id)}this._setUserData(t),this._peaks.emit("segments.update",this,t)};st.prototype.isVisible=function(t,e){return this.startTime<e&&t<this.endTime};st.prototype._setStartTime=function(t){this._startTime=t};st.prototype._setEndTime=function(t){this._endTime=t};function j(t){this._peaks=t,this._segments=[],this._segmentsById={},this._segmentsByPid={},this._segmentIdCounter=0,this._segmentPid=0,this._isInserting=!1}j.prototype._getNextSegmentId=function(){return"peaks.segment."+this._segmentIdCounter++};j.prototype._getNextPid=function(){return this._segmentPid++};j.prototype._addSegment=function(t){this._segments.push(t),this._segmentsById[t.id]=t,this._segmentsByPid[t.pid]=t};j.prototype._createSegment=function(t){var e={};St(e,t),xe(e.id)&&(e.id=this._getNextSegmentId());var i=this._getNextPid();return Dn(e,this._peaks.options.segmentOptions),xr(e,!1),new st(this._peaks,i,e)};j.prototype.getSegments=function(){return this._segments};j.prototype.getSegment=function(t){return this._segmentsById[t]};j.prototype.getSegmentsAtTime=function(t){return this._segments.filter(function(e){return t>=e.startTime&&t<e.endTime})};j.prototype.find=function(t,e){return this._segments.filter(function(i){return i.isVisible(t,e)})};j.prototype._getSortedSegments=function(){return this._segments.slice().sort(function(t,e){return t.startTime-e.startTime})};j.prototype.findPreviousSegment=function(t){var e=this._getSortedSegments(),i=e.findIndex(function(r){return r.id===t.id});if(i!==-1)return e[i-1]};j.prototype.findNextSegment=function(t){var e=this._getSortedSegments(),i=e.findIndex(function(r){return r.id===t.id});if(i!==-1)return e[i+1]};j.prototype.add=function(){var t=this,e=Array.isArray(arguments[0]),i=e?arguments[0]:Array.prototype.slice.call(arguments);return i=i.map(function(r){var a=t._createSegment(r);if(I(t._segmentsById,a.id))throw new Error("peaks.segments.add(): duplicate id");return a}),i.forEach(function(r){t._addSegment(r)}),this._peaks.emit("segments.add",{segments:i,insert:this._isInserting}),e?i:i[0]};j.prototype.updateSegmentId=function(t,e){if(this._segmentsById[t.id]){if(this._segmentsById[e])throw new Error("segment.update(): duplicate id");delete this._segmentsById[t.id],this._segmentsById[e]=t}};j.prototype._findSegment=function(t){for(var e=[],i=0,r=this._segments.length;i<r;i++)t(this._segments[i])&&e.push(i);return e};j.prototype._removeIndexes=function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i]-e.length,a=this._segments.splice(r,1)[0];delete this._segmentsById[a.id],delete this._segmentsByPid[a.pid],e.push(a)}return e};j.prototype._removeSegments=function(t){var e=this._findSegment(t),i=this._removeIndexes(e);return this._peaks.emit("segments.remove",{segments:i}),i};j.prototype.remove=function(t){return this._removeSegments(function(e){return e===t})};j.prototype.removeById=function(t){return this._removeSegments(function(e){return e.id===t})};j.prototype.removeByTime=function(t,e){e=typeof e=="number"?e:0;var i;return e>0?i=function(a){return a.startTime===t&&a.endTime===e}:i=function(a){return a.startTime===t},this._removeSegments(i)};j.prototype.removeAll=function(){this._segments=[],this._segmentsById={},this._segmentsByPid={},this._peaks.emit("segments.remove_all")};j.prototype.setInserting=function(t){this._isInserting=t};j.prototype.isInserting=function(){return this._isInserting};var In=["OBJECT","TEXTAREA","INPUT","SELECT","OPTION"],Ar=32,Pr=9,Er=37,Dr=39,Mn=[Ar,Pr,Er,Dr];function Di(t){this.eventEmitter=t,this._handleKeyEvent=this._handleKeyEvent.bind(this),document.addEventListener("keydown",this._handleKeyEvent),document.addEventListener("keypress",this._handleKeyEvent),document.addEventListener("keyup",this._handleKeyEvent)}Di.prototype._handleKeyEvent=function(e){if(In.indexOf(e.target.nodeName)===-1){if(Mn.indexOf(e.type)>-1&&e.preventDefault(),e.type==="keydown"||e.type==="keypress")switch(e.keyCode){case Ar:this.eventEmitter.emit("keyboard.space");break;case Pr:this.eventEmitter.emit("keyboard.tab");break}else if(e.type==="keyup")switch(e.keyCode){case Er:e.shiftKey?this.eventEmitter.emit("keyboard.shift_left"):this.eventEmitter.emit("keyboard.left");break;case Dr:e.shiftKey?this.eventEmitter.emit("keyboard.shift_right"):this.eventEmitter.emit("keyboard.right");break}}};Di.prototype.destroy=function(){document.removeEventListener("keydown",this._handleKeyEvent),document.removeEventListener("keypress",this._handleKeyEvent),document.removeEventListener("keyup",this._handleKeyEvent)};function Ln(t){return!!(t.src||t.querySelector("source"))}function Ae(t){this._mediaElement=t}Ae.prototype._addMediaListener=function(t,e){this._listeners.push({type:t,callback:e}),this._mediaElement.addEventListener(t,e)};Ae.prototype.init=function(t){var e=this;return e._eventEmitter=t,e._listeners=[],e._duration=e.getDuration(),e._addMediaListener("timeupdate",function(){e._eventEmitter.emit("player.timeupdate",e.getCurrentTime())}),e._addMediaListener("playing",function(){e._eventEmitter.emit("player.playing",e.getCurrentTime())}),e._addMediaListener("pause",function(){e._eventEmitter.emit("player.pause",e.getCurrentTime())}),e._addMediaListener("ended",function(){e._eventEmitter.emit("player.ended")}),e._addMediaListener("seeked",function(){e._eventEmitter.emit("player.seeked",e.getCurrentTime())}),e._addMediaListener("canplay",function(){e._eventEmitter.emit("player.canplay")}),e._addMediaListener("error",function(i){e._eventEmitter.emit("player.error",i.target.error)}),e._interval=null,Ln(e._mediaElement)?new Promise(function(i,r){function a(n){e._mediaElement.removeEventListener("loadedmetadata",a),e._mediaElement.removeEventListener("error",a),n.type==="loadedmetadata"?i():r(n.target.error)}e._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING?(e._mediaElement.addEventListener("loadedmetadata",a),e._mediaElement.addEventListener("error",a),e._mediaElement.load()):i()}):Promise.resolve()};Ae.prototype.destroy=function(){for(var t=0;t<this._listeners.length;t++){var e=this._listeners[t];this._mediaElement.removeEventListener(e.type,e.callback)}this._listeners.length=0,this._mediaElement=null};Ae.prototype.play=function(){return this._mediaElement.play()};Ae.prototype.pause=function(){this._mediaElement.pause()};Ae.prototype.isPlaying=function(){return!this._mediaElement.paused};Ae.prototype.isSeeking=function(){return this._mediaElement.seeking};Ae.prototype.getCurrentTime=function(){return this._mediaElement.currentTime};Ae.prototype.getDuration=function(){return this._mediaElement.duration};Ae.prototype.seek=function(t){this._mediaElement.currentTime=t};function It(t,e){this._eventEmitter=t,this._mediaElement=e,this._playerCanPlayHandler=this._playerCanPlayHandler.bind(this),this._playerErrorHandler=this._playerErrorHandler.bind(this)}It.prototype.setSource=function(t,e){var i=this;return i._options=t,i._callback=e,i._eventEmitter.on("player.canplay",i._playerCanPlayHandler),i._eventEmitter.on("player.error",i._playerErrorHandler),new Promise(function(r,a){i._resolve=r,i._reject=a,i._eventEmitter.on("player.canplay",i._playerCanPlayHandler),i._eventEmitter.on("player.error",i._playerErrorHandler),i._mediaElement.setAttribute("src",t.mediaUrl),i._mediaElement.readyState===HTMLMediaElement.HAVE_NOTHING&&i._mediaElement.load()})};It.prototype._reset=function(){this._eventEmitter.removeListener("player.canplay",this._playerCanPlayHandler),this._eventEmitter.removeListener("player.error",this._playerErrorHandler)};It.prototype._playerCanPlayHandler=function(){this._reset(),this._resolve()};It.prototype._playerErrorHandler=function(t){this._reset(),this._reject(t)};Ae.prototype.setSource=function(t){if(!t.mediaUrl)return Promise.reject(new Error("peaks.setSource(): options must contain a mediaUrl when using mediaElement"));var e=new It(this._eventEmitter,this._mediaElement);return e.setSource(t)};function On(t){for(var e=[],i=t;i;)Object.getOwnPropertyNames(i).forEach(function(r){e.push(r)}),i=Object.getPrototypeOf(i);return e}function Fn(t){var e=["init","destroy","play","pause","isPlaying","isSeeking","getCurrentTime","getDuration","seek"],i=On(t);e.forEach(function(r){if(!i.includes(r))throw new TypeError("Peaks.init(): Player method "+r+" is undefined");if(typeof t[r]!="function")throw new TypeError("Peaks.init(): Player method "+r+" is not a function")})}function Ce(t,e){this._peaks=t,this._playingSegment=!1,this._segment=null,this._loop=!1,this._playSegmentTimerCallback=this._playSegmentTimerCallback.bind(this),Fn(e),this._adapter=e}Ce.prototype.init=function(){return this._adapter.init(this._peaks)};Ce.prototype.destroy=function(){this._adapter.destroy()};Ce.prototype.play=function(){return this._adapter.play()};Ce.prototype.pause=function(){this._adapter.pause()};Ce.prototype.isPlaying=function(){return this._adapter.isPlaying()};Ce.prototype.isSeeking=function(){return this._adapter.isSeeking()};Ce.prototype.getCurrentTime=function(){return this._adapter.getCurrentTime()};Ce.prototype.getDuration=function(){return this._adapter.getDuration()};Ce.prototype.seek=function(t){if(!ze(t)){this._peaks._logger("peaks.player.seek(): parameter must be a valid time, in seconds");return}this._adapter.seek(t)};Ce.prototype.playSegment=function(t,e){var i=this;return!t||!ze(t.startTime)||!ze(t.endTime)?Promise.reject(new Error("peaks.player.playSegment(): parameter must be a segment object")):(i._segment=t,i._loop=e,i.seek(t.startTime),i._peaks.once("player.playing",function(){i._playingSegment||(i._playingSegment=!0,window.requestAnimationFrame(i._playSegmentTimerCallback))}),i.play())};Ce.prototype._playSegmentTimerCallback=function(){if(this.isPlaying()){if(this.getCurrentTime()>=this._segment.endTime)if(this._loop)this.seek(this._segment.startTime);else{this.pause(),this._peaks.emit("player.ended"),this._playingSegment=!1;return}}else{this._playingSegment=!1;return}window.requestAnimationFrame(this._playSegmentTimerCallback)};Ce.prototype._setSource=function(t){return this._adapter.setSource(t)};function Mt(t){this._options=t,this._draggable=t.editable}Mt.prototype.init=function(t){var e=10,i=20,r=-(e/2)+.5;this._options.view==="zoomview"&&(this._label=new tt({x:2,y:0,text:this._options.point.labelText,textAlign:"left",fontFamily:this._options.fontFamily||"sans-serif",fontSize:this._options.fontSize||10,fontStyle:this._options.fontStyle||"normal",fill:"#000"})),this._handle=new mt({x:r,y:0,width:e,height:i,fill:this._options.color,visible:this._draggable}),this._line=new ii({x:0,y:0,stroke:this._options.color,strokeWidth:1}),this._time=new tt({x:-24,y:0,text:this._options.layer.formatTime(this._options.point.time),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center"}),this._time.hide(),t.add(this._handle),t.add(this._line),this._label&&t.add(this._label),t.add(this._time),this.fitToView(),this.bindEventHandlers(t)};Mt.prototype.bindEventHandlers=function(t){var e=this;e._handle.on("mouseover touchstart",function(){e._draggable&&(e._time.setX(-24-e._time.getWidth()),e._time.show())}),e._handle.on("mouseout touchend",function(){e._draggable&&e._time.hide()}),t.on("dragstart",function(){e._time.setX(-24-e._time.getWidth()),e._time.show()}),t.on("dragend",function(){e._time.hide()})};Mt.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._line.points([.5,0,.5,t]),this._label&&this._label.y(12),this._handle&&this._handle.y(t/2-10.5),this._time&&this._time.y(t/2-5)};Mt.prototype.update=function(t){t.time!==void 0&&this._time&&this._time.setText(this._options.layer.formatTime(t.time)),t.labelText!==void 0&&this._label&&this._label.text(t.labelText),t.color!==void 0&&(this._handle&&this._handle.fill(t.color),this._line.stroke(t.color)),t.editable!==void 0&&(this._draggable=t.editable,this._handle.visible(this._draggable))};function Lt(t){this._options=t,this._editable=t.editable}Lt.prototype.init=function(t){var e=10,i=20,r=-(e/2)+.5,a=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new tt({x:a,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:this._editable}),this._label.hide(),this._handle=new mt({x:r,y:0,width:e,height:i,fill:this._options.color,stroke:this._options.color,strokeWidth:1,visible:this._editable}),this._line=new ii({x:0,y:0,stroke:this._options.color,strokeWidth:1,visible:this._editable}),t.add(this._label),t.add(this._line),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)};Lt.prototype.bindEventHandlers=function(t){var e=this,i=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(i-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(i-e._label.getWidth()),e._label.show()}),e._handle.on("mouseout touchend",function(){e._label.hide()})};Lt.prototype.fitToView=function(){var t=this._options.layer.getHeight();this._label.y(t/2-5),this._handle.y(t/2-10.5),this._line.points([.5,0,.5,t])};Lt.prototype.update=function(t){t.startTime!==void 0&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),t.endTime!==void 0&&!this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.endTime)),t.editable!==void 0&&(this._editable=t.editable,this._label.visible(this._editable),this._handle.visible(this._editable),this._line.visible(this._editable))};function Gn(t){return t.view==="zoomview"?new Lt(t):null}function Rn(t){return new tt({x:12,y:12,text:t.segment.labelText,textAlign:"center",fontFamily:t.fontFamily||"sans-serif",fontSize:t.fontSize||12,fontStyle:t.fontStyle||"normal",fill:"#000"})}function Wn(t){return new Mt(t)}function Je(t,e){this._view=t,this._offset=e.highlightOffset,this._color=e.highlightColor,this._layer=new ne.Layer({listening:!1}),this._highlightRect=null,this._startTime=null,this._endTime=null,this._strokeColor=e.highlightStrokeColor,this._opacity=e.highlightOpacity,this._cornerRadius=e.highlightCornerRadius}Je.prototype.addToStage=function(t){t.add(this._layer)};Je.prototype.showHighlight=function(t,e){this._highlightRect||this._createHighlightRect(t,e),this._update(t,e)};Je.prototype._update=function(t,e){this._startTime=t,this._endTime=e;var i=this._view.timeToPixels(t),r=this._view.timeToPixels(e);this._highlightRect.setAttrs({x:i,width:r-i})};Je.prototype._createHighlightRect=function(t,e){this._startTime=t,this._endTime=e;var i=this._view.timeToPixels(t),r=this._view.timeToPixels(e);this._highlightRect=new mt({x:i,y:0,width:r-i,height:0,stroke:this._strokeColor,strokeWidth:1,fill:this._color,opacity:this._opacity,cornerRadius:this._cornerRadius}),this.fitToView(),this._layer.add(this._highlightRect)};Je.prototype.removeHighlight=function(){this._highlightRect&&(this._highlightRect.destroy(),this._highlightRect=null)};Je.prototype.updateHighlight=function(){this._highlightRect&&this._update(this._startTime,this._endTime)};Je.prototype.fitToView=function(){if(this._highlightRect){var t=this._view.getHeight(),e=Se(this._offset,0,Math.floor(t/2));this._highlightRect.setAttrs({y:e,height:t-e*2})}};function De(t){this._point=t.point,this._marker=t.marker,this._draggable=t.draggable,this._onDragStart=t.onDragStart,this._onDragMove=t.onDragMove,this._onDragEnd=t.onDragEnd,this._dragBoundFunc=t.dragBoundFunc,this._onMouseEnter=t.onMouseEnter,this._onMouseLeave=t.onMouseLeave,this._group=new ne.Group({name:"point-marker",point:this._point,draggable:this._draggable,dragBoundFunc:t.dragBoundFunc}),this._bindDefaultEventHandlers(),this._marker.init(this._group)}De.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("dragstart",function(e){t._onDragStart(e,t._point)}),t._group.on("dragmove",function(e){t._onDragMove(e,t._point)}),t._group.on("dragend",function(e){t._onDragEnd(e,t._point)}),t._group.on("mouseenter",function(e){t._onMouseEnter(e,t._point)}),t._group.on("mouseleave",function(e){t._onMouseLeave(e,t._point)})};De.prototype.addToLayer=function(t){t.add(this._group)};De.prototype.fitToView=function(){this._marker.fitToView()};De.prototype.getPoint=function(){return this._point};De.prototype.getX=function(){return this._group.getX()};De.prototype.setX=function(t){this._group.setX(t)};De.prototype.getWidth=function(){return this._group.getWidth()};De.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()};De.prototype.update=function(t){t.editable!==void 0&&this._group.draggable(t.editable),this._marker.update&&this._marker.update(t)};De.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()};var Bn="sans-serif",Un=10,Vn="normal";function X(t,e,i){this._peaks=t,this._view=e,this._allowEditing=i,this._pointMarkers={},this._layer=new ne.Layer,this._onPointsDrag=this._onPointsDrag.bind(this),this._onPointMarkerDragStart=this._onPointMarkerDragStart.bind(this),this._onPointMarkerDragMove=this._onPointMarkerDragMove.bind(this),this._onPointMarkerDragEnd=this._onPointMarkerDragEnd.bind(this),this._pointMarkerDragBoundFunc=this._pointMarkerDragBoundFunc.bind(this),this._onPointMarkerMouseEnter=this._onPointMarkerMouseEnter.bind(this),this._onPointMarkerMouseLeave=this._onPointMarkerMouseLeave.bind(this),this._onPointsUpdate=this._onPointsUpdate.bind(this),this._onPointsAdd=this._onPointsAdd.bind(this),this._onPointsRemove=this._onPointsRemove.bind(this),this._onPointsRemoveAll=this._onPointsRemoveAll.bind(this),this._peaks.on("points.update",this._onPointsUpdate),this._peaks.on("points.add",this._onPointsAdd),this._peaks.on("points.remove",this._onPointsRemove),this._peaks.on("points.remove_all",this._onPointsRemoveAll),this._peaks.on("points.dragstart",this._onPointsDrag),this._peaks.on("points.dragmove",this._onPointsDrag),this._peaks.on("points.dragend",this._onPointsDrag)}X.prototype.addToStage=function(t){t.add(this._layer)};X.prototype.enableEditing=function(t){this._allowEditing=t};X.prototype.getPointMarker=function(t){return this._pointMarkers[t.pid]};X.prototype.formatTime=function(t){return this._view.formatTime(t)};X.prototype._onPointsUpdate=function(t,e){var i=this._view.getStartTime(),r=this._view.getEndTime(),a=this.getPointMarker(t),n=t.isVisible(i,r);if(a&&!n)this._removePoint(t);else if(!a&&n)this._updatePoint(t);else if(a&&n){if(I(e,"time")){var s=this._view.timeToPixels(t.time),h=s-this._view.getFrameOffset();a.setX(h)}a.update(e)}};X.prototype._onPointsAdd=function(t){var e=this,i=e._view.getStartTime(),r=e._view.getEndTime();t.points.forEach(function(a){a.isVisible(i,r)&&e._updatePoint(a)})};X.prototype._onPointsRemove=function(t){var e=this;t.points.forEach(function(i){e._removePoint(i)})};X.prototype._onPointsRemoveAll=function(){this._layer.removeChildren(),this._pointMarkers={}};X.prototype._createPointMarker=function(t){var e=this._allowEditing&&t.editable,i=this._peaks.options.createPointMarker({point:t,editable:e,color:t.color,fontFamily:this._peaks.options.fontFamily||Bn,fontSize:this._peaks.options.fontSize||Un,fontStyle:this._peaks.options.fontStyle||Vn,layer:this,view:this._view.getName()});return new De({point:t,draggable:e,marker:i,onDragStart:this._onPointMarkerDragStart,onDragMove:this._onPointMarkerDragMove,onDragEnd:this._onPointMarkerDragEnd,dragBoundFunc:this._pointMarkerDragBoundFunc,onMouseEnter:this._onPointMarkerMouseEnter,onMouseLeave:this._onPointMarkerMouseLeave})};X.prototype.getHeight=function(){return this._view.getHeight()};X.prototype._addPointMarker=function(t){var e=this._createPointMarker(t);return this._pointMarkers[t.pid]=e,e.addToLayer(this._layer),e};X.prototype._onPointsDrag=function(t){var e=this._updatePoint(t.point);e.update({time:t.point.time})};X.prototype._onPointMarkerMouseEnter=function(t,e){this._peaks.emit("points.mouseenter",{point:e,evt:t.evt})};X.prototype._onPointMarkerMouseLeave=function(t,e){this._peaks.emit("points.mouseleave",{point:e,evt:t.evt})};X.prototype._onPointMarkerDragStart=function(t,e){this._dragPointMarker=this.getPointMarker(e),this._peaks.emit("points.dragstart",{point:e,evt:t.evt})};X.prototype._onPointMarkerDragMove=function(t,e){var i=this._pointMarkers[e.pid],r=i.getX(),a=r+i.getWidth();e._setTime(this._view.pixelOffsetToTime(a)),this._peaks.emit("points.dragmove",{point:e,evt:t.evt})};X.prototype._onPointMarkerDragEnd=function(t,e){this._dragPointMarker=null,this._peaks.emit("points.dragend",{point:e,evt:t.evt})};X.prototype._pointMarkerDragBoundFunc=function(t){return{x:Se(t.x,0,this._view.getWidth()),y:this._dragPointMarker.getAbsolutePosition().y}};X.prototype.updatePoints=function(t,e){var i=this._peaks.points.find(t,e);i.forEach(this._updatePoint.bind(this)),this._removeInvisiblePoints(t,e)};X.prototype._updatePoint=function(t){var e=this.getPointMarker(t);e||(e=this._addPointMarker(t));var i=this._view.timeToPixels(t.time),r=i-this._view.getFrameOffset();return e.setX(r),e};X.prototype._removeInvisiblePoints=function(t,e){for(var i in this._pointMarkers)if(I(this._pointMarkers,i)){var r=this._pointMarkers[i].getPoint();r.isVisible(t,e)||this._removePoint(r)}};X.prototype._removePoint=function(t){var e=this.getPointMarker(t);e&&(e.destroy(),delete this._pointMarkers[t.pid])};X.prototype.setVisible=function(t){this._layer.setVisible(t)};X.prototype.destroy=function(){this._peaks.off("points.update",this._onPointsUpdate),this._peaks.off("points.add",this._onPointsAdd),this._peaks.off("points.remove",this._onPointsRemove),this._peaks.off("points.remove_all",this._onPointsRemoveAll),this._peaks.off("points.dragstart",this._onPointsDrag),this._peaks.off("points.dragmove",this._onPointsDrag),this._peaks.off("points.dragend",this._onPointsDrag)};X.prototype.fitToView=function(){for(var t in this._pointMarkers)if(I(this._pointMarkers,t)){var e=this._pointMarkers[t];e.fitToView()}};X.prototype.draw=function(){this._layer.draw()};function ve(t){this._player=t.player,this._view=t.view,this._playheadPixel=0,this._playheadLineAnimation=null,this._playheadVisible=!1,this._playheadColor=t.playheadColor,this._playheadTextColor=t.playheadTextColor,this._playheadBackgroundColor=t.playheadBackgroundColor,this._playheadPadding=t.playheadPadding,this._playheadFontFamily=t.playheadFontFamily,this._playheadFontSize=t.playheadFontSize,this._playheadFontStyle=t.playheadFontStyle,this._playheadLayer=new ne.Layer,this._createPlayhead(),t.showPlayheadTime&&this._createPlayheadText(),this.fitToView(),this.zoomLevelChanged()}ve.prototype.addToStage=function(t){t.add(this._playheadLayer)};ve.prototype.zoomLevelChanged=function(){var t=this._view.timeToPixels(1);if(this._useAnimation=t>=5,this._useAnimation)this._player.isPlaying()&&!this._playheadLineAnimation&&this._start();else if(this._playheadLineAnimation){var e=this._player.getCurrentTime();this.stop(e)}};ve.prototype.fitToView=function(){var t=this._view.getHeight();this._playheadLine.points([.5,0,.5,t]),this._playheadText&&this._playheadText.y(12)};ve.prototype._createPlayhead=function(){this._playheadLine=new ii({stroke:this._playheadColor,strokeWidth:1}),this._playheadGroup=new ne.Group({x:0,y:0}),this._playheadGroup.add(this._playheadLine),this._playheadLayer.add(this._playheadGroup)};ve.prototype._createPlayheadText=function(){var t=this,e=t._player.getCurrentTime(),i=t._view.formatTime(e);t._playheadText=new tt({x:0,y:0,padding:t._playheadPadding,text:i,fontSize:t._playheadFontSize,fontFamily:t._playheadFontFamily,fontStyle:t._playheadFontStyle,fill:t._playheadTextColor,align:"right",sceneFunc:function(a,n){var s=n.width(),h=n.height()+2*t._playheadPadding;a.fillStyle=t._playheadBackgroundColor,a.fillRect(0,-t._playheadPadding,s,h),n._sceneFunc(a)}}),t._playheadGroup.add(t._playheadText)};ve.prototype.updatePlayheadTime=function(t){this._syncPlayhead(t),this._player.isPlaying()&&this._start()};ve.prototype._syncPlayhead=function(t){var e=this._view.timeToPixels(t),i=this._view.getFrameOffset(),r=this._view.getWidth(),a=e>=i&&e<=i+r;if(this._playheadPixel=e,a){var n=this._playheadPixel-i;if(this._playheadVisible||(this._playheadVisible=!0,this._playheadGroup.show()),this._playheadGroup.setX(n),this._playheadText){var s=this._view.formatTime(t),h=this._playheadText.width();this._playheadText.setText(s),h+n>r-2?this._playheadText.setX(-h):h+n<r&&this._playheadText.setX(0)}}else this._playheadVisible&&(this._playheadVisible=!1,this._playheadGroup.hide());this._view.playheadPosChanged&&this._view.playheadPosChanged(t)};ve.prototype._start=function(){var t=this;if(t._playheadLineAnimation&&(t._playheadLineAnimation.stop(),t._playheadLineAnimation=null),!!t._useAnimation){var e=null;t._playheadLineAnimation=new hr(function(){var i=t._player.getCurrentTime(),r=t._view.timeToPixels(i);r!==e&&(t._syncPlayhead(i),e=r)},t._playheadLayer),t._playheadLineAnimation.start()}};ve.prototype.stop=function(t){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null),this._syncPlayhead(t)};ve.prototype.getPlayheadPixel=function(){return this._playheadPixel};ve.prototype.showPlayheadTime=function(t){t?this._playheadText||(this._createPlayheadText(this._playheadTextColor,this._playheadBackgroundColor,this._playheadPadding),this.fitToView()):this._playheadText&&(this._playheadText.remove(),this._playheadText.destroy(),this._playheadText=null)};ve.prototype.updatePlayheadText=function(){if(this._playheadText){var t=this._player.getCurrentTime(),e=this._view.formatTime(t);this._playheadText.setText(e)}};ve.prototype.destroy=function(){this._playheadLineAnimation&&(this._playheadLineAnimation.stop(),this._playheadLineAnimation=null)};function Ot(t){this._options=t}Ot.prototype.init=function(t){var e=10,i=20,r=-(e/2)+.5,a=this._options.startMarker?-24:24,n=this._options.startMarker?this._options.segment.startTime:this._options.segment.endTime;this._label=new tt({x:a,y:0,text:this._options.layer.formatTime(n),fontFamily:this._options.fontFamily,fontSize:this._options.fontSize,fontStyle:this._options.fontStyle,fill:"#000",textAlign:"center",visible:!1}),this._handle=new mt({x:r,y:0,width:e,height:i}),t.add(this._label),t.add(this._handle),this.fitToView(),this.bindEventHandlers(t)};Ot.prototype.bindEventHandlers=function(t){var e=this,i=e._options.startMarker?-24:24;t.on("dragstart",function(){e._options.startMarker&&e._label.setX(i-e._label.getWidth()),e._label.show()}),t.on("dragend",function(){e._label.hide()}),e._handle.on("mouseover touchstart",function(){e._options.startMarker&&e._label.setX(i-e._label.getWidth()),e._label.show(),document.body.style.cursor="ew-resize"}),e._handle.on("mouseout touchend",function(){e._label.hide(),document.body.style.cursor="default"})};Ot.prototype.fitToView=function(){var t=this._options.layer.getHeight(),e=this._options.segmentOptions.overlayOffset,i=Se(0,t-2*e);this._label.y(t/2-5),this._handle.y(e),this._handle.height(i)};Ot.prototype.update=function(t){t.startTime!==void 0&&this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.startTime)),t.endTime!==void 0&&!this._options.startMarker&&this._label.text(this._options.layer.formatTime(t.endTime))};function _e(t){var e=this;e._segment=t.segment,e._marker=t.marker,e._segmentShape=t.segmentShape,e._editable=t.editable,e._startMarker=t.startMarker,e._onDragStart=t.onDragStart,e._onDragMove=t.onDragMove,e._onDragEnd=t.onDragEnd,e._group=new ne.Group({name:"segment-marker",segment:e._segment,draggable:e._editable,visible:e._editable,dragBoundFunc:function(r){return t.dragBoundFunc(e,r)}}),e._bindDefaultEventHandlers(),e._marker.init(e._group)}_e.prototype._bindDefaultEventHandlers=function(){var t=this;t._group.on("dragstart",function(e){t._onDragStart(t,e)}),t._group.on("dragmove",function(e){t._onDragMove(t,e)}),t._group.on("dragend",function(e){t._onDragEnd(t,e)})};_e.prototype.addToLayer=function(t){t.add(this._group)};_e.prototype.moveToTop=function(){this._group.moveToTop()};_e.prototype.fitToView=function(){this._marker.fitToView()};_e.prototype.getSegment=function(){return this._segment};_e.prototype.getX=function(){return this._group.getX()};_e.prototype.setX=function(t){this._group.setX(t)};_e.prototype.getWidth=function(){return this._group.getWidth()};_e.prototype.getAbsolutePosition=function(){return this._group.getAbsolutePosition()};_e.prototype.isStartMarker=function(){return this._startMarker};_e.prototype.update=function(t){t.editable!==void 0&&(this._group.visible(t.editable),this._group.draggable(t.editable)),this._marker.update&&this._marker.update(t)};_e.prototype.destroy=function(){this._marker.destroy&&this._marker.destroy(),this._group.destroyChildren(),this._group.destroy()};_e.prototype.startDrag=function(){this._group.startDrag()};_e.prototype.stopDrag=function(){this._group.stopDrag()};function he(t){this._color=t.color;var e={};if(et(t.color))e.fill=t.color;else if(si(t.color)){var i=t.view._height*(t.color.linearGradientStart/100),r=t.view._height*(t.color.linearGradientEnd/100);e.fillLinearGradientStartPointY=i,e.fillLinearGradientEndPointY=r,e.fillLinearGradientColorStops=[0,t.color.linearGradientColorStops[0],1,t.color.linearGradientColorStops[1]]}else throw new TypeError("Unknown type for color property");this._shape=new ne.Shape(e),this._view=t.view,this._segment=t.segment,this._shape.sceneFunc(this._sceneFunc.bind(this))}he.prototype.getX=function(){return this._shape.getX()};he.prototype.setX=function(t){return this._shape.setX(t)};he.prototype.setSegment=function(t){this._segment=t};he.prototype.setWaveformColor=function(t){if(et(t))this._shape.fill(t),this._shape.fillLinearGradientStartPointY(null),this._shape.fillLinearGradientEndPointY(null),this._shape.fillLinearGradientColorStops(null);else if(si(t)){this._shape.fill(null);var e=this._view._height*(t.linearGradientStart/100),i=this._view._height*(t.linearGradientEnd/100);this._shape.fillLinearGradientStartPointY(e),this._shape.fillLinearGradientEndPointY(i),this._shape.fillLinearGradientColorStops([0,t.linearGradientColorStops[0],1,t.linearGradientColorStops[1]])}else throw new TypeError("Unknown type for color property")};he.prototype.fitToView=function(){this.setWaveformColor(this._color)};he.prototype._sceneFunc=function(t){var e=this._view.getFrameOffset(),i=this._view.getWidth(),r=this._view.getHeight();this._drawWaveform(t,this._view.getWaveformData(),e,this._segment?this._view.timeToPixels(this._segment.startTime):e,this._segment?this._view.timeToPixels(this._segment.endTime):e+i,i,r)};he.prototype._drawWaveform=function(t,e,i,r,a,n,s){r<i&&(r=i);var h=i+n;a>h&&(a=h),a>e.length-1&&(a=e.length-1);for(var l=e.channels,u=0,g=Math.floor(s/l),w=0;w<l;w++)w===l-1&&(g=s-(l-1)*g),this._drawChannel(t,e.channel(w),i,r,a,u,g),u+=g};he.prototype._drawChannel=function(t,e,i,r,a,n,s){var h,l,u=this._view.getAmplitudeScale(),g,w;for(t.beginPath(),h=r;h<=a;h++)l=e.min_sample(h),g=h-i+.5,w=n+he.scaleY(l,s,u)+.5,t.lineTo(g,w);for(h=a;h>=r;h--)l=e.max_sample(h),g=h-i+.5,w=n+he.scaleY(l,s,u)+1,t.lineTo(g,w);t.closePath(),t.fillShape(this._shape)};he.prototype.addToLayer=function(t){t.add(this._shape)};he.prototype.destroy=function(){this._shape.destroy(),this._shape=null};he.prototype.on=function(t,e){this._shape.on(t,e)};he.prototype.off=function(t,e){this._shape.off(t,e)};he.scaleY=function(t,e,i){var r=-(e-1)*(t*i+128)/255+(e-1);return Se(Math.floor(r),0,e-1)};var Ki="sans-serif",ji=10,Ji="normal";function V(t,e,i,r){this._segment=t,this._peaks=e,this._layer=i,this._view=r,this._label=null,this._startMarker=null,this._endMarker=null,this._color=t.color,this._borderColor=t.borderColor,this._draggable=this._segment.editable&&this._view.isSegmentDraggingEnabled(),this._dragging=!1;var a=r.getViewOptions().segmentOptions;this._overlayOffset=a.overlayOffset,a.overlay||(this._waveformShape=new he({color:t.color,view:r,segment:t})),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onSegmentDragStart=this._onSegmentDragStart.bind(this),this._onSegmentDragMove=this._onSegmentDragMove.bind(this),this._onSegmentDragEnd=this._onSegmentDragEnd.bind(this),this._onSegmentMarkerDragStart=this._onSegmentMarkerDragStart.bind(this),this._onSegmentMarkerDragMove=this._onSegmentMarkerDragMove.bind(this),this._onSegmentMarkerDragEnd=this._onSegmentMarkerDragEnd.bind(this),this._segmentMarkerDragBoundFunc=this._segmentMarkerDragBoundFunc.bind(this),this._label=this._peaks.options.createSegmentLabel({segment:t,view:this._view.getName(),layer:this._layer,fontFamily:this._peaks.options.fontFamily,fontSize:this._peaks.options.fontSize,fontStyle:this._peaks.options.fontStyle}),this._label&&this._label.hide();var n=this._view.timeToPixelOffset(this._segment.startTime),s=this._view.timeToPixelOffset(this._segment.endTime),h=Se(0,this._view.getHeight()-2*this._overlayOffset);this._overlay=new ne.Group({name:"segment-overlay",segment:this._segment,x:n,y:0,width:s-n,height:this._view.getHeight(),clipX:0,clipY:this._overlayOffset,clipWidth:s-n,clipHeight:h,draggable:this._draggable,dragBoundFunc:this._dragBoundFunc});var l,u,g,w,S;a.overlay&&(l=this._borderColor||a.overlayBorderColor,u=a.overlayBorderWidth,g=this._color||a.overlayColor,w=a.overlayOpacity,S=a.overlayCornerRadius),this._overlayRect=new ne.Rect({x:0,y:this._overlayOffset,width:s-n,stroke:l,strokeWidth:u,height:h,fill:g,opacity:w,cornerRadius:S}),this._overlay.add(this._overlayRect),a.overlay&&(this._overlayText=new ne.Text({x:0,y:this._overlayOffset,text:this._segment.labelText,fontFamily:a.overlayFontFamily,fontSize:a.overlayFontSize,fontStyle:a.overlayFontStyle,fill:a.overlayLabelColor,listening:!1,align:a.overlayLabelAlign,width:s-n,verticalAlign:a.overlayLabelVerticalAlign,height:h,padding:a.overlayLabelPadding}),this._overlay.add(this._overlayText)),this._overlay.on("mouseenter",this._onMouseEnter),this._overlay.on("mouseleave",this._onMouseLeave),this._overlay.on("mousedown",this._onMouseDown),this._overlay.on("mouseup",this._onMouseUp),this._draggable&&(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)),this._createMarkers()}function Hn(t){return new Ot(t)}V.prototype._createMarkers=function(){var t=this._layer.isEditingEnabled()&&this._segment.editable,e=this._view.getViewOptions().segmentOptions,i=e.markers?this._peaks.options.createSegmentMarker:Hn,r=i({segment:this._segment,editable:t,startMarker:!0,color:e.startMarkerColor,fontFamily:this._peaks.options.fontFamily||Ki,fontSize:this._peaks.options.fontSize||ji,fontStyle:this._peaks.options.fontStyle||Ji,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions});r&&(this._startMarker=new _e({segment:this._segment,segmentShape:this,editable:t,startMarker:!0,marker:r,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}));var a=i({segment:this._segment,editable:t,startMarker:!1,color:e.endMarkerColor,fontFamily:this._peaks.options.fontFamily||Ki,fontSize:this._peaks.options.fontSize||ji,fontStyle:this._peaks.options.fontStyle||Ji,layer:this._layer,view:this._view.getName(),segmentOptions:this._view.getViewOptions().segmentOptions});a&&(this._endMarker=new _e({segment:this._segment,segmentShape:this,editable:t,startMarker:!1,marker:a,onDragStart:this._onSegmentMarkerDragStart,onDragMove:this._onSegmentMarkerDragMove,onDragEnd:this._onSegmentMarkerDragEnd,dragBoundFunc:this._segmentMarkerDragBoundFunc}))};V.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}};V.prototype.update=function(t){var e=this._view.timeToPixelOffset(this._segment.startTime),i=this._view.timeToPixelOffset(this._segment.endTime),r=i-e,a;(a=this.getStartMarker())&&(a.setX(e-a.getWidth()),t&&a.update(t)),(a=this.getEndMarker())&&(a.setX(i),t&&a.update(t)),this._color=this._segment.color,this._borderColor=this._segment.bordercolor,this._overlayText&&this._overlayText.text(this._segment.labelText);var n=this._view.getViewOptions().segmentOptions;n.overlay?(this._color&&this._overlayRect.fill(this._color),this._borderColor&&this._overlayRect.stroke(this._borderColor)):this._waveformShape.setWaveformColor(this._segment.color),this._dragging||this._overlay&&(this._overlay.setAttrs({x:e,width:r,clipWidth:r<1?1:r}),this._overlayRect.setAttrs({x:0,width:r}),this._overlayText&&this._overlayText.setAttrs({width:r}))};V.prototype.getSegment=function(){return this._segment};V.prototype.getStartMarker=function(){return this._startMarker};V.prototype.getEndMarker=function(){return this._endMarker};V.prototype.addToLayer=function(t){this._waveformShape&&this._waveformShape.addToLayer(t),this._label&&t.add(this._label),this._overlay&&t.add(this._overlay),this._startMarker&&this._startMarker.addToLayer(t),this._endMarker&&this._endMarker.addToLayer(t)};V.prototype.isDragging=function(){return this._dragging};V.prototype._onMouseEnter=function(t){this._label&&(this._label.moveToTop(),this._label.show()),this._peaks.emit("segments.mouseenter",{segment:this._segment,evt:t.evt})};V.prototype._onMouseLeave=function(t){this._label&&this._label.hide(),this._peaks.emit("segments.mouseleave",{segment:this._segment,evt:t.evt})};V.prototype._onMouseDown=function(t){this._peaks.emit("segments.mousedown",{segment:this._segment,evt:t.evt})};V.prototype._onMouseUp=function(t){this._peaks.emit("segments.mouseup",{segment:this._segment,evt:t.evt})};V.prototype.segmentClicked=function(t,e){this._moveToTop(),this._peaks.emit("segments."+t,e)};V.prototype._moveToTop=function(){this._overlay.moveToTop(),this._layer.moveSegmentMarkersToTop()};V.prototype.enableSegmentDragging=function(t){this._segment.editable&&(!this._draggable&&t?(this._overlay.on("dragstart",this._onSegmentDragStart),this._overlay.on("dragmove",this._onSegmentDragMove),this._overlay.on("dragend",this._onSegmentDragEnd)):this._draggable&&!t&&(this._overlay.off("dragstart",this._onSegmentDragStart),this._overlay.off("dragmove",this._onSegmentDragMove),this._overlay.off("dragend",this._onSegmentDragEnd)),this._overlay.draggable(t),this._draggable=t)};V.prototype._setPreviousAndNextSegments=function(){this._view.getSegmentDragMode()!=="overlap"?(this._nextSegment=this._peaks.segments.findNextSegment(this._segment),this._previousSegment=this._peaks.segments.findPreviousSegment(this._segment)):(this._nextSegment=null,this._previousSegment=null)};V.prototype._onSegmentDragStart=function(t){this._setPreviousAndNextSegments(),this._dragging=!0,this._dragStartX=this._overlay.getX(),this._dragStartTime=this._segment.startTime,this._dragEndTime=this._segment.endTime,this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})};V.prototype._onSegmentDragMove=function(t){var e=this._overlay.getX(),i=e-this._dragStartX,r=this._view.pixelsToTime(i),a=this._dragStartTime+r,n=this._dragEndTime+r,s=this._segment.endTime-this._segment.startTime,h,l=this._view.getMinSegmentDragWidth(),u=this._view.pixelsToTime(l),g=!1,w=!1;if(a<0&&(a=0,n=s,this._overlay.setX(this._view.timeToPixelOffset(a))),this._previousSegment){var S=this._view.timeToPixelOffset(this._previousSegment.endTime);if(a<this._previousSegment.endTime){if(h=this._view.getSegmentDragMode(),h==="no-overlap"||h==="compress"&&!this._previousSegment.editable)a=this._previousSegment.endTime,n=a+s,this._overlay.setX(S);else if(h==="compress"){var c=a,f=this._previousSegment.startTime+u;c<f&&(c=f,S=this._view.timeToPixelOffset(c),this._overlay.setX(S),a=c,n=a+s),this._previousSegment.update({endTime:c}),g=!0}}}if(this._nextSegment){var v=this._view.timeToPixelOffset(this._nextSegment.startTime);if(n>this._nextSegment.startTime){if(h=this._view.getSegmentDragMode(),h==="no-overlap"||h==="compress"&&!this._nextSegment.editable)n=this._nextSegment.startTime,a=n-s,this._overlay.setX(v-this._overlay.getWidth());else if(h==="compress"){var _=n,T=this._nextSegment.endTime-u;_>T&&(_=T,v=this._view.timeToPixelOffset(_),this._overlay.setX(v-this._overlay.getWidth()),n=_,a=n-s),this._nextSegment.update({startTime:_}),w=!0}}}this._segment._setStartTime(a),this._segment._setEndTime(n),this._peaks.emit("segments.dragged",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt}),g?this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!1,startMarker:!1,evt:t.evt}):w&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!1,startMarker:!1,evt:t.evt})};V.prototype._onSegmentDragEnd=function(t){this._dragging=!1,this._peaks.emit("segments.dragend",{segment:this._segment,marker:!1,startMarker:!1,evt:t.evt})};V.prototype.moveMarkersToTop=function(){this._startMarker&&this._startMarker.moveToTop(),this._endMarker&&this._endMarker.moveToTop()};V.prototype.startDrag=function(){this._endMarker&&this._endMarker.startDrag()};V.prototype.stopDrag=function(){this._endMarker&&this._endMarker.stopDrag()};V.prototype._onSegmentMarkerDragStart=function(t,e){this._setPreviousAndNextSegments(),this._moveToTop(),this._startMarkerX=this._startMarker.getX(),this._endMarkerX=this._endMarker.getX(),this._peaks.emit("segments.dragstart",{segment:this._segment,marker:!0,startMarker:t.isStartMarker(),evt:e.evt})};V.prototype._onSegmentMarkerDragMove=function(t,e){t.isStartMarker()?(this._segmentStartMarkerDragMove(t,e),t.update({startTime:this._segment.startTime})):(this._segmentEndMarkerDragMove(t,e),t.update({endTime:this._segment.endTime}))};function Ir(t){return t.endTime-t.startTime}V.prototype._segmentStartMarkerDragMove=function(t,e){var i=this._view.getWidth(),r=this._startMarker.getX(),a=this._endMarker.getX(),n=this._view.pixelsToTime(50),s=this._view.getMinSegmentDragWidth(),h=this._endMarker.getX()-s;h>i&&(h=i);var l=!1,u=!1,g;if(this._previousSegment&&(g=this._view.timeToPixelOffset(this._previousSegment.endTime),l=g>=0),r>h)t.setX(h),this._overlay.clipWidth(h-a),s===0&&h<i?this._segment._setStartTime(this._segment.endTime):this._segment._setStartTime(this._view.pixelOffsetToTime(h));else if(this._previousSegment&&l){var w=this._view.getSegmentDragMode(),S=w==="no-overlap"||w==="compress"&&!this._previousSegment.editable,c=w==="compress"&&this._previousSegment.editable;if(r<=g){if(S)t.setX(g),this._overlay.clipWidth(g-a),this._segment._setStartTime(this._previousSegment.endTime);else if(c){var f=Ir(this._previousSegment);f<n&&(n=f);var v=this._view.timeToPixelOffset(this._previousSegment.startTime+n);r<v&&(r=v),t.setX(r),this._overlay.clipWidth(a-r),this._segment._setStartTime(this._view.pixelOffsetToTime(r)),this._previousSegment.update({endTime:this._view.pixelOffsetToTime(r)}),u=!0}}else r<0&&(r=0),t.setX(r),this._overlay.clipWidth(a-r),this._segment._setStartTime(this._view.pixelOffsetToTime(r))}else r<0&&(r=0),t.setX(r),this._overlay.clipWidth(a-r),this._segment._setStartTime(this._view.pixelOffsetToTime(r));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!0,evt:e.evt}),u&&this._peaks.emit("segments.dragged",{segment:this._previousSegment,marker:!0,startMarker:!1,evt:e.evt})};V.prototype._segmentEndMarkerDragMove=function(t,e){var i=this._view.getWidth(),r=this._startMarker.getX(),a=this._endMarker.getX(),n=this._view.pixelsToTime(50),s=this._view.getMinSegmentDragWidth(),h=this._startMarker.getX()+s;h<0&&(h=0);var l=!1,u=!1,g;if(this._nextSegment&&(g=this._view.timeToPixelOffset(this._nextSegment.startTime),l=g<i),a<h)t.setX(h),this._overlay.clipWidth(h-r),s===0&&h>0?this._segment._setEndTime(this._segment.startTime):this._segment._setEndTime(this._view.pixelOffsetToTime(h));else if(this._nextSegment&&l){var w=this._view.getSegmentDragMode(),S=w==="no-overlap"||w==="compress"&&!this._nextSegment.editable,c=w==="compress"&&this._nextSegment.editable;if(a>=g){if(S)t.setX(g),this._overlay.clipWidth(g-r),this._segment._setEndTime(this._nextSegment.startTime);else if(c){var f=Ir(this._nextSegment);f<n&&(n=f);var v=this._view.timeToPixelOffset(this._nextSegment.endTime-n);a>v&&(a=v),t.setX(a),this._overlay.clipWidth(a-r),this._segment._setEndTime(this._view.pixelOffsetToTime(a)),this._nextSegment.update({startTime:this._view.pixelOffsetToTime(a)}),u=!0}}else a>i&&(a=i),t.setX(a),this._overlay.clipWidth(a-r),this._segment._setEndTime(this._view.pixelOffsetToTime(a))}else a>i&&(a=i),t.setX(a),this._overlay.clipWidth(a-r),this._segment._setEndTime(this._view.pixelOffsetToTime(a));this._peaks.emit("segments.dragged",{segment:this._segment,marker:!0,startMarker:!1,evt:e.evt}),u&&this._peaks.emit("segments.dragged",{segment:this._nextSegment,marker:!0,startMarker:!0,evt:e.evt})};V.prototype._onSegmentMarkerDragEnd=function(t,e){this._nextSegment=null,this._previousSegment=null;var i=t.isStartMarker();this._peaks.emit("segments.dragend",{segment:this._segment,marker:!0,startMarker:i,evt:e.evt})};V.prototype._segmentMarkerDragBoundFunc=function(t,e){return{x:e.x,y:t.getAbsolutePosition().y}};V.prototype.fitToView=function(){if(this._startMarker&&this._startMarker.fitToView(),this._endMarker&&this._endMarker.fitToView(),this._overlay){var t=this._view.getHeight(),e=Se(0,t-this._overlayOffset*2);this._overlay.setAttrs({y:0,height:t,clipY:this._overlayOffset,clipHeight:e}),this._overlayRect.setAttrs({y:this._overlayOffset,height:e}),this._overlayText&&this._overlayText.setAttrs({y:this._overlayOffset,height:e})}};V.prototype.destroy=function(){this._waveformShape&&this._waveformShape.destroy(),this._label&&this._label.destroy(),this._startMarker&&this._startMarker.destroy(),this._endMarker&&this._endMarker.destroy(),this._overlay&&this._overlay.destroy()};function Z(t,e,i){this._peaks=t,this._view=e,this._allowEditing=i,this._segmentShapes={},this._layer=new ne.Layer,this._onSegmentsUpdate=this._onSegmentsUpdate.bind(this),this._onSegmentsAdd=this._onSegmentsAdd.bind(this),this._onSegmentsRemove=this._onSegmentsRemove.bind(this),this._onSegmentsRemoveAll=this._onSegmentsRemoveAll.bind(this),this._onSegmentsDragged=this._onSegmentsDragged.bind(this),this._peaks.on("segments.update",this._onSegmentsUpdate),this._peaks.on("segments.add",this._onSegmentsAdd),this._peaks.on("segments.remove",this._onSegmentsRemove),this._peaks.on("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.on("segments.dragged",this._onSegmentsDragged)}Z.prototype.addToStage=function(t){t.add(this._layer)};Z.prototype.enableEditing=function(t){this._allowEditing=t};Z.prototype.isEditingEnabled=function(){return this._allowEditing};Z.prototype.enableSegmentDragging=function(t){for(var e in this._segmentShapes)I(this._segmentShapes,e)&&this._segmentShapes[e].enableSegmentDragging(t)};Z.prototype.getSegmentShape=function(t){return this._segmentShapes[t.pid]};Z.prototype.formatTime=function(t){return this._view.formatTime(t)};Z.prototype._onSegmentsUpdate=function(t,e){var i=this._view.getStartTime(),r=this._view.getEndTime(),a=this.getSegmentShape(t),n=t.isVisible(i,r);a&&!n?a.isDragging()||this._removeSegment(t):!a&&n?a=this._updateSegment(t):a&&n&&a.update(e)};Z.prototype._onSegmentsAdd=function(t){var e=this,i=e._view.getStartTime(),r=e._view.getEndTime();t.segments.forEach(function(a){if(a.isVisible(i,r)){var n=e._addSegmentShape(a);n.update()}}),this.moveSegmentMarkersToTop()};Z.prototype._onSegmentsRemove=function(t){var e=this;t.segments.forEach(function(i){e._removeSegment(i)})};Z.prototype._onSegmentsRemoveAll=function(){this._layer.removeChildren(),this._segmentShapes={}};Z.prototype._onSegmentsDragged=function(t){this._updateSegment(t.segment)};Z.prototype._createSegmentShape=function(t){return new V(t,this._peaks,this,this._view)};Z.prototype._addSegmentShape=function(t){var e=this._createSegmentShape(t);return e.addToLayer(this._layer),this._segmentShapes[t.pid]=e,e};Z.prototype.updateSegments=function(t,e){var i=this._peaks.segments.find(t,e);i.forEach(this._updateSegment.bind(this)),this._removeInvisibleSegments(t,e)};Z.prototype._updateSegment=function(t){var e=this.getSegmentShape(t);e||(e=this._addSegmentShape(t)),e.update()};Z.prototype._removeInvisibleSegments=function(t,e){for(var i in this._segmentShapes)if(I(this._segmentShapes,i)){var r=this._segmentShapes[i].getSegment();r.isVisible(t,e)||this._removeSegment(r)}};Z.prototype._removeSegment=function(t){var e=this._segmentShapes[t.pid];e&&(e.destroy(),delete this._segmentShapes[t.pid])};Z.prototype.moveSegmentMarkersToTop=function(){for(var t in this._segmentShapes)I(this._segmentShapes,t)&&this._segmentShapes[t].moveMarkersToTop()};Z.prototype.setVisible=function(t){this._layer.setVisible(t)};Z.prototype.segmentClicked=function(t,e){var i=this._segmentShapes[e.segment.pid];i&&i.segmentClicked(t,e)};Z.prototype.destroy=function(){this._peaks.off("segments.update",this._onSegmentsUpdate),this._peaks.off("segments.add",this._onSegmentsAdd),this._peaks.off("segments.remove",this._onSegmentsRemove),this._peaks.off("segments.remove_all",this._onSegmentsRemoveAll),this._peaks.off("segments.dragged",this._onSegmentsDragged)};Z.prototype.fitToView=function(){for(var t in this._segmentShapes)if(I(this._segmentShapes,t)){var e=this._segmentShapes[t];e.fitToView()}};Z.prototype.draw=function(){this._layer.draw()};Z.prototype.getHeight=function(){return this._layer.getHeight()};function ot(t,e){var i=this;i._axisGridlineColor=e.axisGridlineColor,i._axisLabelColor=e.axisLabelColor,i._showAxisLabels=e.showAxisLabels,i._axisTopMarkerHeight=e.axisTopMarkerHeight,i._axisBottomMarkerHeight=e.axisBottomMarkerHeight,e.formatAxisTime?i._formatAxisTime=e.formatAxisTime:i._formatAxisTime=function(r){return yr(r,0)},i._axisLabelFont=ot._buildFontString(e.fontFamily,e.fontSize,e.fontStyle),i._axisShape=new ne.Shape({sceneFunc:function(a){i._drawAxis(a,t)}})}ot._buildFontString=function(t,e,i){return e||(e=11),t||(t="sans-serif"),i||(i="normal"),i+" "+e+"px "+t};ot.prototype.addToLayer=function(t){t.add(this._axisShape)};ot.prototype.showAxisLabels=function(t,e){this._showAxisLabels=t,e&&(I(e,"topMarkerHeight")&&(this._axisTopMarkerHeight=e.topMarkerHeight),I(e,"bottomMarkerHeight")&&(this._axisBottomMarkerHeight=e.bottomMarkerHeight))};ot.prototype._getAxisLabelScale=function(t){for(var e=1,i=[1,2,5,10,20,30],r=60,a=0,n;;){n=e*i[a];var s=t.timeToPixels(n);if(s<r)++a===i.length&&(e*=60,a=0);else break}return n};ot.prototype._drawAxis=function(t,e){var i=e.getStartTime(),r=this._getAxisLabelScale(e),a=pn(i,r),n=a-i,s=e.timeToPixels(n);t.setAttr("strokeStyle",this._axisGridlineColor),t.setAttr("lineWidth",1),t.setAttr("font",this._axisLabelFont),t.setAttr("fillStyle",this._axisLabelColor),t.setAttr("textAlign","left"),t.setAttr("textBaseline","bottom");for(var h=e.getWidth(),l=e.getHeight(),u=a;;){var g=s+e.timeToPixels(u-a);if(g>=h)break;if(this._axisTopMarkerHeight>0&&(t.beginPath(),t.moveTo(g+.5,0),t.lineTo(g+.5,0+this._axisTopMarkerHeight),t.stroke()),this._axisBottomMarkerHeight&&(t.beginPath(),t.moveTo(g+.5,l),t.lineTo(g+.5,l-this._axisBottomMarkerHeight),t.stroke()),this._showAxisLabels){var w=this._formatAxisTime(u),S=t.measureText(w).width,c=g-S/2,f=l-1-this._axisBottomMarkerHeight;c>=0&&t.fillText(w,c,f)}u+=r}};function G(t,e,i,r){var a=this;a._container=e,a._peaks=i,a._options=i.options,a._viewOptions=r,a._originalWaveformData=t,a._data=t,a._frameOffset=0,a._width=e.clientWidth,a._height=e.clientHeight,a._amplitudeScale=1,a._waveformColor=a._viewOptions.waveformColor,a._playedWaveformColor=a._viewOptions.playedWaveformColor,a._timeLabelPrecision=a._viewOptions.timeLabelPrecision,a._viewOptions.formatPlayheadTime?a._formatPlayheadTime=a._viewOptions.formatPlayheadTime:a._formatPlayheadTime=function(n){return yr(n,a._timeLabelPrecision)},a._enableSeek=!0,a.initWaveform(),ne.showWarnings=!1,a._stage=new ne.Stage({container:e,width:a._width,height:a._height}),a._createWaveform(),a._viewOptions.enableSegments&&(a._segmentsLayer=new Z(i,a,a._viewOptions.enableEditing),a._segmentsLayer.addToStage(a._stage)),a._viewOptions.enablePoints&&(a._pointsLayer=new X(i,a,a._viewOptions.enableEditing),a._pointsLayer.addToStage(a._stage)),a.initHighlightLayer(),a._createAxisLabels(),a._playheadLayer=new ve({player:a._peaks.player,view:a,showPlayheadTime:a._viewOptions.showPlayheadTime,playheadColor:a._viewOptions.playheadColor,playheadTextColor:a._viewOptions.playheadTextColor,playheadBackgroundColor:a._viewOptions.playheadBackgroundColor,playheadPadding:a._viewOptions.playheadPadding,playheadFontFamily:a._viewOptions.fontFamily,playheadFontSize:a._viewOptions.fontSize,playheadFontStyle:a._viewOptions.fontStyle}),a._playheadLayer.addToStage(a._stage),a._onClick=a._onClick.bind(a),a._onDblClick=a._onDblClick.bind(a),a._onContextMenu=a._onContextMenu.bind(a),a._stage.on("click",a._onClick),a._stage.on("dblclick",a._onDblClick),a._stage.on("contextmenu",a._onContextMenu)}G.prototype.getViewOptions=function(){return this._viewOptions};G.prototype.getWaveformData=function(){return this._data};G.prototype.setWaveformData=function(t){this._data=t};G.prototype.timeToPixels=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)};G.prototype.pixelsToTime=function(t){return t*this._data.scale/this._data.sample_rate};G.prototype.pixelOffsetToTime=function(t){var e=this._frameOffset+t;return e*this._data.scale/this._data.sample_rate};G.prototype.timeToPixelOffset=function(t){return Math.floor(t*this._data.sample_rate/this._data.scale)-this._frameOffset};G.prototype.getFrameOffset=function(){return this._frameOffset};G.prototype.getWidth=function(){return this._width};G.prototype.getHeight=function(){return this._height};G.prototype.getStartTime=function(){return this.pixelOffsetToTime(0)};G.prototype.getEndTime=function(){return this.pixelOffsetToTime(this._width)};G.prototype._getDuration=function(){return this._peaks.player.getDuration()};G.prototype._createWaveform=function(){this._waveformLayer=new ne.Layer({listening:!1}),this._createWaveformShapes(),this._stage.add(this._waveformLayer)};G.prototype._createWaveformShapes=function(){if(this._waveformShape||(this._waveformShape=new he({color:this._waveformColor,view:this}),this._waveformShape.addToLayer(this._waveformLayer)),this._playedWaveformColor&&!this._playedWaveformShape){var t=this._peaks.player.getCurrentTime();this._playedSegment={startTime:0,endTime:t},this._unplayedSegment={startTime:t,endTime:this._getDuration()},this._waveformShape.setSegment(this._unplayedSegment),this._playedWaveformShape=new he({color:this._playedWaveformColor,view:this,segment:this._playedSegment}),this._playedWaveformShape.addToLayer(this._waveformLayer)}};G.prototype.setWaveformColor=function(t){this._waveformColor=t,this._waveformShape.setWaveformColor(t)};G.prototype.setPlayedWaveformColor=function(t){this._playedWaveformColor=t,t?(this._playedWaveformShape||this._createWaveformShapes(),this._playedWaveformShape.setWaveformColor(t)):this._playedWaveformShape&&this._destroyPlayedWaveformShape()};G.prototype._destroyPlayedWaveformShape=function(){this._waveformShape.setSegment(null),this._playedWaveformShape.destroy(),this._playedWaveformShape=null,this._playedSegment=null,this._unplayedSegment=null};G.prototype._createAxisLabels=function(){this._axisLayer=new ne.Layer({listening:!1}),this._axis=new ot(this,this._viewOptions),this._axis.addToLayer(this._axisLayer),this._stage.add(this._axisLayer)};G.prototype.showAxisLabels=function(t,e){this._axis.showAxisLabels(t,e),this._axisLayer.draw()};G.prototype.showPlayheadTime=function(t){this._playheadLayer.showPlayheadTime(t)};G.prototype.setTimeLabelPrecision=function(t){this._timeLabelPrecision=t,this._playheadLayer.updatePlayheadText()};G.prototype.formatTime=function(t){return this._formatPlayheadTime(t)};G.prototype.setAmplitudeScale=function(t){if(!Si(t)||!vn(t))throw new Error("view.setAmplitudeScale(): Scale must be a valid number");this._amplitudeScale=t,this.drawWaveformLayer(),this._segmentsLayer&&this._segmentsLayer.draw()};G.prototype.getAmplitudeScale=function(){return this._amplitudeScale};G.prototype.enableSeek=function(t){this._enableSeek=t};G.prototype.isSeekEnabled=function(){return this._enableSeek};G.prototype._onClick=function(t){this._clickHandler(t,"click")};G.prototype._onDblClick=function(t){this._clickHandler(t,"dblclick")};G.prototype._onContextMenu=function(t){this._clickHandler(t,"contextmenu")};G.prototype._clickHandler=function(t,e){var i=!0;if(t.target!==this._stage){var r=br(t.target);if(r){if(r.attrs.name==="point-marker"){var a=r.getAttr("point");a&&this._peaks.emit("points."+e,{point:a,evt:t.evt,preventViewEvent:function(){i=!1}})}else if(r.attrs.name==="segment-overlay"){var n=r.getAttr("segment");if(n){var s={segment:n,evt:t.evt,preventViewEvent:function(){i=!1}};this._segmentsLayer&&this._segmentsLayer.segmentClicked(e,s)}}}}if(i){var h=t.evt.layerX,l=this.pixelOffsetToTime(h),u=this.getName();this._peaks.emit(u+"."+e,{time:l,evt:t.evt})}};G.prototype.updatePlayheadTime=function(t){this._playheadLayer.updatePlayheadTime(t)};G.prototype.playheadPosChanged=function(t){this._playedWaveformShape&&(this._playedSegment.endTime=t,this._unplayedSegment.startTime=t,this.drawWaveformLayer())};G.prototype.drawWaveformLayer=function(){this._waveformLayer.draw()};G.prototype.enableMarkerEditing=function(t){this._segmentsLayer&&this._segmentsLayer.enableEditing(t),this._pointsLayer&&this._pointsLayer.enableEditing(t)};G.prototype.fitToContainer=function(){if(!(this._container.clientWidth===0&&this._container.clientHeight===0)){var t=!1;this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.setWidth(this._width),t=this.containerWidthChange()),this._container.clientHeight!==this._height&&(this._height=this._container.clientHeight,this._stage.height(this._height),this._waveformShape.fitToView(),this._playheadLayer.fitToView(),this._segmentsLayer&&this._segmentsLayer.fitToView(),this._pointsLayer&&this._pointsLayer.fitToView(),this.containerHeightChange()),t&&this.updateWaveform(this._frameOffset)}};G.prototype.destroy=function(){this._playheadLayer.destroy(),this._segmentsLayer&&this._segmentsLayer.destroy(),this._pointsLayer&&this._pointsLayer.destroy(),this._stage&&(this._stage.destroy(),this._stage=null)};function Ve(t,e){this._stage=t,this._handlers=e,this._dragging=!1,this._mouseDown=this._mouseDown.bind(this),this._mouseUp=this._mouseUp.bind(this),this._mouseMove=this._mouseMove.bind(this),this._stage.on("mousedown",this._mouseDown),this._stage.on("touchstart",this._mouseDown),this._lastMouseClientX=null}Ve.prototype._mouseDown=function(t){var e=null;if(!(t.type==="mousedown"&&t.evt.button!==0)){var i=br(t.target);if(i&&i.attrs.draggable){if(i.attrs.name==="point-marker"||i.attrs.name==="segment-marker")return;i.attrs.name==="segment-overlay"&&(e=i)}if(this._lastMouseClientX=Math.floor(t.type==="touchstart"?t.evt.touches[0].clientX:t.evt.clientX),this._handlers.onMouseDown){var r=this._getMousePosX(this._lastMouseClientX);this._handlers.onMouseDown(r,e)}window.addEventListener("mousemove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("touchmove",this._mouseMove,{capture:!1,passive:!0}),window.addEventListener("mouseup",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("touchend",this._mouseUp,{capture:!1,passive:!0}),window.addEventListener("blur",this._mouseUp,{capture:!1,passive:!0})}};Ve.prototype._mouseMove=function(t){var e=Math.floor(t.type==="touchmove"?t.changedTouches[0].clientX:t.clientX);if(e!==this._lastMouseClientX&&(this._lastMouseClientX=e,this._dragging=!0,this._handlers.onMouseMove)){var i=this._getMousePosX(e);this._handlers.onMouseMove(i)}};Ve.prototype._mouseUp=function(t){var e;if(t.type==="touchend"?(e=Math.floor(t.changedTouches[0].clientX),t.cancelable&&t.preventDefault()):e=Math.floor(t.clientX),this._handlers.onMouseUp){var i=this._getMousePosX(e);this._handlers.onMouseUp(i)}window.removeEventListener("mousemove",this._mouseMove,{capture:!1}),window.removeEventListener("touchmove",this._mouseMove,{capture:!1}),window.removeEventListener("mouseup",this._mouseUp,{capture:!1}),window.removeEventListener("touchend",this._mouseUp,{capture:!1}),window.removeEventListener("blur",this._mouseUp,{capture:!1}),this._dragging=!1};Ve.prototype._getMousePosX=function(t){var e=this._stage.getContainer().getBoundingClientRect();return t-e.left};Ve.prototype.isDragging=function(){return this._dragging};Ve.prototype.destroy=function(){this._stage.off("mousedown",this._mouseDown),this._stage.off("touchstart",this._mouseDown)};function Ft(t,e){this._peaks=t,this._view=e,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._mouseDragHandler=new Ve(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove})}Ft.prototype._onMouseDown=function(t){this._seek(t)};Ft.prototype._onMouseMove=function(t){this._seek(t)};Ft.prototype._seek=function(t){if(this._view.isSeekEnabled()){t=Se(t,0,this._width);var e=this._view.pixelsToTime(t),i=this._peaks.player.getDuration();e>i&&(e=i),this._view.updatePlayheadTime(e),this._peaks.player.seek(e)}};Ft.prototype.destroy=function(){this._mouseDragHandler.destroy()};function le(t,e,i){var r=this;G.call(r,t,e,i,i.options.overview),r._onTimeUpdate=r._onTimeUpdate.bind(r),r._onPlaying=r._onPlaying.bind(r),r._onPause=r._onPause.bind(r),r._onZoomviewDisplaying=r._onZoomviewDisplaying.bind(r),i.on("player.timeupdate",r._onTimeUpdate),i.on("player.playing",r._onPlaying),i.on("player.pause",r._onPause),i.on("zoomview.displaying",r._onZoomviewDisplaying);var a=r._peaks.player.getCurrentTime();r._playheadLayer.updatePlayheadTime(a),r._mouseDragHandler=new Ft(i,r)}le.prototype=Object.create(G.prototype);le.prototype.initWaveform=function(){this._width!==0&&this._resampleAndSetWaveformData(this._originalWaveformData,this._width)};le.prototype.initHighlightLayer=function(){this._highlightLayer=new Je(this,this._viewOptions),this._highlightLayer.addToStage(this._stage)};le.prototype.isSegmentDraggingEnabled=function(){return!1};le.prototype.getName=function(){return"overview"};le.prototype._onTimeUpdate=function(t){this._playheadLayer.updatePlayheadTime(t)};le.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)};le.prototype._onPause=function(t){this._playheadLayer.stop(t)};le.prototype._onZoomviewDisplaying=function(t,e){this.showHighlight(t,e)};le.prototype.showHighlight=function(t,e){this._highlightLayer.showHighlight(t,e)};le.prototype.setWaveformData=function(t){this._originalWaveformData=t,this._width!==0?this._resampleAndSetWaveformData(t,this._width):this._data=t,this.updateWaveform()};le.prototype._resampleAndSetWaveformData=function(t,e){try{return this._data=t.resample({width:e}),!0}catch{return this._data=t,!1}};le.prototype.removeHighlightRect=function(){this._highlightLayer.removeHighlight()};le.prototype.updateWaveform=function(){this._waveformLayer.draw(),this._axisLayer.draw();var t=this._peaks.player.getCurrentTime();this._playheadLayer.updatePlayheadTime(t),this._highlightLayer.updateHighlight();var e=0,i=this.pixelsToTime(this._width);this._pointsLayer&&this._pointsLayer.updatePoints(e,i),this._segmentsLayer&&this._segmentsLayer.updateSegments(e,i)};le.prototype.containerWidthChange=function(){return this._resampleAndSetWaveformData(this._originalWaveformData,this._width)};le.prototype.containerHeightChange=function(){this._highlightLayer.fitToView()};le.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("zoomview.displaying",this._onZoomviewDisplaying),this._mouseDragHandler.destroy(),G.prototype.destroy.call(this)};function yt(t,e){this._peaks=t,this._view=e,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new Ve(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}yt.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()};yt.prototype._onMouseDown=function(t,e){this._segment=e,this._segment&&(this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1));var i=this._view.pixelsToTime(t+this._view.getFrameOffset());this._peaks.segments.setInserting(!0),this._insertSegment=this._peaks.segments.add({startTime:i,endTime:i,editable:!0}),this._insertSegmentShape=this._view._segmentsLayer.getSegmentShape(this._insertSegment),this._insertSegmentShape&&(this._insertSegmentShape.moveMarkersToTop(),this._insertSegmentShape.startDrag())};yt.prototype._onMouseMove=function(){};yt.prototype._onMouseUp=function(){this._insertSegmentShape&&(this._insertSegmentShape.stopDrag(),this._insertSegmentShape=null),this._segment&&this._segmentIsDraggable&&this._segment.draggable(!0),this._peaks.emit("segments.insert",{segment:this._insertSegment}),this._peaks.segments.setInserting(!1)};yt.prototype.destroy=function(){this._mouseDragHandler.destroy()};function qe(t,e){this._peaks=t,this._view=e,this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._mouseDragHandler=new Ve(e._stage,{onMouseDown:this._onMouseDown,onMouseMove:this._onMouseMove,onMouseUp:this._onMouseUp})}qe.prototype.isDragging=function(){return this._mouseDragHandler.isDragging()};qe.prototype._onMouseDown=function(t,e){this._segment=e,this._seeking=!1;var i=this._view.getPlayheadOffset();if(this._view.isSeekEnabled()&&Math.abs(t-i)<=this._view.getPlayheadClickTolerance()&&(this._seeking=!0,this._segment&&(this._segmentIsDraggable=this._segment.draggable(),this._segment.draggable(!1))),this._seeking){t=Se(t,0,this._view.getWidth());var r=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(r)}else this._initialFrameOffset=this._view.getFrameOffset(),this._mouseDownX=t};qe.prototype._onMouseMove=function(t){if(!(this._segment&&!this._seeking))if(this._seeking){t=Se(t,0,this._view.getWidth());var e=this._view.pixelsToTime(t+this._view.getFrameOffset());this._seek(e)}else{var i=this._mouseDownX-t,r=this._initialFrameOffset+i;r!==this._initialFrameOffset&&this._view.updateWaveform(r)}};qe.prototype._onMouseUp=function(){if(!this._seeking&&this._view._enableSeek&&!this._mouseDragHandler.isDragging()){var t=this._view.pixelOffsetToTime(this._mouseDownX);this._seek(t)}this._segment&&this._seeking&&this._segmentIsDraggable&&this._segment.draggable(!0)};qe.prototype._seek=function(t){var e=this._peaks.player.getDuration();t>e&&(t=e),this._view.updatePlayheadTime(t),this._peaks.player.seek(t)};qe.prototype.destroy=function(){this._mouseDragHandler.destroy()};function R(t,e,i){var r=this;G.call(r,t,e,i,i.options.zoomview),r._onTimeUpdate=r._onTimeUpdate.bind(r),r._onPlaying=r._onPlaying.bind(r),r._onPause=r._onPause.bind(r),r._onKeyboardLeft=r._onKeyboardLeft.bind(r),r._onKeyboardRight=r._onKeyboardRight.bind(r),r._onKeyboardShiftLeft=r._onKeyboardShiftLeft.bind(r),r._onKeyboardShiftRight=r._onKeyboardShiftRight.bind(r),r._peaks.on("player.timeupdate",r._onTimeUpdate),r._peaks.on("player.playing",r._onPlaying),r._peaks.on("player.pause",r._onPause),r._peaks.on("keyboard.left",r._onKeyboardLeft),r._peaks.on("keyboard.right",r._onKeyboardRight),r._peaks.on("keyboard.shift_left",r._onKeyboardShiftLeft),r._peaks.on("keyboard.shift_right",r._onKeyboardShiftRight),r._autoScroll=r._viewOptions.autoScroll,r._autoScrollOffset=r._viewOptions.autoScrollOffset,r._enableSegmentDragging=!1,r._segmentDragMode="overlap",r._minSegmentDragWidth=0,r._insertSegmentShape=null,r._playheadClickTolerance=r._viewOptions.playheadClickTolerance,r._zoomLevelAuto=!1,r._zoomLevelSeconds=null;var a=r._peaks.player.getCurrentTime();r._syncPlayhead(a),r._mouseDragHandler=new qe(i,r),r._onWheel=r._onWheel.bind(r),r._onWheelCaptureVerticalScroll=r._onWheelCaptureVerticalScroll.bind(r),r.setWheelMode(r._viewOptions.wheelMode),r._peaks.emit("zoomview.displaying",0,r.getEndTime())}R.prototype=Object.create(G.prototype);R.prototype.initWaveform=function(){this._enableWaveformCache=this._options.waveformCache,this._initWaveformCache();var t=this._peaks.zoom.getZoomLevel();this._resampleData({scale:t})};R.prototype._initWaveformCache=function(){this._enableWaveformCache&&(this._waveformData=new Map,this._waveformData.set(this._originalWaveformData.scale,this._originalWaveformData),this._waveformScales=[this._originalWaveformData.scale])};R.prototype.initHighlightLayer=function(){};R.prototype.setWheelMode=function(t,e){if(e||(e={}),t!==this._wheelMode||e.captureVerticalScroll!==this._captureVerticalScroll)switch(this._stage.off("wheel"),this._wheelMode=t,this._captureVerticalScroll=e.captureVerticalScroll,t){case"scroll":e.captureVerticalScroll?this._stage.on("wheel",this._onWheelCaptureVerticalScroll):this._stage.on("wheel",this._onWheel);break}};R.prototype._onWheel=function(t){var e=t.evt,i;if(e.shiftKey)if(e.deltaY!==0)i=e.deltaY;else if(e.deltaX!==0)i=e.deltaX;else return;else{if(Math.abs(e.deltaX)<Math.abs(e.deltaY))return;i=e.deltaX}e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(i*=this._width),e.preventDefault();var r=Se(this._frameOffset+Math.floor(i),0,this._pixelLength-this._width);this.updateWaveform(r)};R.prototype._onWheelCaptureVerticalScroll=function(t){var e=t.evt,i=Math.abs(e.deltaX)<Math.abs(e.deltaY)?e.deltaY:e.deltaX;e.preventDefault();var r=Se(this._frameOffset+Math.floor(i),0,this._pixelLength-this._width);this.updateWaveform(r)};R.prototype.setWaveformDragMode=function(t){this._viewOptions.enableSegments&&(this._mouseDragHandler.destroy(),t==="insert-segment"?this._mouseDragHandler=new yt(this._peaks,this):this._mouseDragHandler=new qe(this._peaks,this))};R.prototype.enableSegmentDragging=function(t){this._enableSegmentDragging=t,this._segmentsLayer&&this._segmentsLayer.enableSegmentDragging(t)};R.prototype.isSegmentDraggingEnabled=function(){return this._enableSegmentDragging};R.prototype.setSegmentDragMode=function(t){this._segmentDragMode=t};R.prototype.getSegmentDragMode=function(){return this._segmentDragMode};R.prototype.getName=function(){return"zoomview"};R.prototype._onTimeUpdate=function(t){this._mouseDragHandler.isDragging()||this._syncPlayhead(t)};R.prototype._onPlaying=function(t){this._playheadLayer.updatePlayheadTime(t)};R.prototype._onPause=function(t){this._playheadLayer.stop(t)};R.prototype._onKeyboardLeft=function(){this._keyboardScroll(-1,!1)};R.prototype._onKeyboardRight=function(){this._keyboardScroll(1,!1)};R.prototype._onKeyboardShiftLeft=function(){this._keyboardScroll(-1,!0)};R.prototype._onKeyboardShiftRight=function(){this._keyboardScroll(1,!0)};R.prototype._keyboardScroll=function(t,e){var i;e?i=t*this._width:i=t*this.timeToPixels(this._options.nudgeIncrement),this.scrollWaveform({pixels:i})};R.prototype.setWaveformData=function(t){this._originalWaveformData=t,this._initWaveformCache()};R.prototype.getPlayheadOffset=function(){return this._playheadLayer.getPlayheadPixel()-this._frameOffset};R.prototype.getPlayheadClickTolerance=function(){return this._playheadClickTolerance};R.prototype._syncPlayhead=function(t){if(this._playheadLayer.updatePlayheadTime(t),this._autoScroll){var e=this.timeToPixels(t),i=this._frameOffset+this._width-this._autoScrollOffset;(e>=i||e<this._frameOffset)&&(this._frameOffset=e-this._autoScrollOffset,this._frameOffset<0&&(this._frameOffset=0),this.updateWaveform(this._frameOffset))}};R.prototype._getScale=function(t){return Math.floor(t*this._data.sample_rate/this._width)};function Nn(t){return I(t,"scale")&&t.scale==="auto"||I(t,"seconds")&&t.seconds==="auto"}R.prototype.setZoom=function(t){var e;if(Nn(t)){var i=this._peaks.player.getDuration();if(!ze(i))return!1;this._zoomLevelAuto=!0,this._zoomLevelSeconds=null,e=this._getScale(i)}else{if(I(t,"scale"))this._zoomLevelSeconds=null,e=Math.floor(t.scale);else if(I(t,"seconds")){if(!ze(t.seconds))return!1;this._zoomLevelSeconds=t.seconds,e=this._getScale(t.seconds)}this._zoomLevelAuto=!1}e<this._originalWaveformData.scale&&(this._peaks._logger("peaks.zoomview.setZoom(): zoom level must be at least "+this._originalWaveformData.scale),e=this._originalWaveformData.scale);var r=this._peaks.player.getCurrentTime(),a,n=this.getPlayheadOffset();n>=0&&n<this._width?a=r:(n=Math.floor(this._width/2),a=this.pixelOffsetToTime(n));var s=this._scale;this._resampleData({scale:e});var h=this.timeToPixels(a);return this._frameOffset=h-n,this.updateWaveform(this._frameOffset),this._playheadLayer.zoomLevelChanged(),this._playheadLayer.updatePlayheadTime(r),this._peaks.emit("zoom.update",{currentZoom:e,previousZoom:s}),!0};R.prototype._resampleData=function(t){var e=t.scale;if(this._enableWaveformCache){if(!this._waveformData.has(e)){for(var i=this._originalWaveformData,r=0;r<this._waveformScales.length&&this._waveformScales[r]<e;r++)i=this._waveformData.get(this._waveformScales[r]);this._waveformData.set(e,i.resample(t)),this._waveformScales.push(e),this._waveformScales.sort(function(a,n){return a-n})}this._data=this._waveformData.get(e)}else this._data=this._originalWaveformData.resample(t);this._scale=this._data.scale,this._pixelLength=this._data.length};R.prototype.setStartTime=function(t){t<0&&(t=0),this._zoomLevelAuto&&(t=0),this.updateWaveform(this.timeToPixels(t))};R.prototype.getPixelLength=function(){return this._pixelLength};R.prototype.scrollWaveform=function(t){var e;if(I(t,"pixels"))e=Math.floor(t.pixels);else if(I(t,"seconds"))e=this.timeToPixels(t.seconds);else throw new TypeError("view.scrollWaveform(): Missing umber of pixels or seconds");this.updateWaveform(this._frameOffset+e)};R.prototype.updateWaveform=function(t){var e;this._pixelLength<this._width?(t=0,e=this._width):e=this._pixelLength-this._width,t=Se(t,0,e),this._frameOffset=t;var i=this._playheadLayer.getPlayheadPixel();this._playheadLayer.updatePlayheadTime(this.pixelsToTime(i)),this.drawWaveformLayer(),this._axisLayer.draw();var r=this.getStartTime(),a=this.getEndTime();this._pointsLayer&&this._pointsLayer.updatePoints(r,a),this._segmentsLayer&&this._segmentsLayer.updateSegments(r,a),this._peaks.emit("zoomview.displaying",r,a)};R.prototype.enableAutoScroll=function(t,e){this._autoScroll=t,I(e,"offset")&&(this._autoScrollOffset=e.offset)};R.prototype.getMinSegmentDragWidth=function(){return this._insertSegmentShape?0:this._minSegmentDragWidth};R.prototype.setMinSegmentDragWidth=function(t){this._minSegmentDragWidth=t};R.prototype.containerWidthChange=function(){var t=!1,e=!1,i;if(this._zoomLevelAuto?(e=!0,i={width:this._width}):this._zoomLevelSeconds!==null&&(e=!0,i={scale:this._getScale(this._zoomLevelSeconds)}),e)try{this._resampleData(i),t=!0}catch{}return t};R.prototype.containerHeightChange=function(){};R.prototype.getStage=function(){return this._stage};R.prototype.getSegmentsLayer=function(){return this._segmentsLayer};R.prototype.destroy=function(){this._peaks.off("player.playing",this._onPlaying),this._peaks.off("player.pause",this._onPause),this._peaks.off("player.timeupdate",this._onTimeUpdate),this._peaks.off("keyboard.left",this._onKeyboardLeft),this._peaks.off("keyboard.right",this._onKeyboardRight),this._peaks.off("keyboard.shift_left",this._onKeyboardShiftLeft),this._peaks.off("keyboard.shift_right",this._onKeyboardShiftRight),this._mouseDragHandler.destroy(),G.prototype.destroy.call(this)};function ye(t,e,i){this._waveformData=t,this._container=e,this._peaks=i,this._options=i.options.scrollbar,this._zoomview=i.views.getView("zoomview"),this._dragBoundFunc=this._dragBoundFunc.bind(this),this._onScrollboxDragStart=this._onScrollboxDragStart.bind(this),this._onScrollboxDragMove=this._onScrollboxDragMove.bind(this),this._onScrollboxDragEnd=this._onScrollboxDragEnd.bind(this),this._onZoomviewDisplaying=this._onZoomviewDisplaying.bind(this),this._onScrollbarClick=this._onScrollbarClick.bind(this),i.on("zoomview.displaying",this._onZoomviewDisplaying),this._width=e.clientWidth,this._height=e.clientHeight,this._stage=new ne.Stage({container:e,width:this._width,height:this._height}),this._layer=new ne.Layer,this._stage.on("click",this._onScrollbarClick),this._stage.add(this._layer),this._color=this._options.color,this._scrollboxX=0,this._minScrollboxWidth=this._options.minWidth,this._offsetY=0,this._scrollbox=new ne.Group({draggable:!0,dragBoundFunc:this._dragBoundFunc}),this._scrollboxRect=new mt({x:this._scrollboxX,y:this._offsetY,width:0,height:this._height,fill:this._color}),this._scrollbox.add(this._scrollboxRect),this._setScrollboxWidth(),this._scrollbox.on("dragstart",this._onScrollboxDragStart),this._scrollbox.on("dragmove",this._onScrollboxDragMove),this._scrollbox.on("dragend",this._onScrollboxDragEnd),this._layer.add(this._scrollbox),this._layer.draw()}ye.prototype.setZoomview=function(t){this._zoomview=t,this._updateScrollbarWidthAndPosition()};ye.prototype._setScrollboxWidth=function(){this._zoomview?(this._scrollboxWidth=Math.floor(this._width*this._zoomview.pixelsToTime(this._zoomview.getWidth())/this._peaks.player.getDuration()),this._scrollboxWidth<this._minScrollboxWidth&&(this._scrollboxWidth=this._minScrollboxWidth)):this._scrollboxWidth=this._width,this._scrollboxRect.width(this._scrollboxWidth)};ye.prototype._getScrollbarRange=function(){return this._width-this._scrollboxWidth};ye.prototype._dragBoundFunc=function(t){return{x:t.x,y:0}};ye.prototype._onScrollboxDragStart=function(){this._dragging=!0};ye.prototype._onScrollboxDragEnd=function(){this._dragging=!1};ye.prototype._onScrollboxDragMove=function(){var t=this._getScrollbarRange(),e=Se(this._scrollbox.x(),0,t);this._scrollbox.x(e),e!==this._scrollboxX&&(this._scrollboxX=e,this._zoomview&&this._updateWaveform(e))};ye.prototype._onZoomviewDisplaying=function(){this._dragging||this._updateScrollbarWidthAndPosition()};ye.prototype._updateScrollbarWidthAndPosition=function(){if(this._setScrollboxWidth(),this._zoomview){var t=this._zoomview.getStartTime(),e=this._zoomview.getPixelLength()-this._zoomview.getWidth(),i=Math.floor(this._zoomview.timeToPixels(t)*this._getScrollbarRange()/e);this._scrollbox.x(i),this._layer.draw()}};ye.prototype._onScrollbarClick=function(t){if(t.target===this._stage&&this._zoomview){var e=Math.floor(t.evt.layerX-this._scrollboxWidth/2);e<0&&(e=0),this._updateWaveform(e)}};ye.prototype._updateWaveform=function(t){var e=Math.floor((this._zoomview.getPixelLength()-this._zoomview.getWidth())*t/this._getScrollbarRange());this._zoomview.updateWaveform(e)};ye.prototype.fitToContainer=function(){this._container.clientWidth===0&&this._container.clientHeight===0||(this._container.clientWidth!==this._width&&(this._width=this._container.clientWidth,this._stage.width(this._width),this._updateScrollbarWidthAndPosition()),this._height=this._container.clientHeight,this._stage.height(this._height))};ye.prototype.destroy=function(){this._layer.destroy(),this._stage.destroy(),this._stage=null};function He(t){this._peaks=t,this._overview=null,this._zoomview=null,this._scrollbar=null}He.prototype.createOverview=function(t){if(this._overview)return this._overview;var e=this._peaks.getWaveformData();return this._overview=new le(e,t,this._peaks),this._zoomview&&this._overview.showHighlight(this._zoomview.getStartTime(),this._zoomview.getEndTime()),this._overview};He.prototype.createZoomview=function(t){if(this._zoomview)return this._zoomview;var e=this._peaks.getWaveformData();return this._zoomview=new R(e,t,this._peaks),this._scrollbar&&this._scrollbar.setZoomview(this._zoomview),this._zoomview};He.prototype.createScrollbar=function(t){var e=this._peaks.getWaveformData();return this._scrollbar=new ye(e,t,this._peaks),this._scrollbar};He.prototype.destroyOverview=function(){this._overview&&this._zoomview&&(this._overview.destroy(),this._overview=null)};He.prototype.destroyZoomview=function(){this._zoomview&&this._overview&&(this._zoomview.destroy(),this._zoomview=null,this._overview.removeHighlightRect())};He.prototype.destroy=function(){this._overview&&(this._overview.destroy(),this._overview=null),this._zoomview&&(this._zoomview.destroy(),this._zoomview=null),this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null)};He.prototype.getView=function(t){if(xe(t))return this._overview&&this._zoomview?null:this._overview?this._overview:this._zoomview?this._zoomview:null;switch(t){case"overview":return this._overview;case"zoomview":return this._zoomview;default:return null}};He.prototype.getScrollbar=function(){return this._scrollbar};function ht(t,e){this._peaks=t,this._zoomLevels=e,this._zoomLevelIndex=0}ht.prototype.setZoomLevels=function(t){this._zoomLevels=t,this.setZoom(0,!0)};ht.prototype.zoomIn=function(){this.setZoom(this._zoomLevelIndex-1)};ht.prototype.zoomOut=function(){this.setZoom(this._zoomLevelIndex+1)};ht.prototype.setZoom=function(t,e){if(t>=this._zoomLevels.length&&(t=this._zoomLevels.length-1),t<0&&(t=0),!(!e&&t===this._zoomLevelIndex)){this._zoomLevelIndex=t;var i=this._peaks.views.getView("zoomview");i&&i.setZoom({scale:this._zoomLevels[t]})}};ht.prototype.getZoom=function(){return this._zoomLevelIndex};ht.prototype.getZoomLevel=function(){return this._zoomLevels[this._zoomLevelIndex]};var qi="withCredentials"in new XMLHttpRequest;function Le(t){this._peaks=t}Le.prototype.init=function(t,e){if(t.dataUri&&(t.webAudio||t.audioContext)||t.waveformData&&(t.webAudio||t.audioContext)||t.dataUri&&t.waveformData){e(new TypeError("Peaks.init(): You may only pass one source (webAudio, dataUri, or waveformData) to render waveform data."));return}if(t.audioContext&&(this._peaks._logger("Peaks.init(): The audioContext option is deprecated, please pass a webAudio object instead"),t.webAudio={audioContext:t.audioContext}),t.dataUri)return this._getRemoteWaveformData(t,e);if(t.waveformData)return this._buildWaveformFromLocalData(t,e);if(t.webAudio)return t.webAudio.audioBuffer?this._buildWaveformDataFromAudioBuffer(t,e):this._buildWaveformDataUsingWebAudio(t,e);e(new Error("Peaks.init(): You must pass an audioContext, or dataUri, or waveformData to render waveform data"))};Le.prototype._getRemoteWaveformData=function(t,e){var i=this,r=null,a=null,n;if(kt(t.dataUri))r=t.dataUri;else{e(new TypeError("Peaks.init(): The dataUri option must be an object"));return}if(["ArrayBuffer","JSON"].some(function(s){if(window[s])return a=s.toLowerCase(),n=r[a],!!n}),!n){e(new Error("Peaks.init(): Unable to determine a compatible dataUri format for this browser"));return}i._xhr=i._createXHR(n,a,t.withCredentials,function(s){if(this.readyState===4){if(this.status!==200){e(new Error("Unable to fetch remote data. HTTP status "+this.status));return}i._xhr=null;var h=me.create(s.target.response);if(h.channels!==1&&h.channels!==2){e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));return}else if(h.bits!==8){e(new Error("Peaks.init(): 16-bit waveform data is not supported"));return}e(null,h)}},function(){e(new Error("XHR failed"))},function(){e(new Error("XHR aborted"))}),i._xhr.send()};Le.prototype._buildWaveformFromLocalData=function(t,e){var i=null,r=null;if(kt(t.waveformData))i=t.waveformData;else{e(new Error("Peaks.init(): The waveformData option must be an object"));return}if(kt(i.json)?r=i.json:yn(i.arraybuffer)&&(r=i.arraybuffer),!r){e(new Error("Peaks.init(): Unable to determine a compatible waveformData format"));return}try{var a=me.create(r);if(a.channels!==1&&a.channels!==2){e(new Error("Peaks.init(): Only mono or stereo waveforms are currently supported"));return}else if(a.bits!==8){e(new Error("Peaks.init(): 16-bit waveform data is not supported"));return}e(null,a)}catch(n){e(n)}};Le.prototype._buildWaveformDataUsingWebAudio=function(t,e){var i=this,r=window.AudioContext||window.webkitAudioContext;if(!(t.webAudio.audioContext instanceof r)){e(new TypeError("Peaks.init(): The webAudio.audioContext option must be a valid AudioContext"));return}var a=t.webAudio;a.scale!==t.zoomLevels[0]&&(a.scale=t.zoomLevels[0]);var n=i._peaks.options.mediaElement.currentSrc;n?i._requestAudioAndBuildWaveformData(n,a,t.withCredentials,e):i._peaks.once("player.canplay",function(){i._requestAudioAndBuildWaveformData(i._peaks.options.mediaElement.currentSrc,a,t.withCredentials,e)})};Le.prototype._buildWaveformDataFromAudioBuffer=function(t,e){var i=t.webAudio;i.scale!==t.zoomLevels[0]&&(i.scale=t.zoomLevels[0]);var r={audio_buffer:i.audioBuffer,split_channels:i.multiChannel,scale:i.scale,disable_worker:!0};me.createFromAudio(r,e)};Le.prototype._requestAudioAndBuildWaveformData=function(t,e,i,r){var a=this;if(!t){a._peaks._logger("Peaks.init(): The mediaElement src is invalid");return}a._xhr=a._createXHR(t,"arraybuffer",i,function(n){if(this.readyState===4){if(this.status!==200){r(new Error("Unable to fetch remote data. HTTP status "+this.status));return}a._xhr=null;var s={audio_context:e.audioContext,array_buffer:n.target.response,split_channels:e.multiChannel,scale:e.scale};me.createFromAudio(s,r)}},function(){r(new Error("XHR failed"))},function(){r(new Error("XHR aborted"))}),a._xhr.send()};Le.prototype.abort=function(){this._xhr&&this._xhr.abort()};Le.prototype._createXHR=function(t,e,i,r,a,n){var s=new XMLHttpRequest;if(s.open("GET",t,!0),qi)try{s.responseType=e}catch{}return s.onload=r,s.onerror=a,qi&&i&&(s.withCredentials=!0),s.addEventListener("abort",n),s};function it(){return vr.call(this),this.options={zoomLevels:[512,1024,2048,4096],waveformCache:!0,mediaElement:null,mediaUrl:null,dataUri:null,withCredentials:!1,waveformData:null,webAudio:null,nudgeIncrement:1,pointMarkerColor:"#39cccc",createSegmentMarker:Gn,createSegmentLabel:Rn,createPointMarker:Wn,logger:console.error.bind(console)},this}it.prototype=Object.create(vr.prototype);var jt={playheadColor:"#111111",playheadTextColor:"#aaaaaa",playheadBackgroundColor:"transparent",playheadPadding:2,axisGridlineColor:"#cccccc",showAxisLabels:!0,axisTopMarkerHeight:10,axisBottomMarkerHeight:10,axisLabelColor:"#aaaaaa",fontFamily:"sans-serif",fontSize:11,fontStyle:"normal",timeLabelPrecision:2,enablePoints:!0,enableSegments:!0},$i={playheadClickTolerance:3,waveformColor:"rgba(0, 225, 128, 1)",wheelMode:"none",autoScroll:!0,autoScrollOffset:100,enableEditing:!0},Qi={waveformColor:"rgba(0, 0, 0, 0.2)",highlightColor:"#aaaaaa",highlightStrokeColor:"transparent",highlightOpacity:.3,highlightOffset:11,highlightCornerRadius:2,enableEditing:!1},Xn={overlay:!1,markers:!0,startMarkerColor:"#aaaaaa",endMarkerColor:"#aaaaaa",waveformColor:"#0074d9",overlayColor:"#ff0000",overlayOpacity:.3,overlayBorderColor:"#ff0000",overlayBorderWidth:2,overlayCornerRadius:5,overlayOffset:25,overlayLabelAlign:"left",overlayLabelVerticalAlign:"top",overlayLabelPadding:8,overlayLabelColor:"#000000",overlayFontFamily:"sans-serif",overlayFontSize:12,overlayFontStyle:"normal"},zn={color:"#888888",minWidth:50};function Yn(t){var e={};t.overview&&t.overview.showPlayheadTime&&(e.showPlayheadTime=t.overview.showPlayheadTime);var i=["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","formatPlayheadTime","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","highlightColor","highlightStrokeColor","highlightOpacity","highlightCornerRadius","highlightOffset","enablePoints","enableSegments","enableEditing"];return i.forEach(function(r){t.overview&&I(t.overview,r)?e[r]=t.overview[r]:I(t,r)?e[r]=t[r]:I(e,r)||(I(Qi,r)?e[r]=Qi[r]:I(jt,r)&&(e[r]=jt[r]))}),e}function Zn(t){var e={};t.showPlayheadTime?e.showPlayheadTime=t.showPlayheadTime:t.zoomview&&t.zoomview.showPlayheadTime&&(e.showPlayheadTime=t.zoomview.showPlayheadTime);var i=["container","waveformColor","playedWaveformColor","playheadColor","playheadTextColor","playheadBackgroundColor","playheadPadding","formatPlayheadTime","playheadClickTolerance","timeLabelPrecision","axisGridlineColor","showAxisLabels","axisTopMarkerHeight","axisBottomMarkerHeight","axisLabelColor","formatAxisTime","fontFamily","fontSize","fontStyle","wheelMode","autoScroll","autoScrollOffset","enablePoints","enableSegments","enableEditing"];return i.forEach(function(r){t.zoomview&&I(t.zoomview,r)?e[r]=t.zoomview[r]:I(t,r)?e[r]=t[r]:I(e,r)||(I($i,r)?e[r]=$i[r]:I(jt,r)&&(e[r]=jt[r]))}),e}function Kn(t){if(!I(t,"scrollbar"))return null;var e={},i=["container","color","minWidth"];return i.forEach(function(r){I(t.scrollbar,r)?e[r]=t.scrollbar[r]:e[r]=zn[r]}),e}function zt(t,e){for(var i in e)I(e,i)&&I(t,i)&&(t[i]=e[i]);return t}function jn(t,e){t.segmentOptions={},St(t.segmentOptions,Xn),e.segmentOptions&&zt(t.segmentOptions,e.segmentOptions),t.zoomview.segmentOptions={},St(t.zoomview.segmentOptions,t.segmentOptions),e.zoomview&&e.zoomview.segmentOptions&&zt(t.zoomview.segmentOptions,e.zoomview.segmentOptions),t.overview.segmentOptions={},St(t.overview.segmentOptions,t.segmentOptions),e.overview&&e.overview.segmentOptions&&zt(t.overview.segmentOptions,e.overview.segmentOptions)}function er(t){var e=t.zoomview.container,i=t.overview.container;if(!Ci(e)&&!Ci(i))return new TypeError("Peaks.init(): The zoomview and/or overview container options must be valid HTML elements");if(e&&(e.clientWidth<=0||e.clientHeight<=0))return new Error("Peaks.init(): The zoomview container must be visible and have non-zero width and height");if(i&&(i.clientWidth<=0||i.clientHeight<=0))return new Error("Peaks.init(): The overview container must be visible and have non-zero width and height")}it.init=function(t,e){var i=new it,r=i._setOptions(t);if(r){e(r);return}if(r=er(i.options),r){e(r);return}var a=null;if(i.options.scrollbar){if(a=i.options.scrollbar.container,!Ci(a)){e(new TypeError("Peaks.init(): The scrollbar container option must be a valid HTML element"));return}if(a.clientWidth<=0){e(new TypeError("Peaks.init(): The scrollbar container must be visible and have non-zero width"));return}}t.keyboard&&(i._keyboardHandler=new Di(i));var n=t.player?t.player:new Ae(i.options.mediaElement);return i.player=new Ce(i,n),i.segments=new j(i),i.points=new fe(i),i.zoom=new ht(i,i.options.zoomLevels),i.views=new He(i),i._waveformBuilder=new Le(i),i.player.init(i).then(function(){i._waveformBuilder.init(i.options,function(s,h){if(s){e&&e(s);return}if(s=er(i.options),s){e&&e(s);return}i._waveformBuilder=null,i._waveformData=h;var l=i.options.zoomview.container,u=i.options.overview.container;u&&i.views.createOverview(u),l&&i.views.createZoomview(l),a&&i.views.createScrollbar(a),t.segments&&i.segments.add(t.segments),t.points&&i.points.add(t.points),t.emitCueEvents&&(i._cueEmitter=new Ee(i)),setTimeout(function(){i.emit("peaks.ready")},0),e(null,i)})}).catch(function(s){e&&e(s)}),i};it.prototype._setOptions=function(t){if(!kt(t))return new TypeError("Peaks.init(): The options parameter should be an object");if(!t.player){if(!t.mediaElement)return new Error("Peaks.init(): Missing mediaElement option");if(!(t.mediaElement instanceof HTMLMediaElement))return new TypeError("Peaks.init(): The mediaElement option should be an HTMLMediaElement")}if(t.logger&&!wn(t.logger))return new TypeError("Peaks.init(): The logger option should be a function");if(t.segments&&!Array.isArray(t.segments))return new TypeError("Peaks.init(): options.segments must be an array of segment objects");if(t.points&&!Array.isArray(t.points))return new TypeError("Peaks.init(): options.points must be an array of point objects");if(zt(this.options,t),this.options.overview=Yn(t),this.options.zoomview=Zn(t),this.options.scrollbar=Kn(t),jn(this.options,t),Array.isArray(this.options.zoomLevels)){if(this.options.zoomLevels.length===0)return new Error("Peaks.init(): The zoomLevels array must not be empty");if(!mn(this.options.zoomLevels))return new Error("Peaks.init(): The zoomLevels array must be sorted in ascending order")}else return new TypeError("Peaks.init(): The zoomLevels option should be an array");this._logger=this.options.logger};it.prototype.setSource=function(t,e){var i=this;i.player._setSource(t).then(function(){t.zoomLevels||(t.zoomLevels=i.options.zoomLevels),i._waveformBuilder=new Le(i),i._waveformBuilder.init(t,function(r,a){if(r){e(r);return}i._waveformBuilder=null,i._waveformData=a,["overview","zoomview"].forEach(function(n){var s=i.views.getView(n);s&&s.setWaveformData(a)}),i.zoom.setZoomLevels(t.zoomLevels),e()})}).catch(function(r){e(r)})};it.prototype.getWaveformData=function(){return this._waveformData};it.prototype.destroy=function(){this._waveformBuilder&&this._waveformBuilder.abort(),this._keyboardHandler&&this._keyboardHandler.destroy(),this.views&&this.views.destroy(),this.player&&this.player.destroy(),this._cueEmitter&&this._cueEmitter.destroy()};export{it as default};
